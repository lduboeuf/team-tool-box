!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.Promise=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(){this._isTickUsed=!1,this._schedule=e,this._length=0,this._lateBuffer=new f(16),this._functionBuffer=new f(65536);var a=this;this.consumeFunctionBuffer=function(){a._consumeFunctionBuffer()}}var e=a("./schedule.js"),f=a("./queue.js"),g=a("./util.js").errorObj,h=a("./util.js").tryCatch1,i="undefined"!=typeof process?process:void 0;d.prototype.haveItemsQueued=function(){return this._length>0},d.prototype.invokeLater=function(a,b,c){void 0===i||null==i.domain||a.domain||(a=i.domain.bind(a)),this._lateBuffer.push(a,b,c),this._queueTick()},d.prototype.invoke=function(a,b,c){void 0===i||null==i.domain||a.domain||(a=i.domain.bind(a));var d=this._functionBuffer;d.push(a,b,c),this._length=d.length(),this._queueTick()},d.prototype._consumeFunctionBuffer=function(){for(var a=this._functionBuffer;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift();b.call(c,d)}this._reset(),this._consumeLateBuffer()},d.prototype._consumeLateBuffer=function(){for(var a=this._lateBuffer;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift(),e=h(b,c,d);if(e===g){if(this._queueTick(),null==b.domain)throw e.e;b.domain.emit("error",e.e)}}},d.prototype._queueTick=function(){this._isTickUsed||(this._schedule(this.consumeFunctionBuffer),this._isTickUsed=!0)},d.prototype._reset=function(){this._isTickUsed=!1,this._length=0},b.exports=new d},{"./queue.js":15,"./schedule.js":16,"./util.js":19}],2:[function(a,b,c){"use strict";var d=a("./promise.js")();b.exports=d},{"./promise.js":12}],3:[function(a,b,c){"use strict";b.exports=function(){function b(a){var b;if("function"==typeof a)b="[function "+(a.name||"anonymous")+"]";else{b=a.toString();var d=/\[object [a-zA-Z0-9$_]+\]/;if(d.test(b))try{var e=JSON.stringify(a);b=e}catch(a){}0===b.length&&(b="(empty array)")}return"(<"+c(b)+">, no stack trace)"}function c(a){var b=41;return a.length<b?a:a.substr(0,b-3)+"..."}function d(a,b){this.captureStackTrace(d,b)}var e=a("./util.js").inherits,f=a("./es5.js").defineProperty,g=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|tryCatch(?:1|2|3|4|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),h=null,i=null;e(d,Error),d.prototype.captureStackTrace=function(a,b){j(this,a,b)},d.possiblyUnhandledRejection=function(a){if("object"==typeof console){var b;if("object"==typeof a||"function"==typeof a){var c=a.stack;b="Possibly unhandled "+i(c,a)}else b="Possibly unhandled "+String(a);"function"==typeof console.error||"object"==typeof console.error?console.error(b):("function"==typeof console.log||"object"==typeof console.log)&&console.log(b)}},d.combine=function(a,b){for(var c=a.length-1,d=b.length-1;d>=0;--d){var e=b[d];if(a[c]!==e)break;a.pop(),c--}a.push("From previous event:");for(var f=a.concat(b),i=[],d=0,j=f.length;j>d;++d)g.test(f[d])&&h.test(f[d])||d>0&&!h.test(f[d])&&"From previous event:"!==f[d]||i.push(f[d]);return i},d.protectErrorMessageNewlines=function(a){for(var b=0;b<a.length&&!h.test(a[b]);++b);if(!(1>=b)){for(var c=[],d=0;b>d;++d)c.push(a.shift());a.unshift(c.join("\0"))}},d.isSupported=function(){return"function"==typeof j};var j=function a(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){h=/^\s*at\s*/,i=function(a,c){return"string"==typeof a?a:void 0!==c.name&&void 0!==c.message?c.name+". "+c.message:b(c)};var c=Error.captureStackTrace;return function(a,b){c(a,b)}}var d=new Error;if("string"==typeof d.stack&&"function"==typeof"".startsWith&&d.stack.startsWith("stackDetection@")&&"stackDetection"===a.name){f(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),h=/@/;var e=/[@\n]/;return i=function(a,c){return"string"==typeof a?c.name+". "+c.message+"\n"+a:void 0!==c.name&&void 0!==c.message?c.name+". "+c.message:b(c)},function(a){for(var b=(new Error).stack,c=b.split(e),d=c.length,f="",g=0;d>g;g+=2)f+=c[g],f+="@",f+=c[g+1],f+="\n";a.stack=f}}return i=function(a,c){return"string"==typeof a?a:"object"!=typeof c&&"function"!=typeof c||void 0===c.name||void 0===c.message?b(c):c.name+". "+c.message},null}();return d}},{"./es5.js":8,"./util.js":19}],4:[function(a,b,c){"use strict";b.exports=function(b){function c(a,b,c){this._instances=a,this._callback=b,this._promise=c}function d(a,b){var c={},d=g(a,c,b);if(d===h)return d;var e=i(c);return e.length?(h.e=new j("Catch filter must inherit from Error or be a simple predicate function"),h):d}var e=a("./util.js"),f=a("./errors.js"),g=e.tryCatch1,h=e.errorObj,i=a("./es5.js").keys,j=f.TypeError;return c.prototype.doFilter=function(a){for(var c=this._callback,e=this._promise,i=e._boundTo,j=0,k=this._instances.length;k>j;++j){var l=this._instances[j],m=l===Error||null!=l&&l.prototype instanceof Error;if(m&&a instanceof l){var n=g(c,i,a);return n===h?(b.e=n.e,b):n}if("function"==typeof l&&!m){var o=d(l,a);if(o===h){var p=f.canAttach(h.e)?h.e:new Error(h.e+"");this._promise._attachExtraTrace(p),a=h.e;break}if(o){var n=g(c,i,a);return n===h?(b.e=n.e,b):n}}}return b.e=a,b},c}},{"./errors.js":6,"./es5.js":8,"./util.js":19}],5:[function(a,b,c){"use strict";var d=a("./util.js"),e=d.isPrimitive,f=d.wrapsPrimitiveReceiver;b.exports=function(a){var b=function(){return this},c=function(){throw this},d=function(a,b){return 1===b?function(){throw a}:2===b?function(){return a}:void 0};a.prototype.return=a.prototype.thenReturn=function(a){return f&&e(a)?this._then(d(a,2),void 0,void 0,void 0,void 0):this._then(b,void 0,void 0,a,void 0)},a.prototype.throw=a.prototype.thenThrow=function(a){return f&&e(a)?this._then(d(a,1),void 0,void 0,void 0,void 0):this._then(c,void 0,void 0,a,void 0)}}},{"./util.js":19}],6:[function(a,b,c){"use strict";function d(a){try{o(a,"isOperational",!0)}catch(a){}}function e(a){return null!=a&&(a instanceof i||a.isOperational===!0)}function f(a){return a instanceof Error}function g(a){return f(a)}function h(a,b){function c(d){return this instanceof c?(this.message="string"==typeof d?d:b,this.name=a,void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new c(d)}return n(c,Error),c}function i(a){this.name="OperationalError",this.message=a,this.cause=a,this.isOperational=!0,a instanceof Error?(this.message=a.message,this.stack=a.stack):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var j,k,l=a("./es5.js").freeze,m=a("./util.js"),n=m.inherits,o=m.notEnumerableProp,p=h("CancellationError","cancellation error"),q=h("TimeoutError","timeout error"),r=h("AggregateError","aggregate error");try{j=TypeError,k=RangeError}catch(a){j=h("TypeError","type error"),k=h("RangeError","range error")}for(var s="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),t=0;t<s.length;++t)"function"==typeof Array.prototype[s[t]]&&(r.prototype[s[t]]=Array.prototype[s[t]]);r.prototype.length=0,r.prototype.isOperational=!0;var u=0;r.prototype.toString=function(){var a=Array(4*u+1).join(" "),b="\n"+a+"AggregateError of:\n";u++,a=Array(4*u+1).join(" ");for(var c=0;c<this.length;++c){for(var d=this[c]===this?"[Circular AggregateError]":this[c]+"",e=d.split("\n"),f=0;f<e.length;++f)e[f]=a+e[f];d=e.join("\n"),b+=d+"\n"}return u--,b},n(i,Error);var v="__BluebirdErrorTypes__",w=Error[v];w||(w=l({CancellationError:p,TimeoutError:q,OperationalError:i,RejectionError:i,AggregateError:r}),o(Error,v,w)),b.exports={Error:Error,TypeError:j,RangeError:k,CancellationError:w.CancellationError,OperationalError:w.OperationalError,TimeoutError:w.TimeoutError,AggregateError:w.AggregateError,originatesFromRejection:e,markAsOriginatingFromRejection:d,canAttach:g}},{"./es5.js":8,"./util.js":19}],7:[function(a,b,c){"use strict";b.exports=function(b){function c(a){var c=new d(a),e=b.rejected(c),f=e._peekContext();return null!=f&&f._attachExtraTrace(c),e}var d=a("./errors.js").TypeError;return c}},{"./errors.js":6}],8:[function(a,b,c){var d=function(){"use strict";return void 0===this}();if(d)b.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:d};else{var e={}.hasOwnProperty,f={}.toString,g={}.constructor.prototype,h=function(a){var b=[];for(var c in a)e.call(a,c)&&b.push(c);return b},i=function(a,b,c){return a[b]=c.value,a},j=function(a){return a},k=function(a){try{return Object(a).constructor.prototype}catch(a){return g}},l=function(a){try{return"[object Array]"===f.call(a)}catch(a){return!1}};b.exports={isArray:l,keys:h,defineProperty:i,freeze:j,getPrototypeOf:k,isES5:d}}},{}],9:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(){return this}function f(){throw this}function g(a){return function(){return a}}function h(a){return function(){throw a}}function i(a,b,c){var d;return d=m&&n(b)?c?g(b):h(b):c?e:f,a._then(d,o,void 0,b,void 0)}function j(a){var e=this.promise,f=this.handler,g=e._isBound()?f.call(e._boundTo):f();if(void 0!==g){var h=d(g,void 0);if(h instanceof b)return i(h,a,e.isFulfilled())}return e.isRejected()?(c.e=a,c):a}function k(a){var c=this.promise,e=this.handler,f=c._isBound()?e.call(c._boundTo,a):e(a);if(void 0!==f){var g=d(f,void 0);if(g instanceof b)return i(g,a,!0)}return a}var l=a("./util.js"),m=l.wrapsPrimitiveReceiver,n=l.isPrimitive,o=l.thrower;b.prototype._passThroughHandler=function(a,b){if("function"!=typeof a)return this.then();var c={promise:this,handler:a};return this._then(b?j:k,b?j:void 0,void 0,c,void 0)},b.prototype.lastly=b.prototype.finally=function(a){return this._passThroughHandler(a,!0)},b.prototype.tap=function(a){return this._passThroughHandler(a,!1)}}},{"./util.js":19}],10:[function(a,b,c){"use strict";b.exports=function(b,c,d,e){var f=a("./util.js"),g=f.canEvaluate,h=f.tryCatch1,i=f.errorObj;if(g){for(var j=function(a){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,a))},k=function(a){for(var b=[],c=1;a>=c;++c)b.push("holder.p"+c);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,b.join(", ")))},l=[],m=[void 0],n=1;5>=n;++n)l.push(j(n)),m.push(k(n));var o=function(a,b){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=b,this.total=a,this.now=0};o.prototype.callers=m,o.prototype.checkFulfillment=function(a){var b=this.now;b++;var c=this.total;if(b>=c){var d=this.callers[c],e=h(d,void 0,this);e===i?a._rejectUnchecked(e.e):a._tryFollow(e)||a._fulfillUnchecked(e)}else this.now=b}}b.join=function(){var a,f=arguments.length-1;if(f>0&&"function"==typeof arguments[f]&&(a=arguments[f],6>f&&g)){var h=new b(e);h._setTrace(void 0);for(var i=new o(f,a),j=h._reject,k=l,m=0;f>m;++m){var n=d(arguments[m],void 0);n instanceof b?n.isPending()?n._then(k[m],j,void 0,h,i):n.isFulfilled()?k[m].call(h,n._settledValue,i):(h._reject(n._settledValue),n._unsetRejectionIsUnhandled()):k[m].call(h,n,i)}return h}for(var p=arguments.length,q=new Array(p),r=0;p>r;++r)q[r]=arguments[r];var h=new c(q).promise();return void 0!==a?h.spread(a):h}}},{"./util.js":19}],11:[function(a,b,c){"use strict";b.exports=function(b){function c(a){throw a}function d(a,b){if(!g.isArray(a))return e(a,b);var d=g.tryCatchApply(this,[null].concat(a),b);d===k&&h.invokeLater(c,void 0,d.e)}function e(a,b){var d=this,e=void 0===a?j(d,b,null):i(d,b,null,a);e===k&&h.invokeLater(c,void 0,e.e)}function f(a,b){var d=this,e=j(d,b,a);e===k&&h.invokeLater(c,void 0,e.e)}var g=a("./util.js"),h=a("./async.js"),i=g.tryCatch2,j=g.tryCatch1,k=g.errorObj;b.prototype.nodeify=function(a,b){if("function"==typeof a){var c=e;void 0!==b&&Object(b).spread&&(c=d),this._then(c,f,void 0,a,this._boundTo)}return this}}},{"./async.js":1,"./util.js":19}],12:[function(a,b,c){"use strict";function d(a){try{Promise===a&&(Promise=e)}catch(a){}return a}var e;"undefined"!=typeof Promise&&(e=Promise),b.exports=function(){function b(a){if("function"!=typeof a)throw new v("the promise constructor requires a resolver function");if(this.constructor!==b)throw new v("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,a!==h&&this._resolveFromResolver(a)}function c(a){return a[0]}var e=a("./util.js"),f=a("./async.js"),g=a("./errors.js"),h=function(){},i={},j={e:null},k=a("./thenables.js")(b,h),l=a("./promise_array.js")(b,h,k),m=a("./captured_trace.js")(),n=a("./catch_filter.js")(j),o=a("./promise_resolver.js"),p=e.isArray,q=e.errorObj,r=e.tryCatch1,s=e.tryCatch2,t=e.tryCatchApply,u=g.RangeError,v=g.TypeError,w=g.CancellationError,x=g.TimeoutError,y=g.OperationalError,z=g.originatesFromRejection,A=g.markAsOriginatingFromRejection,B=g.canAttach,C=e.thrower,D=a("./errors_api_rejection")(b),E=function(){return new v("circular promise resolution chain")};b.prototype.bind=function(a){var d=k(a,void 0),e=new b(h);if(d instanceof b){var f=d.then(function(a){e._setBoundTo(a)}),g=b.all([this,f]).then(c);e._follow(g)}else e._follow(this),e._setBoundTo(a);return e._propagateFrom(this,3),e},b.prototype.toString=function(){return"[object Promise]"},b.prototype.caught=b.prototype.catch=function(a){var c=arguments.length;if(c>1){var d,e=new Array(c-1),f=0;for(d=0;c-1>d;++d){var g=arguments[d];if("function"!=typeof g){var h=new v("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(h),b.reject(h)}e[f++]=g}e.length=f,a=arguments[d],this._resetTrace();var i=new n(e,a,this);return this._then(void 0,i.doFilter,void 0,i,void 0)}return this._then(void 0,a,void 0,void 0,void 0)},b.prototype.then=function(a,b,c){return this._then(a,b,c,void 0,void 0)},b.prototype.done=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);d._setIsFinal()},b.prototype.spread=function(a,b){return this._then(a,b,void 0,i,void 0)},b.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},b.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this._settledValue,a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this._settledValue,a.isRejected=!0),a},b.prototype.all=function(){return new l(this).promise()},b.is=function(a){return a instanceof b},b.all=function(a){return new l(a).promise()},b.prototype.error=function(a){return this.caught(z,a)},b.prototype._resolveFromSyncValue=function(a){if(a===q)this._cleanValues(),this._setRejected(),this._settledValue=a.e,this._ensurePossibleRejectionHandled();else{var c=k(a,void 0);c instanceof b?this._follow(c):(this._cleanValues(),this._setFulfilled(),this._settledValue=a)}},b.method=function(a){if("function"!=typeof a)throw new v("fn must be a function");return function(){var c;switch(arguments.length){case 0:c=r(a,this,void 0);break;case 1:c=r(a,this,arguments[0]);break;case 2:c=s(a,this,arguments[0],arguments[1]);break;default:for(var d=arguments.length,e=new Array(d),f=0;d>f;++f)e[f]=arguments[f];c=t(a,e,this)}var g=new b(h);return g._setTrace(void 0),g._resolveFromSyncValue(c),g}},b.attempt=b.try=function(a,c,d){if("function"!=typeof a)return D("fn must be a function");var e=p(c)?t(a,c,d):r(a,d,c),f=new b(h);return f._setTrace(void 0),f._resolveFromSyncValue(e),f},b.defer=b.pending=function(){var a=new b(h);return a._setTrace(void 0),new o(a)},b.bind=function(a){var c=k(a,void 0),d=new b(h);if(d._setTrace(void 0),c instanceof b){var e=c.then(function(a){d._setBoundTo(a)});d._follow(e)}else d._setBoundTo(a),d._setFulfilled();return d},b.cast=function(a){var c=k(a,void 0);if(!(c instanceof b)){var d=c;c=new b(h),c._setTrace(void 0),c._setFulfilled(),c._cleanValues(),c._settledValue=d}return c},b.resolve=b.fulfilled=b.cast,b.reject=b.rejected=function(a){var c=new b(h);if(c._setTrace(void 0),A(a),c._cleanValues(),c._setRejected(),c._settledValue=a,!B(a)){var d=new Error(a+"");c._setCarriedStackTrace(d)}return c._ensurePossibleRejectionHandled(),c},b.onPossiblyUnhandledRejection=function(a){m.possiblyUnhandledRejection="function"==typeof a?a:void 0};var F;b.onUnhandledRejectionHandled=function(a){F="function"==typeof a?a:void 0};var G=!("undefined"==typeof process||"string"!=typeof process.execPath||"object"!=typeof process.env||!process.env.BLUEBIRD_DEBUG&&"development"!==process.env.NODE_ENV);b.longStackTraces=function(){if(f.haveItemsQueued()&&G===!1)throw new Error("cannot enable long stack traces after promises have been created");G=m.isSupported()},b.hasLongStackTraces=function(){return G&&m.isSupported()},b.prototype._then=function(a,c,d,e,g){var i=void 0!==g,j=i?g:new b(h);if(!i){if(G){var k=this._peekContext()===this._traceParent;j._traceParent=k?this._traceParent:this}j._propagateFrom(this,7)}var l=this._addCallbacks(a,c,d,j,e);return this.isResolved()&&f.invoke(this._queueSettleAt,this,l),j},b.prototype._length=function(){return 262143&this._bitField},b.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},b.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},b.prototype._setLength=function(a){this._bitField=-262144&this._bitField|262143&a},b.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},b.prototype._setRejected=function(){this._bitField=134217728|this._bitField},b.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},b.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},b.prototype._isFinal=function(){return(33554432&this._bitField)>0},b.prototype._cancellable=function(){return(67108864&this._bitField)>0},b.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},b.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},b.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},b.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},b.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},b.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},b.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},b.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},b.prototype._setCarriedStackTrace=function(a){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=a},b.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},b.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},b.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},b.prototype._receiverAt=function(a){var b=0===a?this._receiver0:this[(a<<2)+a-5+4];return this._isBound()&&void 0===b?this._boundTo:b},b.prototype._promiseAt=function(a){return 0===a?this._promise0:this[(a<<2)+a-5+3]},b.prototype._fulfillmentHandlerAt=function(a){return 0===a?this._fulfillmentHandler0:this[(a<<2)+a-5+0]},b.prototype._rejectionHandlerAt=function(a){return 0===a?this._rejectionHandler0:this[(a<<2)+a-5+1]},b.prototype._addCallbacks=function(a,b,c,d,e){var f=this._length();if(f>=262138&&(f=0,this._setLength(0)),0===f)this._promise0=d,void 0!==e&&(this._receiver0=e),"function"!=typeof a||this._isCarryingStackTrace()||(this._fulfillmentHandler0=a),"function"==typeof b&&(this._rejectionHandler0=b),"function"==typeof c&&(this._progressHandler0=c);else{var g=(f<<2)+f-5;this[g+3]=d,this[g+4]=e,this[g+0]="function"==typeof a?a:void 0,this[g+1]="function"==typeof b?b:void 0,this[g+2]="function"==typeof c?c:void 0}return this._setLength(f+1),f},b.prototype._setProxyHandlers=function(a,b){var c=this._length();if(c>=262138&&(c=0,this._setLength(0)),0===c)this._promise0=b,this._receiver0=a;else{var d=(c<<2)+c-5;this[d+3]=b,this[d+4]=a,this[d+0]=this[d+1]=this[d+2]=void 0}this._setLength(c+1)},b.prototype._proxyPromiseArray=function(a,b){this._setProxyHandlers(a,b)},b.prototype._proxyPromise=function(a){a._setProxied(),this._setProxyHandlers(a,-15)},b.prototype._setBoundTo=function(a){void 0!==a?(this._bitField=8388608|this._bitField,this._boundTo=a):this._bitField=-8388609&this._bitField},b.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},b.prototype._resolveFromResolver=function(a){function b(a){d._tryFollow(a)||d._fulfill(a)}function c(a){var b=B(a)?a:new Error(a+"");d._attachExtraTrace(b),A(a),d._reject(a,b===a?void 0:b)}var d=this;this._setTrace(void 0),this._pushContext();var e=s(a,void 0,b,c);if(this._popContext(),void 0!==e&&e===q){var f=e.e,g=B(f)?f:new Error(f+"");d._reject(f,g)}},b.prototype._spreadSlowCase=function(a,b,c,d){var e=new l(c).promise(),f=e._then(function(){return a.apply(d,arguments)},void 0,void 0,i,void 0);b._follow(f)},b.prototype._callSpread=function(a,c,d){var e=this._boundTo;if(p(d))for(var f=0,g=d.length;g>f;++f)if(k(d[f],void 0)instanceof b)return void this._spreadSlowCase(a,c,d,e);return c._pushContext(),t(a,d,e)},b.prototype._callHandler=function(a,b,c,d){var e;return b!==i||this.isRejected()?(c._pushContext(),e=r(a,b,d)):e=this._callSpread(a,c,d),c._popContext(),e},b.prototype._settlePromiseFromHandler=function(a,c,d,e){if(!(e instanceof b))return void a.call(c,d,e);var f=this._callHandler(a,c,e,d);if(!e._isFollowing())if(f===q||f===e||f===j){var g=f===e?E():f.e,h=B(g)?g:new Error(g+"");f!==j&&e._attachExtraTrace(h),e._rejectUnchecked(g,h)}else{var i=k(f,e);if(i instanceof b){if(i.isRejected()&&!i._isCarryingStackTrace()&&!B(i._settledValue)){var h=new Error(i._settledValue+"");e._attachExtraTrace(h),i._setCarriedStackTrace(h)}e._follow(i),e._propagateFrom(i,1)}else e._fulfillUnchecked(f)}},b.prototype._follow=function(a){this._setFollowing(),a.isPending()?(this._propagateFrom(a,1),a._proxyPromise(this)):a.isFulfilled()?this._fulfillUnchecked(a._settledValue):this._rejectUnchecked(a._settledValue,a._getCarriedStackTrace()),a._isRejectionUnhandled()&&a._unsetRejectionIsUnhandled(),G&&null==a._traceParent&&(a._traceParent=this)},b.prototype._tryFollow=function(a){if(this._isFollowingOrFulfilledOrRejected()||a===this)return!1;var c=k(a,void 0);return c instanceof b&&(this._follow(c),!0)},b.prototype._resetTrace=function(){G&&(this._trace=new m(void 0===this._peekContext()))},b.prototype._setTrace=function(a){if(G){var b=this._peekContext();this._traceParent=b;var c=void 0===b;void 0!==a&&a._traceParent===b?this._trace=a._trace:this._trace=new m(c)}return this},b.prototype._attachExtraTrace=function(a){if(G){var b=this,c=a.stack;c="string"==typeof c?c.split("\n"):[],m.protectErrorMessageNewlines(c);for(var d=1,e=1;null!=b&&null!=b._trace;)c=m.combine(c,b._trace.stack.split("\n")),b=b._traceParent,e++;var f=Error.stackTraceLimit||10,g=(f+d)*e,h=c.length;h>g&&(c.length=g),h>0&&(c[0]=c[0].split("\0").join("\n")),c.length<=d?a.stack="(No stack trace)":a.stack=c.join("\n")}},b.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},b.prototype._propagateFrom=function(a,b){(1&b)>0&&a._cancellable()&&(this._setCancellable(),this._cancellationParent=a),(4&b)>0&&this._setBoundTo(a._boundTo),(2&b)>0&&this._setTrace(a)},b.prototype._fulfill=function(a){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(a)},b.prototype._reject=function(a,b){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(a,b)},b.prototype._settlePromiseAt=function(a){var c=this.isFulfilled()?this._fulfillmentHandlerAt(a):this._rejectionHandlerAt(a),d=this._settledValue,e=this._receiverAt(a),f=this._promiseAt(a);if("function"==typeof c)this._settlePromiseFromHandler(c,e,d,f);else{var g=!1,h=this.isFulfilled();void 0!==e&&(e instanceof b&&e._isProxied()?(e._unsetProxied(),h?e._fulfillUnchecked(d):e._rejectUnchecked(d,this._getCarriedStackTrace()),g=!0):e instanceof l&&(h?e._promiseFulfilled(d,f):e._promiseRejected(d,f),g=!0)),g||(h?f._fulfill(d):f._reject(d,this._getCarriedStackTrace()))}a>=4&&this._queueGC()},b.prototype._isProxied=function(){return 4194304===(4194304&this._bitField)},b.prototype._setProxied=function(){this._bitField=4194304|this._bitField},b.prototype._unsetProxied=function(){this._bitField=-4194305&this._bitField},b.prototype._isGcQueued=function(){return-1073741824===(-1073741824&this._bitField)},b.prototype._setGcQueued=function(){this._bitField=-1073741824|this._bitField},b.prototype._unsetGcQueued=function(){this._bitField=1073741823&this._bitField},b.prototype._queueGC=function(){this._isGcQueued()||(this._setGcQueued(),f.invokeLater(this._gc,this,void 0))},b.prototype._gc=function(){for(var a=5*this._length()-5,b=0;a>b;b++)delete this[b];this._clearFirstHandlerData(),this._setLength(0),this._unsetGcQueued()},b.prototype._clearFirstHandlerData=function(){this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0},b.prototype._queueSettleAt=function(a){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),f.invoke(this._settlePromiseAt,this,a)},b.prototype._fulfillUnchecked=function(a){if(this.isPending()){if(a===this){var b=E();return this._attachExtraTrace(b),this._rejectUnchecked(b,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=a;var c=this._length();c>0&&f.invoke(this._settlePromises,this,c)}},b.prototype._rejectUncheckedCheckError=function(a){var b=B(a)?a:new Error(a+"");this._rejectUnchecked(a,b===a?void 0:b)},b.prototype._rejectUnchecked=function(a,b){if(this.isPending()){if(a===this){var c=E();return this._attachExtraTrace(c),this._rejectUnchecked(c)}if(this._cleanValues(),this._setRejected(),this._settledValue=a,this._isFinal())return void f.invokeLater(C,void 0,void 0===b?a:b);var d=this._length();void 0!==b&&this._setCarriedStackTrace(b),d>0?f.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()}},b.prototype._rejectPromises=function(){this._settlePromises(),this._unsetCarriedStackTrace()},b.prototype._settlePromises=function(){for(var a=this._length(),b=0;a>b;b++)this._settlePromiseAt(b)},b.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==m.possiblyUnhandledRejection&&f.invokeLater(this._notifyUnhandledRejection,this,void 0)},b.prototype._notifyUnhandledRejectionIsHandled=function(){"function"==typeof F&&f.invokeLater(F,void 0,this)},b.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var a=this._settledValue,b=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),void 0!==b&&(this._unsetCarriedStackTrace(),a=b),"function"==typeof m.possiblyUnhandledRejection&&m.possiblyUnhandledRejection(a,this)}};var H=[];return b.prototype._peekContext=function(){var a=H.length-1;return a>=0?H[a]:void 0},b.prototype._pushContext=function(){G&&H.push(this)},b.prototype._popContext=function(){G&&H.pop()},b.noConflict=function(){return d(b)},b.setScheduler=function(a){if("function"!=typeof a)throw new v("fn must be a function");f._schedule=a},m.isSupported()||(b.longStackTraces=function(){},G=!1),b._makeSelfResolutionError=E,a("./finally.js")(b,j,k),a("./direct_resolve.js")(b),a("./synchronous_inspection.js")(b),a("./join.js")(b,l,k,h),b.RangeError=u,b.CancellationError=w,b.TimeoutError=x,b.TypeError=v,b.OperationalError=y,b.RejectionError=y,b.AggregateError=g.AggregateError,e.toFastProperties(b),e.toFastProperties(b.prototype),b.Promise=b,a("./nodeify.js")(b),b.prototype=b.prototype,b}},{"./async.js":1,"./captured_trace.js":3,"./catch_filter.js":4,"./direct_resolve.js":5,"./errors.js":6,"./errors_api_rejection":7,"./finally.js":9,"./join.js":10,"./nodeify.js":11,"./promise_array.js":13,"./promise_resolver.js":14,"./synchronous_inspection.js":17,"./thenables.js":18,"./util.js":19}],13:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(a){switch(a){case-1:return;case-2:return[];case-3:return{}}}function f(a){var d=this._promise=new b(c),e=void 0;a instanceof b&&(e=a,d._propagateFrom(e,5)),d._setTrace(e),this._values=a,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var g=a("./errors.js").canAttach,h=a("./util.js"),i=h.isArray;return f.prototype.length=function(){return this._length},f.prototype.promise=function(){return this._promise},f.prototype._init=function a(c,f){var g=d(this._values,void 0);if(g instanceof b){if(this._values=g,g._setBoundTo(this._promise._boundTo),!g.isFulfilled())return g.isPending()?void g._then(a,this._reject,void 0,this,f):(g._unsetRejectionIsUnhandled(),void this._reject(g._settledValue));if(g=g._settledValue,!i(g)){var h=new b.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(h)}}else if(!i(g)){var h=new b.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(h)}if(0===g.length)return void(-5===f?this._resolveEmptyArray():this._resolve(e(f)));for(var j=this.getActualLength(g.length),k=j,l=this.shouldCopyValues()?new Array(j):this._values,m=!1,n=0;j>n;++n){var o=d(g[n],void 0);o instanceof b?o.isPending()?o._proxyPromiseArray(this,n):(o._unsetRejectionIsUnhandled(),m=!0):m=!0,l[n]=o}this._values=l,this._length=k,m&&this._scanDirectValues(j)},f.prototype._settlePromiseAt=function(a){var c=this._values[a];c instanceof b?c.isFulfilled()?this._promiseFulfilled(c._settledValue,a):c.isRejected()&&this._promiseRejected(c._settledValue,a):this._promiseFulfilled(c,a)},f.prototype._scanDirectValues=function(a){for(var b=0;a>b&&!this._isResolved();++b)this._settlePromiseAt(b)},f.prototype._isResolved=function(){return null===this._values},f.prototype._resolve=function(a){this._values=null,this._promise._fulfill(a)},f.prototype.__hardReject__=f.prototype._reject=function(a){this._values=null;var b=g(a)?a:new Error(a+"");this._promise._attachExtraTrace(b),this._promise._reject(a,b)},f.prototype._promiseProgressed=function(a,b){this._isResolved()||this._promise._progress({index:b,value:a})},f.prototype._promiseFulfilled=function(a,b){if(!this._isResolved()){this._values[b]=a;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)}},f.prototype._promiseRejected=function(a,b){this._isResolved()||(this._totalResolved++,this._reject(a))},f.prototype.shouldCopyValues=function(){return!0},f.prototype.getActualLength=function(a){return a},f}},{"./errors.js":6,"./util.js":19}],14:[function(a,b,c){"use strict";function d(a){return a instanceof Error&&o.getPrototypeOf(a)===Error.prototype}function e(a){var b;return b=d(a)?new l(a):a,j.markAsOriginatingFromRejection(b),b}function f(a){function b(b,c){if(null!==a){if(b){var d=e(i(b));a._attachExtraTrace(d),
a._reject(d)}else if(arguments.length>2){for(var f=arguments.length,g=new Array(f-1),h=1;f>h;++h)g[h-1]=arguments[h];a._fulfill(g)}else a._fulfill(c);a=null}}return b}var g,h=a("./util.js"),i=h.maybeWrapAsError,j=a("./errors.js"),k=j.TimeoutError,l=j.OperationalError,m=a("./async.js"),n=h.haveGetters,o=a("./es5.js");if(g=n?function(a){this.promise=a}:function(a){this.promise=a,this.asCallback=f(a),this.callback=this.asCallback},n){var p={get:function(){return f(this.promise)}};o.defineProperty(g.prototype,"asCallback",p),o.defineProperty(g.prototype,"callback",p)}g._nodebackForPromise=f,g.prototype.toString=function(){return"[object PromiseResolver]"},g.prototype.resolve=g.prototype.fulfill=function(a){if(!(this instanceof g))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var b=this.promise;b._tryFollow(a)||m.invoke(b._fulfill,b,a)},g.prototype.reject=function(a){if(!(this instanceof g))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var b=this.promise;j.markAsOriginatingFromRejection(a);var c=j.canAttach(a)?a:new Error(a+"");b._attachExtraTrace(c),m.invoke(b._reject,b,a),c!==a&&m.invoke(this._setCarriedStackTrace,this,c)},g.prototype.progress=function(a){if(!(this instanceof g))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");m.invoke(this.promise._progress,this.promise,a)},g.prototype.cancel=function(){m.invoke(this.promise.cancel,this.promise,void 0)},g.prototype.timeout=function(){this.reject(new k("timeout"))},g.prototype.isResolved=function(){return this.promise.isResolved()},g.prototype.toJSON=function(){return this.promise.toJSON()},g.prototype._setCarriedStackTrace=function(a){this.promise.isRejected()&&this.promise._setCarriedStackTrace(a)},b.exports=g},{"./async.js":1,"./errors.js":6,"./es5.js":8,"./util.js":19}],15:[function(a,b,c){"use strict";function d(a,b,c,d,e){for(var f=0;e>f;++f)c[f+d]=a[f+b]}function e(a){this._capacity=a,this._length=0,this._front=0,this._makeCapacity()}e.prototype._willBeOverCapacity=function(a){return this._capacity<a},e.prototype._pushOne=function(a){var b=this.length();this._checkCapacity(b+1);var c=this._front+b&this._capacity-1;this[c]=a,this._length=b+1},e.prototype.push=function(a,b,c){var d=this.length()+3;if(this._willBeOverCapacity(d))return this._pushOne(a),this._pushOne(b),void this._pushOne(c);var e=this._front+d-3;this._checkCapacity(d);var f=this._capacity-1;this[e+0&f]=a,this[e+1&f]=b,this[e+2&f]=c,this._length=d},e.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},e.prototype.length=function(){return this._length},e.prototype._makeCapacity=function(){for(var a=this._capacity,b=0;a>b;++b)this[b]=void 0},e.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<3)},e.prototype._resizeTo=function(a){var b=this._front,c=this._capacity,e=new Array(c),f=this.length();if(d(this,0,e,0,c),this._capacity=a,this._makeCapacity(),this._front=0,c>=b+f)d(e,b,this,0,f);else{var g=f-(b+f&c-1);d(e,b,this,0,g),d(e,0,this,g,f-g)}},b.exports=e},{}],16:[function(a,b,c){"use strict";var d,e;if("object"==typeof process&&"string"==typeof process.version)d=function(a){process.nextTick(a)};else if("undefined"!=typeof MutationObserver&&(e=MutationObserver)||"undefined"!=typeof WebKitMutationObserver&&(e=WebKitMutationObserver))d=function(){var a=document.createElement("div"),b=void 0,c=new e(function(){var a=b;b=void 0,a()});return c.observe(a,{attributes:!0}),function(c){b=c,a.classList.toggle("foo")}}();else{if("undefined"==typeof setTimeout)throw new Error("no async scheduler available");d=function(a){setTimeout(a,0)}}b.exports=d},{}],17:[function(a,b,c){"use strict";b.exports=function(a){function b(a){void 0!==a?(this._bitField=a._bitField,this._settledValue=a.isResolved()?a._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}b.prototype.isFulfilled=a.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},b.prototype.isRejected=a.prototype.isRejected=function(){return(134217728&this._bitField)>0},b.prototype.isPending=a.prototype.isPending=function(){return 0===(402653184&this._bitField)},b.prototype.value=a.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},b.prototype.error=b.prototype.reason=a.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},b.prototype.isResolved=a.prototype.isResolved=function(){return(402653184&this._bitField)>0},a.PromiseInspection=b}},{}],18:[function(a,b,c){"use strict";b.exports=function(b,c){function d(a){try{return a.then}catch(a){return j.e=a,j}}function e(a,e){if(k(a)){if(a instanceof b)return a;if(f(a)){var h=new b(c);return h._setTrace(void 0),a._then(h._fulfillUnchecked,h._rejectUncheckedCheckError,h._progressUnchecked,h,null),h._setFollowing(),h}var l=d(a);if(l===j)return void 0!==e&&i(l.e)&&e._attachExtraTrace(l.e),b.reject(l.e);if("function"==typeof l)return g(a,l,e)}return a}function f(a){return l.call(a,"_promise0")}function g(a,c,d){function e(c){if(!j){if(j=!0,a===c){var e=b._makeSelfResolutionError();return void 0!==d&&d._attachExtraTrace(e),void h.promise._reject(e,void 0)}h.resolve(c)}}function f(a){if(!j){j=!0;var b=i(a)?a:new Error(a+"");void 0!==d&&d._attachExtraTrace(b),h.promise._reject(a,b)}}function g(a){if(!j){var b=h.promise;"function"==typeof b._progress&&b._progress(a)}}var h=b.defer(),j=!1;try{c.call(a,e,f,g)}catch(a){if(!j){j=!0;var k=i(a)?a:new Error(a+"");void 0!==d&&d._attachExtraTrace(k),h.promise._reject(a,k)}}return h.promise}var h=a("./util.js"),i=a("./errors.js").canAttach,j=h.errorObj,k=h.isObject,l={}.hasOwnProperty;return e}},{"./errors.js":6,"./util.js":19}],19:[function(a,b,c){"use strict";function d(a,b,c){try{return a.call(b,c)}catch(a){return x.e=a,x}}function e(a,b,c,d){try{return a.call(b,c,d)}catch(a){return x.e=a,x}}function f(a,b,c,d,e){try{return a.call(b,c,d,e)}catch(a){return x.e=a,x}}function g(a,b,c,d,e,f){try{return a.call(b,c,d,e,f)}catch(a){return x.e=a,x}}function h(a,b,c){try{return a.apply(c,b)}catch(a){return x.e=a,x}}function i(a){return"string"==typeof a?a:""+a}function j(a){return null==a||a===!0||a===!1||"string"==typeof a||"number"==typeof a}function k(a){return!j(a)}function l(a){return j(a)?new Error(i(a)):a}function m(a,b){var c,d=a.length,e=new Array(d+1);for(c=0;d>c;++c)e[c]=a[c];return e[c]=b,e}function n(a,b,c){if(!u.isES5)return{}.hasOwnProperty.call(a,b)?a[b]:void 0;var d=Object.getOwnPropertyDescriptor(a,b);return null!=d?null==d.get&&null==d.set?d.value:c:void 0}function o(a,b,c){if(j(a))return a;var d={value:c,configurable:!0,enumerable:!1,writable:!0};return u.defineProperty(a,b,d),a}function p(a){throw a}function q(a){try{if("function"==typeof a){var b=u.keys(a.prototype);return b.length>0&&!(1===b.length&&"constructor"===b[0])}return!1}catch(a){return!1}}function r(a){function b(){}return b.prototype=a,b}function s(a){return B.test(a)}function t(a,b,c){for(var d=new Array(a),e=0;a>e;++e)d[e]=b+e+c;return d}var u=a("./es5.js"),v=function(){try{var a={};return u.defineProperty(a,"f",{get:function(){return 3}}),3===a.f}catch(a){return!1}}(),w="undefined"==typeof navigator,x={e:{}},y=function(a,b){function c(){this.constructor=a,this.constructor$=b;for(var c in b.prototype)d.call(b.prototype,c)&&"$"!==c.charAt(c.length-1)&&(this[c+"$"]=b.prototype[c])}var d={}.hasOwnProperty;return c.prototype=b.prototype,a.prototype=new c,a.prototype},z=function(){return"string"!==this}.call("string"),A=function(){return u.isES5?function(a,b){for(var c=[],d=Object.create(null),e=Object(b).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=a;){var f;try{f=e(a)}catch(a){return c}for(var g=0;g<f.length;++g){var h=f[g];if(!d[h]){d[h]=!0;var i=Object.getOwnPropertyDescriptor(a,h);null!=i&&null==i.get&&null==i.set&&c.push(h)}}a=u.getPrototypeOf(a)}return c}:function(a){var b=[];for(var c in a)b.push(c);return b}}(),B=/^[a-z$_][a-z$_0-9]*$/i,C={isClass:q,isIdentifier:s,inheritedDataKeys:A,getDataPropertyOrDefault:n,thrower:p,isArray:u.isArray,haveGetters:v,notEnumerableProp:o,isPrimitive:j,isObject:k,canEvaluate:w,errorObj:x,tryCatch1:d,tryCatch2:e,tryCatch3:f,tryCatch4:g,tryCatchApply:h,inherits:y,withAppended:m,asString:i,maybeWrapAsError:l,wrapsPrimitiveReceiver:z,toFastProperties:r,filledRange:t};b.exports=C},{"./es5.js":8}]},{},[2])(2)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise),function(a){function b(a){"string"==typeof a?console.error(a):console.error(a.message,a.stack)}function c(a){return(403===a.statusCode||401===a.statusCode)&&this._emit("error",new g.Unauthorized),Promise.resolve(a)}function d(a){return"dropbox"===this.backend&&a.match(/^\/public\/.*[^\/]$/)}var e;Promise.defer=function(){var a,b,c=new Promise(function(){a=arguments[0],b=arguments[1]});return{resolve:a,reject:b,promise:c}};var f={get:function(a,b){if(this.local){void 0===b&&("object"==typeof this.remote&&this.remote.connected&&this.remote.online?b=2*this.getSyncInterval():(g.log("Not setting default maxAge, because remote is offline or not connected"),b=!1));var c=function(a){return a!==!1&&"number"!=typeof a};return c(b)?Promise.reject("Argument 'maxAge' must be false or a number"):this.local.get(a,b,this.sync.queueGetRequest.bind(this.sync))}return this.remote.get(a)},put:function(a,b,c){return d.bind(this)(a)?f._wrapBusyDone.call(this,this.remote.put(a,b,c)):this.local?this.local.put(a,b,c):f._wrapBusyDone.call(this,this.remote.put(a,b,c))},delete:function(a){return this.local?this.local.delete(a):f._wrapBusyDone.call(this,this.remote.delete(a))},_wrapBusyDone:function(a){var b=this;return this._emit("wire-busy"),a.then(function(a){return b._emit("wire-done",{success:!0}),Promise.resolve(a)},function(a){return b._emit("wire-done",{success:!1}),Promise.reject(a)})}},g=function(a){if("object"==typeof a&&(g.config.logging=!!a.logging,g.config.cordovaRedirectUri=a.cordovaRedirectUri),g.eventHandling(this,"ready","connected","disconnected","not-connected","conflict","error","features-loaded","connecting","authing","sync-interval-change","wire-busy","wire-done","network-offline","network-online"),this._pending=[],this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")}),this._cleanups=[],this._pathHandlers={change:{}},this.apiKeys={},e=g.util.localStorageAvailable()){try{this.apiKeys=JSON.parse(localStorage.getItem("remotestorage:api-keys"))||{}}catch(a){}this.setBackend(localStorage.getItem("remotestorage:backend")||"remotestorage")}var b=this.on;this.on=function(a,c){return"ready"===a&&this.remote.connected&&this._allLoaded?setTimeout(c,0):"features-loaded"===a&&this._allLoaded&&setTimeout(c,0),b.call(this,a,c)},this._init(),this.fireInitial=function(){this.local&&setTimeout(this.local.fireInitial.bind(this.local),0)}.bind(this),this.on("ready",this.fireInitial.bind(this))};g.SyncedGetPutDelete=f,g.DiscoveryError=function(a){Error.apply(this,arguments),this.message=a},g.DiscoveryError.prototype=Object.create(Error.prototype),g.Unauthorized=function(){Error.apply(this,arguments)},g.Unauthorized.prototype=Object.create(Error.prototype),g.log=function(){g.config.logging&&console.log.apply(console,arguments)},g.config={logging:!1,changeEvents:{local:!0,window:!1,remote:!0,conflict:!0},discoveryTimeout:1e4,cordovaRedirectUri:void 0},g.prototype={connect:function(b,c){if(this.setBackend("remotestorage"),b.indexOf("@")<0)return void this._emit("error",new g.DiscoveryError("User address doesn't contain an @."));if(a.cordova){if("string"!=typeof g.config.cordovaRedirectUri)return void this._emit("error",new g.DiscoveryError("Please supply a custom HTTPS redirect URI for your Cordova app"));if(!a.cordova.InAppBrowser)return void this._emit("error",new g.DiscoveryError("Please include the InAppBrowser Cordova plugin to enable OAuth"))}this.remote.configure({userAddress:b}),this._emit("connecting");var d=setTimeout(function(){this._emit("error",new g.DiscoveryError("No storage information found for this user address."))}.bind(this),g.config.discoveryTimeout);g.Discover(b).then(function(a){if(clearTimeout(d),this._emit("authing"),a.userAddress=b,this.remote.configure(a),!this.remote.connected)if(a.authURL)if("undefined"==typeof c)this.authorize(a.authURL,g.config.cordovaRedirectUri);else{if("string"!=typeof c)throw new Error("Supplied bearer token must be a string");g.log("Skipping authorization sequence and connecting with known token"),this.remote.configure({token:c})}else this.impliedauth()}.bind(this),function(a){clearTimeout(d),this._emit("error",new g.DiscoveryError("No storage information found for this user address."))}.bind(this))},disconnect:function(){this.remote&&this.remote.configure({userAddress:null,href:null,storageApi:null,token:null,properties:null}),this._setGPD({get:this._pendingGPD("get"),put:this._pendingGPD("put"),delete:this._pendingGPD("delete")});var a=this._cleanups.length,b=0,c=function(){b++,b>=a&&(this._init(),g.log("Done cleaning up, emitting disconnected and disconnect events"),this._emit("disconnected"))}.bind(this);a>0?this._cleanups.forEach(function(a){var b=a(this);"object"==typeof b&&"function"==typeof b.then?b.then(c):c()}.bind(this)):c()},setBackend:function(a){this.backend=a,e&&(a?localStorage.setItem("remotestorage:backend",a):localStorage.removeItem("remotestorage:backend"))},onChange:function(a,b){this._pathHandlers.change[a]||(this._pathHandlers.change[a]=[]),this._pathHandlers.change[a].push(b)},enableLog:function(){g.config.logging=!0},disableLog:function(){g.config.logging=!1},log:function(){g.log.apply(g,arguments)},setApiKeys:function(a,b){b?(this.apiKeys[a]=b,"dropbox"!==a||"undefined"!=typeof this.dropbox&&this.dropbox.clientId===b.appKey?"googledrive"!==a||"undefined"!=typeof this.googledrive&&this.googledrive.clientId===b.clientId||g.GoogleDrive._rs_init(this):g.Dropbox._rs_init(this)):delete this.apiKeys[a],e&&localStorage.setItem("remotestorage:api-keys",JSON.stringify(this.apiKeys))},setCordovaRedirectUri:function(a){if("string"!=typeof a||!a.match(/http(s)?\:\/\//))throw new Error("Cordova redirect URI must be a URI string");g.config.cordovaRedirectUri=a},_init:function(){function a(){try{d||(c._emit("ready"),d=!0)}catch(a){console.error("'ready' failed: ",a,a.stack),c._emit("error",a)}}var c=this,d=!1;this._loadFeatures(function(d){this.log("[RemoteStorage] All features loaded"),this.local=d.local&&new d.local,this.local&&this.remote?(this._setGPD(f,this),this._bindChange(this.local)):this.remote&&this._setGPD(this.remote,this.remote),this.remote&&(this.remote.on("connected",function(){a(),c._emit("connected")}),this.remote.on("not-connected",function(){a(),c._emit("not-connected")}),this.remote.connected&&(a(),c._emit("connected")),this.hasFeature("Authorize")||this.remote.stopWaitingForToken()),this._collectCleanupFunctions();try{this._allLoaded=!0,this._emit("features-loaded")}catch(a){b(a),this._emit("error",a)}this._processPending()}.bind(this))},_collectCleanupFunctions:function(){this._cleanups=[];for(var a=0;a<this.features.length;a++){var b=this.features[a].cleanup;"function"==typeof b&&this._cleanups.push(b)}},_loadFeatures:function(a){function b(){j++,j===h.length&&setTimeout(function(){i.caching=!!g.Caching,i.sync=!!g.Sync,["IndexedDB","LocalStorage","InMemoryStorage"].some(function(a){return i.some(function(b){return b.name===a})?(i.local=g[a],!0):void 0}),k.features=i,a(i)},0)}function c(a){k.log("[RemoteStorage] [FEATURE "+a+"] initialized."),i.push({name:a,init:g[a]._rs_init,supported:!0,cleanup:g[a]._rs_cleanup}),b()}function d(a,c){k.log("[RemoteStorage] [FEATURE "+a+"] initialization failed ( "+c+")"),b()}function e(a,c){k.log("[RemoteStorage] [FEATURE "+a+"]"+c?"":" not supported"),c||b()}function f(a){var b;try{b=g[a]._rs_init(k)}catch(b){return void d(a,b)}"object"==typeof b&&"function"==typeof b.then?b.then(function(){c(a)},function(b){d(a,b)}):c(a)}var h=["WireClient","I18n","Dropbox","GoogleDrive","Access","Caching","Discover","Authorize","Widget","IndexedDB","LocalStorage","InMemoryStorage","Sync","BaseClient","Env"],i=[],j=0,k=this;h.forEach(function(a){k.log("[RemoteStorage] [FEATURE "+a+"] initializing...");var b,c=g[a];c?(b=!c._rs_supported||c._rs_supported(),"object"==typeof b?b.then(function(){e(a,!0),f(a)},function(){e(a,!1)}):"boolean"==typeof b&&(e(a,b),b&&f(a))):e(a,!1)})},hasFeature:function(a){for(var b=this.features.length-1;b>=0;b--)if(this.features[b].name===a)return this.features[b].supported;return!1},_setGPD:function(a,b){function d(a){return function(){return a.apply(b,arguments).then(c.bind(this))}}this.get=d(a.get),this.put=d(a.put),this.delete=d(a.delete)},_pendingGPD:function(a){return function(){var b=Promise.defer();return this._pending.push({method:a,args:Array.prototype.slice.call(arguments),promise:b}),b.promise}.bind(this)},_processPending:function(){this._pending.forEach(function(a){try{this[a.method].apply(this,a.args).then(a.promise.resolve,a.promise.reject)}catch(b){a.promise.reject(b)}}.bind(this)),this._pending=[]},_bindChange:function(a){a.on("change",this._dispatchEvent.bind(this,"change"))},_dispatchEvent:function(a,b){var c=this;Object.keys(this._pathHandlers[a]).forEach(function(d){var e=d.length;b.path.substr(0,e)===d&&c._pathHandlers[a][d].forEach(function(a){var e={};for(var f in b)e[f]=b[f];e.relativePath=b.path.replace(new RegExp("^"+d),"");try{a(e)}catch(a){console.error("'change' handler failed: ",a,a.stack),c._emit("error",a)}})})}},Object.defineProperty(g.prototype,"connected",{get:function(){return this.remote.connected}}),a.RemoteStorage=g,"object"==typeof module&&"undefined"!=typeof module.exports&&(module.exports=g)}("undefined"!=typeof window?window:global),function(a){function b(a,c){var d,e,f;if("object"==typeof a&&!Array.isArray(a)&&null!==a)for(d in a)"object"==typeof a[d]&&null!==a[d]&&("[object ArrayBuffer]"===a[d].toString()?(c[d]=new ArrayBuffer(a[d].byteLength),e=new Int8Array(a[d]),f=new Int8Array(c[d]),f.set(e)):b(a[d],c[d]))}RemoteStorage.util={getEventEmitter:function(){var a={},b=Array.prototype.slice.call(arguments);return b.unshift(a),RemoteStorage.eventHandling.apply(RemoteStorage,b),a.emit=a._emit,a},extend:function(a){var b=Array.prototype.slice.call(arguments,1);return b.forEach(function(b){for(var c in b)a[c]=b[c]}),a},asyncEach:function(a,b){return this.asyncMap(a,b).then(function(){return a})},asyncMap:function(a,b){function c(){f++,f===e&&d.resolve(g,h)}var d=Promise.defer(),e=a.length,f=0,g=[],h=[];return a.forEach(function(a,d){var e;try{e=b(a)}catch(a){c(),h[d]=a}"object"==typeof e&&"function"==typeof e.then?e.then(function(a){g[d]=a,c()},function(a){h[d]=a,c()}):(c(),g[d]=e)}),d.promise},containingFolder:function(a){if(""===a)return"/";if(!a)throw"Path not given!";return a.replace(/\/+/g,"/").replace(/[^\/]+\/?$/,"")},isFolder:function(a){return"/"===a.substr(-1)},isDocument:function(a){return!RemoteStorage.util.isFolder(a)},baseName:function(a){var b=a.split("/");return this.isFolder(a)?b[b.length-2]+"/":b[b.length-1]},cleanPath:function(a){return a.replace(/\/+/g,"/").split("/").map(encodeURIComponent).join("/").replace(/'/g,"%27")},bindAll:function(a){for(var b in this)"function"==typeof a[b]&&(a[b]=a[b].bind(a))},equal:function(a,b,c){var d;if(c=c||[],typeof a!=typeof b)return!1;if("number"==typeof a||"boolean"==typeof a||"string"==typeof a)return a===b;if("function"==typeof a)return a.toString()===b.toString();if(a instanceof ArrayBuffer&&b instanceof ArrayBuffer&&(a=new Uint8Array(a),b=new Uint8Array(b)),a instanceof Array){if(a.length!==b.length)return!1;for(var e=0,f=a.length;f>e;e++)if(!RemoteStorage.util.equal(a[e],b[e],c))return!1}else{for(d in a)if(a.hasOwnProperty(d)&&!(d in b))return!1;for(d in b)if(b.hasOwnProperty(d)){if(!(d in a))return!1;var g;if("object"==typeof b[d]){if(c.indexOf(b[d])>=0)continue;g=c.slice(),g.push(b[d])}if(!RemoteStorage.util.equal(a[d],b[d],g))return!1}}return!0},equalObj:function(a,b){return console.warn("DEPRECATION WARNING: RemoteStorage.util.equalObj has been replaced by RemoteStorage.util.equal."),RemoteStorage.util.equal(a,b)},deepClone:function(a){var c;return void 0===a?void 0:(c=JSON.parse(JSON.stringify(a)),b(a,c),c)},pathsFromRoot:function(a){for(var b=[a],c=a.replace(/\/$/,"").split("/");c.length>1;)c.pop(),b.push(c.join("/")+"/");return b},md5sum:function(a){function b(a,b){var c=a[0],h=a[1],i=a[2],j=a[3];c=d(c,h,i,j,b[0],7,-680876936),j=d(j,c,h,i,b[1],12,-389564586),i=d(i,j,c,h,b[2],17,606105819),h=d(h,i,j,c,b[3],22,-1044525330),c=d(c,h,i,j,b[4],7,-176418897),j=d(j,c,h,i,b[5],12,1200080426),i=d(i,j,c,h,b[6],17,-1473231341),h=d(h,i,j,c,b[7],22,-45705983),c=d(c,h,i,j,b[8],7,1770035416),j=d(j,c,h,i,b[9],12,-1958414417),i=d(i,j,c,h,b[10],17,-42063),h=d(h,i,j,c,b[11],22,-1990404162),c=d(c,h,i,j,b[12],7,1804603682),j=d(j,c,h,i,b[13],12,-40341101),i=d(i,j,c,h,b[14],17,-1502002290),h=d(h,i,j,c,b[15],22,1236535329),c=e(c,h,i,j,b[1],5,-165796510),j=e(j,c,h,i,b[6],9,-1069501632),i=e(i,j,c,h,b[11],14,643717713),h=e(h,i,j,c,b[0],20,-373897302),c=e(c,h,i,j,b[5],5,-701558691),j=e(j,c,h,i,b[10],9,38016083),i=e(i,j,c,h,b[15],14,-660478335),h=e(h,i,j,c,b[4],20,-405537848),c=e(c,h,i,j,b[9],5,568446438),j=e(j,c,h,i,b[14],9,-1019803690),i=e(i,j,c,h,b[3],14,-187363961),h=e(h,i,j,c,b[8],20,1163531501),c=e(c,h,i,j,b[13],5,-1444681467),j=e(j,c,h,i,b[2],9,-51403784),i=e(i,j,c,h,b[7],14,1735328473),h=e(h,i,j,c,b[12],20,-1926607734),c=f(c,h,i,j,b[5],4,-378558),j=f(j,c,h,i,b[8],11,-2022574463),i=f(i,j,c,h,b[11],16,1839030562),h=f(h,i,j,c,b[14],23,-35309556),c=f(c,h,i,j,b[1],4,-1530992060),j=f(j,c,h,i,b[4],11,1272893353),i=f(i,j,c,h,b[7],16,-155497632),h=f(h,i,j,c,b[10],23,-1094730640),c=f(c,h,i,j,b[13],4,681279174),j=f(j,c,h,i,b[0],11,-358537222),i=f(i,j,c,h,b[3],16,-722521979),h=f(h,i,j,c,b[6],23,76029189),c=f(c,h,i,j,b[9],4,-640364487),j=f(j,c,h,i,b[12],11,-421815835),i=f(i,j,c,h,b[15],16,530742520),h=f(h,i,j,c,b[2],23,-995338651),c=g(c,h,i,j,b[0],6,-198630844),j=g(j,c,h,i,b[7],10,1126891415),i=g(i,j,c,h,b[14],15,-1416354905),h=g(h,i,j,c,b[5],21,-57434055),c=g(c,h,i,j,b[12],6,1700485571),j=g(j,c,h,i,b[3],10,-1894986606),i=g(i,j,c,h,b[10],15,-1051523),h=g(h,i,j,c,b[1],21,-2054922799),c=g(c,h,i,j,b[8],6,1873313359),j=g(j,c,h,i,b[15],10,-30611744),i=g(i,j,c,h,b[6],15,-1560198380),h=g(h,i,j,c,b[13],21,1309151649),c=g(c,h,i,j,b[4],6,-145523070),j=g(j,c,h,i,b[11],10,-1120210379),i=g(i,j,c,h,b[2],15,718787259),h=g(h,i,j,c,b[9],21,-343485551),a[0]=n(c,a[0]),a[1]=n(h,a[1]),a[2]=n(i,a[2]),a[3]=n(j,a[3])}function c(a,b,c,d,e,f){return b=n(n(b,a),n(d,f)),n(b<<e|b>>>32-e,c)}function d(a,b,d,e,f,g,h){return c(b&d|~b&e,a,b,f,g,h)}function e(a,b,d,e,f,g,h){return c(b&e|d&~e,a,b,f,g,h)}function f(a,b,d,e,f,g,h){return c(b^d^e,a,b,f,g,h)}function g(a,b,d,e,f,g,h){return c(d^(b|~e),a,b,f,g,h)}function h(a){txt="";var c,d=a.length,e=[1732584193,-271733879,-1732584194,271733878];for(c=64;c<=a.length;c+=64)b(e,i(a.substring(c-64,c)));a=a.substring(c-64);var f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(c=0;c<a.length;c++)f[c>>2]|=a.charCodeAt(c)<<(c%4<<3);if(f[c>>2]|=128<<(c%4<<3),c>55)for(b(e,f),c=0;16>c;c++)f[c]=0;return f[14]=8*d,b(e,f),e}function i(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c}function j(a){for(var b="",c=0;4>c;c++)b+=m[a>>8*c+4&15]+m[a>>8*c&15];return b}function k(a){for(var b=0;b<a.length;b++)a[b]=j(a[b]);return a.join("")}function l(a){return k(h(a))}var m="0123456789abcdef".split(""),n=function(a,b){return a+b&4294967295};return"5d41402abc4b2a76b9719d911017c592"!==l("hello")&&(n=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),l(a)},localStorageAvailable:function(){if(!("localStorage"in a))return!1;try{return a.localStorage.setItem("rs-check",1),a.localStorage.removeItem("rs-check"),!0}catch(a){return!1}}},RemoteStorage.prototype.util||Object.defineProperty(RemoteStorage.prototype,"util",{get:function(){return console.log("DEPRECATION WARNING: remoteStorage.util was moved to RemoteStorage.util"),RemoteStorage.util}})}("undefined"!=typeof window?window:global),function(a){var b={addEventListener:function(a,b){if("string"!=typeof a)throw new Error("Argument eventName should be a string");if("function"!=typeof b)throw new Error("Argument handler should be a function");RemoteStorage.log("[Eventhandling] Adding event listener",a,b),this._validateEvent(a),this._handlers[a].push(b)},removeEventListener:function(a,b){this._validateEvent(a);for(var c=this._handlers[a].length,d=0;c>d;d++)if(this._handlers[a][d]===b)return void this._handlers[a].splice(d,1)},_emit:function(a){this._validateEvent(a);var b=Array.prototype.slice.call(arguments,1);this._handlers[a].slice().forEach(function(a){a.apply(this,b)})},_validateEvent:function(a){if(!(a in this._handlers))throw new Error("Unknown event: "+a)},_delegateEvent:function(a,b){b.on(a,function(b){this._emit(a,b)}.bind(this))},_addEvent:function(a){this._handlers[a]=[]}};b.on=b.addEventListener,RemoteStorage.eventHandling=function(a){var c=Array.prototype.slice.call(arguments,1);for(var d in b)a[d]=b[d];a._handlers={},c.forEach(function(b){a._addEvent(b)})}}("undefined"!=typeof window?window:global),function(a){function b(a){return"string"!=typeof a?a:"*"===a?"*":'"'+a+'"'}function c(a){return"string"!=typeof a?a:a.replace(/^["']|["']$/g,"")}function d(b,c,d){var e;if(a.BlobBuilder=a.BlobBuilder||a.WebKitBlobBuilder,"undefined"!=typeof a.BlobBuilder){var f=new a.BlobBuilder;f.append(b),e=f.getBlob(c)}else e=new Blob([b],{type:c});var g=new FileReader;"function"==typeof g.addEventListener?g.addEventListener("loadend",function(){d(g.result)}):g.onloadend=function(){d(g.result)},g.readAsArrayBuffer(e)}function e(b,c){var d=Promise.defer();if("undefined"==typeof Blob){var e=new Buffer(new Uint8Array(b));d.resolve(e.toString(c))}else{var f;if(a.BlobBuilder=a.BlobBuilder||a.WebKitBlobBuilder,"undefined"!=typeof a.BlobBuilder){var g=new a.BlobBuilder;g.append(b),f=g.getBlob()}else f=new Blob([b]);var h=new FileReader;"function"==typeof h.addEventListener?h.addEventListener("loadend",function(a){d.resolve(a.target.result)}):h.onloadend=function(a){d.resolve(a.target.result)},h.readAsText(f,c)}return d.promise}function f(a){var b,c="UTF-8";return a&&(b=a.match(/charset=(.+)$/),b&&(c=b[1])),c}function g(a){return"http://remotestorage.io/spec/folder-description"===a["@context"]&&"object"==typeof a.items}function h(a){return[201,204,304].indexOf(a)>=0}function i(a){return[401,403,404,412].indexOf(a)>=0}var j,k,l=RemoteStorage,m="remotestorage:wireclient",n=1,o=2,p=3,q=4,r=5,s={"draft-dejong-remotestorage-00":o,"draft-dejong-remotestorage-01":p,"draft-dejong-remotestorage-02":q,"https://www.w3.org/community/rww/wiki/read-write-web-00#simple":n};if("function"==typeof ArrayBufferView)k=function(a){return a&&a instanceof ArrayBufferView};else{var t=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];k=function(a){for(var b=0;8>b;b++)if(a instanceof t[b])return!0;return!1}}var u,v=RemoteStorage.util.isFolder,w=RemoteStorage.util.cleanPath;l.WireClient=function(a){if(this.rs=a,this.connected=!1,l.eventHandling(this,"change","connected","not-connected","wire-busy","wire-done"),u=function(a){a instanceof RemoteStorage.Unauthorized&&this.configure({token:null})}.bind(this),a.on("error",u),j){var b;try{b=JSON.parse(localStorage[m])}catch(a){}b&&setTimeout(function(){this.configure(b)}.bind(this),0)}this._revisionCache={},this.connected&&setTimeout(this._emit.bind(this),0,"connected")},l.WireClient.REQUEST_TIMEOUT=3e4,l.WireClient.prototype={_request:function(a,b,d,g,j,k,m){if(("PUT"===a||"DELETE"===a)&&"/"===b[b.length-1])return Promise.reject("Don't "+a+" on directories!");var n,o=this;return d!==RemoteStorage.Authorize.IMPLIED_FAKE_TOKEN&&(g.Authorization="Bearer "+d),this._emit("wire-busy",{method:a,isFolder:v(b)}),l.WireClient.request(a,b,{body:j,headers:g,responseType:"arraybuffer"}).then(function(d){if(o.online||(o.online=!0,o.rs._emit("network-online")),o._emit("wire-done",{method:a,isFolder:v(b),success:!0}),i(d.status))return RemoteStorage.log("[WireClient] Error response status",d.status),n=k?c(d.getResponseHeader("ETag")):void 0,Promise.resolve({statusCode:d.status,revision:n});if(h(d.status)||200===d.status&&"GET"!==a)return n=c(d.getResponseHeader("ETag")),RemoteStorage.log("[WireClient] Successful request",n),Promise.resolve({statusCode:d.status,revision:n});var g=d.getResponseHeader("Content-Type");n=k?c(d.getResponseHeader("ETag")):200===d.status?m:void 0;var j=f(g);return g&&"binary"!==j?e(d.response,j).then(function(a){return RemoteStorage.log("[WireClient] Successful request",n),Promise.resolve({statusCode:d.status,body:a,contentType:g,revision:n})}):(RemoteStorage.log("[WireClient] Successful request with unknown or binary mime-type",n),Promise.resolve({statusCode:d.status,body:d.response,contentType:g,revision:n}))},function(c){return o.online&&(o.online=!1,o.rs._emit("network-offline")),o._emit("wire-done",{method:a,isFolder:v(b),success:!1}),Promise.reject(c)})},configure:function(a){if("object"!=typeof a)throw new Error("WireClient configure settings parameter should be an object");"undefined"!=typeof a.userAddress&&(this.userAddress=a.userAddress),"undefined"!=typeof a.href&&(this.href=a.href),"undefined"!=typeof a.storageApi&&(this.storageApi=a.storageApi),"undefined"!=typeof a.token&&(this.token=a.token),"undefined"!=typeof a.properties&&(this.properties=a.properties),"undefined"!=typeof this.storageApi&&(this._storageApi=s[this.storageApi]||r,this.supportsRevs=this._storageApi>=o),this.href&&this.token?(this.connected=!0,this.online=!0,this._emit("connected")):this.connected=!1,j&&(localStorage[m]=JSON.stringify({userAddress:this.userAddress,href:this.href,storageApi:this.storageApi,token:this.token,properties:this.properties}))},stopWaitingForToken:function(){this.connected||this._emit("not-connected")},get:function(a,c){var d=this;if(!this.connected)return Promise.reject("not connected (path: "+a+")");c||(c={});var e={};return this.supportsRevs?c.ifNoneMatch&&(e["If-None-Match"]=b(c.ifNoneMatch)):c.ifNoneMatch&&this._revisionCache[a],this._request("GET",this.href+w(a),this.token,e,void 0,this.supportsRevs,this._revisionCache[a]).then(function(b){if(!v(a))return Promise.resolve(b);var c={};if("undefined"!=typeof b.body)try{b.body=JSON.parse(b.body)}catch(b){return Promise.reject("Folder description at "+d.href+w(a)+" is not JSON")}if(200===b.statusCode&&"object"==typeof b.body){if(0===Object.keys(b.body).length)b.statusCode=404;else if(g(b.body)){for(var e in b.body.items)d._revisionCache[a+e]=b.body.items[e].ETag;c=b.body.items}else Object.keys(b.body).forEach(function(e){d._revisionCache[a+e]=b.body[e],c[e]={ETag:b.body[e]}});return b.body=c,Promise.resolve(b)}return Promise.resolve(b)})},put:function(a,c,d,e){if(!this.connected)return Promise.reject("not connected (path: "+a+")");e||(e={}),!d.match(/charset=/)&&(c instanceof ArrayBuffer||k(c))&&(d+="; charset=binary");var f={"Content-Type":d};return this.supportsRevs&&(e.ifMatch&&(f["If-Match"]=b(e.ifMatch)),e.ifNoneMatch&&(f["If-None-Match"]=b(e.ifNoneMatch))),this._request("PUT",this.href+w(a),this.token,f,c,this.supportsRevs)},delete:function(a,c){if(!this.connected)throw new Error("not connected (path: "+a+")");c||(c={});var d={};return this.supportsRevs&&c.ifMatch&&(d["If-Match"]=b(c.ifMatch)),this._request("DELETE",this.href+w(a),this.token,d,void 0,this.supportsRevs);
}},l.WireClient.cleanPath=w,l.WireClient.isArrayBufferView=k,l.WireClient.readBinaryData=d,l.WireClient.request=function(a,b,c){var d=Promise.defer();RemoteStorage.log("[WireClient]",a,b);var e=!1,f=setTimeout(function(){e=!0,d.reject("timeout")},l.WireClient.REQUEST_TIMEOUT),g=new XMLHttpRequest;if(g.open(a,b,!0),c.responseType&&(g.responseType=c.responseType),c.headers)for(var h in c.headers)g.setRequestHeader(h,c.headers[h]);g.onload=function(){e||(clearTimeout(f),d.resolve(g))},g.onerror=function(a){e||(clearTimeout(f),d.reject(a))};var i=c.body;return"object"==typeof i&&!k(i)&&i instanceof ArrayBuffer&&(i=new Uint8Array(i)),g.send(i),d.promise},Object.defineProperty(RemoteStorage.WireClient.prototype,"storageType",{get:function(){if(this.storageApi){var a=this.storageApi.match(/draft-dejong-(remotestorage-\d\d)/);return a?a[1]:"2012.04"}}}),l.WireClient._rs_init=function(a){j=RemoteStorage.util.localStorageAvailable(),a.remote=new l.WireClient(a),this.online=!0},l.WireClient._rs_supported=function(){return!!a.XMLHttpRequest},l.WireClient._rs_cleanup=function(a){j&&delete localStorage[m],a.removeEventListener("error",u)}}("undefined"!=typeof window?window:global),function(a){var b,c,d="remotestorage:discover",e={};RemoteStorage.Discover=function(a){if(a in e)return Promise.resolve(e[a]);var b=new WebFinger({tls_only:!1,uri_fallback:!0,request_timeout:5e3}),f=Promise.defer();return b.lookup(a,function(b,g){if(b)return f.reject(b);if("object"!=typeof g.idx.links.remotestorage||"number"!=typeof g.idx.links.remotestorage.length||g.idx.links.remotestorage.length<=0)return RemoteStorage.log("[Discover] WebFinger record for "+a+" does not have remotestorage defined in the links section ",JSON.stringify(g.json)),f.reject("WebFinger record for "+a+" does not have remotestorage defined in the links section.");var h=g.idx.links.remotestorage[0],i=h.properties["http://tools.ietf.org/html/rfc6749#section-4.2"]||h.properties["auth-endpoint"],j=h.properties["http://remotestorage.io/spec/version"]||h.type;return e[a]={href:h.href,storageType:j,authURL:i,properties:h.properties},c&&(localStorage[d]=JSON.stringify({cache:e})),f.resolve(e[a])}),f.promise},RemoteStorage.Discover._rs_init=function(a){if(c=RemoteStorage.util.localStorageAvailable()){var b;try{b=JSON.parse(localStorage[d])}catch(a){}b&&(e=b.cache)}},RemoteStorage.Discover._rs_supported=function(){return b=!!a.XMLHttpRequest},RemoteStorage.Discover._rs_cleanup=function(){c&&delete localStorage[d]}}("undefined"!=typeof window?window:global),"undefined"==typeof XMLHttpRequest&&(XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest),function(a){function b(a){return a.toString=function(){return this.message},a}function c(a){if("string"!=typeof a)return!1;var b=a.split("://");return"https"===b[0]}function d(a){"object"!=typeof a&&(a={}),this.config={tls_only:"undefined"==typeof a.tls_only||a.tls_only,webfist_fallback:"undefined"!=typeof a.webfist_fallback&&a.webfist_fallback,uri_fallback:"undefined"!=typeof a.uri_fallback&&a.uri_fallback,request_timeout:"undefined"!=typeof a.request_timeout?a.request_timeout:1e4}}var e={"http://webfist.org/spec/rel":"webfist","http://webfinger.net/rel/avatar":"avatar",remotestorage:"remotestorage","http://tools.ietf.org/id/draft-dejong-remotestorage":"remotestorage",remoteStorage:"remotestorage","http://www.packetizer.com/rel/share":"share","http://webfinger.net/rel/profile-page":"profile",me:"profile",vcard:"vcard",blog:"blog","http://packetizer.com/rel/blog":"blog","http://schemas.google.com/g/2010#updates-from":"updates","https://camlistore.org/rel/server":"camilstore"},f={avatar:[],remotestorage:[],blog:[],vcard:[],updates:[],share:[],profile:[],webfist:[],camlistore:[]},g=["webfinger","host-meta","host-meta.json"];if(d.prototype.__fetchJRD=function(a,d,e){function f(){if(200===i.status)return h.__isValidJSON(i.responseText)?e(i.responseText):d(b({message:"invalid json",url:a,status:i.status}));if(404===i.status)return d(b({message:"resource not found",url:a,status:i.status}));if(i.status>=301&&i.status<=302){var f=i.getResponseHeader("Location");return c(f)?g(f):d(b({message:"no redirect URL found",url:a,status:i.status}))}return d(b({message:"error during request",url:a,status:i.status}))}function g(){i.onreadystatechange=function(){4===i.readyState&&f()},i.onload=function(a,b){f()},i.open("GET",a,!0),i.setRequestHeader("Accept","application/jrd+json, application/json"),i.send()}var h=this,i=new XMLHttpRequest;return g()},d.prototype.__isValidJSON=function(a){try{JSON.parse(a)}catch(a){return!1}return!0},d.prototype.__isLocalhost=function(a){var b=/^localhost(\.localdomain)?(\:[0-9]+)?$/;return b.test(a)},d.prototype.__processJRD=function(c,d,g,h){var i=JSON.parse(d);if("object"!=typeof i||"object"!=typeof i.links)return g(b("undefined"!=typeof i.error?{message:i.error,request:c}:{message:"unknown response from server",request:c}));var j=i.links,k={object:i,json:d,idx:{}};k.idx.properties={name:a},k.idx.links=JSON.parse(JSON.stringify(f)),j.map(function(a,b){if(e.hasOwnProperty(a.rel)&&k.idx.links[e[a.rel]]){var c={};Object.keys(a).map(function(b,d){c[b]=a[b]}),k.idx.links[e[a.rel]].push(c)}});var l=JSON.parse(d).properties;for(var m in l)l.hasOwnProperty(m)&&"http://packetizer.com/ns/name"===m&&(k.idx.properties.name=l[m]);return h(k)},d.prototype.lookup=function(a,b){function c(){var b="";return a.split("://")[1]||(b="acct:"),j+"://"+h+"/.well-known/"+g[i]+"?resource="+b+a}function d(a){if(f.config.uri_fallback&&"webfist.org"!==h&&i!==g.length-1)return i+=1,e();if(!f.config.tls_only&&"https"===j)return i=0,j="http",e();if(!f.config.webfist_fallback||"webfist.org"===h)return b(a);i=0,j="http",h="webfist.org";var d=c();f.__fetchJRD(d,b,function(a){f.__processJRD(d,a,b,function(a){"object"==typeof a.idx.links.webfist&&"string"==typeof a.idx.links.webfist[0].href&&f.__fetchJRD(a.idx.links.webfist[0].href,b,function(a){f.__processJRD(d,a,b,function(a){return b(null,b)})})})})}function e(){var a=c();f.__fetchJRD(a,d,function(c){f.__processJRD(a,c,b,function(a){b(null,a)})})}if("string"!=typeof a)throw new Error("first parameter must be a user address");if("function"!=typeof b)throw new Error("second parameter must be a callback");var f=this,h="";h=a.indexOf("://")>-1?a.replace(/ /g,"").split("://")[1]:a.replace(/ /g,"").split("@")[1];var i=0,j="https";return f.__isLocalhost(h)&&(j="http"),setTimeout(e,0)},d.prototype.lookupLink=function(a,b,c){return f.hasOwnProperty(b)?void this.lookup(a,function(a,d){var e=d.idx.links[b];return a?c(a):0===e.length?c('no links found with rel="'+b+'"'):c(null,e[0])}):c("unsupported rel "+b)},"object"==typeof window)window.WebFinger=d;else if("function"==typeof define&&define.amd)define([],function(){return d});else try{module.exports=d}catch(a){}}(),function(a){function b(a){var b,c=a||RemoteStorage.Authorize.getLocation().href,d=c.indexOf("#");if(-1!==d&&(b=c.substring(d+1),-1!==b.indexOf("=")))return b.split("&").reduce(function(a,b){var c=b.split("=");if("state"===c[0]&&c[1].match(/rsDiscovery/)){var d=decodeURIComponent(c[1]),e=d.substr(d.indexOf("rsDiscovery=")).split("&")[0].split("=")[1];a.rsDiscovery=JSON.parse(atob(e)),d=d.replace(new RegExp("&?rsDiscovery="+e),""),d.length>0&&(a.state=d)}else a[decodeURIComponent(c[0])]=decodeURIComponent(c[1]);return a},{})}RemoteStorage.ImpliedAuth=function(a,b){RemoteStorage.log("ImpliedAuth proceeding due to absent authURL; storageApi = "+a+" redirectUri = "+b),remoteStorage.remote.configure({token:RemoteStorage.Authorize.IMPLIED_FAKE_TOKEN}),document.location=b},RemoteStorage.Authorize=function(b,c,d,e,f){if(RemoteStorage.log("[Authorize] authURL = ",c,"scope = ",d,"redirectUri = ",e,"clientId = ",f),!RemoteStorage.util.localStorageAvailable()&&"remotestorage"===b.backend){e+=e.indexOf("#")>0?"&":"#";var g={userAddress:b.remote.userAddress,href:b.remote.href,storageApi:b.remote.storageApi,properties:b.remote.properties};e+="rsDiscovery="+btoa(JSON.stringify(g))}var h=c,i=e.indexOf("#");return h+=c.indexOf("?")>0?"&":"?",h+="redirect_uri="+encodeURIComponent(e.replace(/#.*$/,"")),h+="&scope="+encodeURIComponent(d),h+="&client_id="+encodeURIComponent(f),-1!==i&&i+1!==e.length&&(h+="&state="+encodeURIComponent(e.substring(i+1))),h+="&response_type=token",a.cordova?RemoteStorage.Authorize.openWindow(h,e,"location=yes,clearsessioncache=yes,clearcache=yes").then(function(a){b.remote.configure({token:a.access_token})}).then(null,function(a){console.error(a),b.widget.view.setState("initial")}):void RemoteStorage.Authorize.setLocation(h)},RemoteStorage.Authorize.IMPLIED_FAKE_TOKEN=!1,RemoteStorage.prototype.authorize=function(b,c){this.access.setStorageType(this.remote.storageType);var d=this.access.scopeParameter,e=a.cordova?c:String(RemoteStorage.Authorize.getLocation()),f=e.match(/^(https?:\/\/[^\/]+)/)[0];RemoteStorage.Authorize(this,b,d,e,f)},RemoteStorage.Authorize.getLocation=function(){return a.document.location},RemoteStorage.Authorize.setLocation=function(b){if("string"==typeof b)a.document.location.href=b;else{if("object"!=typeof b)throw"Invalid location "+b;a.document.location=b}},RemoteStorage.Authorize.openWindow=function(c,d,e){var f=Promise.defer(),g=a.open(c,"_blank",e);if(!g||g.closed)return f.reject("Authorization popup was blocked"),f.promise;var h=function(){f.reject("Authorization was canceled")},i=function(a){if(0===a.url.indexOf(d)){g.removeEventListener("exit",h),g.close();var c=b(a.url);return c?f.resolve(c):f.reject("Authorization error")}};return g.addEventListener("loadstart",i),g.addEventListener("exit",h),f.promise},RemoteStorage.prototype.impliedauth=function(){RemoteStorage.ImpliedAuth(this.remote.storageApi,String(document.location))},RemoteStorage.Authorize._rs_supported=function(){return"undefined"!=typeof document};var c;RemoteStorage.Authorize._rs_init=function(a){c=function(){var b=!1;if(e){if(e.error)throw"Authorization server errored: "+e.error;e.rsDiscovery&&a.remote.configure(e.rsDiscovery),e.access_token&&(a.remote.configure({token:e.access_token}),b=!0),e.remotestorage&&(a.connect(e.remotestorage),b=!0),e.state&&(d=RemoteStorage.Authorize.getLocation(),RemoteStorage.Authorize.setLocation(d.href.split("#")[0]+"#"+e.state))}b||a.remote.stopWaitingForToken()};var d,e=b();e&&(d=RemoteStorage.Authorize.getLocation(),d.hash=""),a.on("features-loaded",c)},RemoteStorage.Authorize._rs_cleanup=function(a){a.removeEventListener("features-loaded",c)}}("undefined"!=typeof window?window:global),function(a){RemoteStorage.Access=function(){this.reset()},RemoteStorage.Access.prototype={claim:function(a,b){if("string"!=typeof a||-1!==a.indexOf("/")||0===a.length)throw new Error("Scope should be a non-empty string without forward slashes");if(!b.match(/^rw?$/))throw new Error("Mode should be either 'r' or 'rw'");this._adjustRootPaths(a),this.scopeModeMap[a]=b},get:function(a){return this.scopeModeMap[a]},remove:function(a){var b,c={};for(b in this.scopeModeMap)c[b]=this.scopeModeMap[b];this.reset(),delete c[a];for(b in c)this.set(b,c[b])},checkPermission:function(a,b){var c=this.get(a);return c&&("r"===b||"rw"===c)},checkPathPermission:function(a,b){return!!this.checkPermission("*",b)||!!this.checkPermission(this._getModuleName(a),b)},reset:function(){this.rootPaths=[],this.scopeModeMap={}},_getModuleName:function(a){if("/"!==a[0])throw new Error("Path should start with a slash");var b=a.replace(/^\/public/,"").match(/^\/([^\/]*)\//);return b?b[1]:"*"},_adjustRootPaths:function(a){"*"in this.scopeModeMap||"*"===a?this.rootPaths=["/"]:a in this.scopeModeMap||(this.rootPaths.push("/"+a+"/"),this.rootPaths.push("/public/"+a+"/"))},_scopeNameForParameter:function(a){if("*"===a.name&&this.storageType){if("2012.04"===this.storageType)return"";if(this.storageType.match(/remotestorage-0[01]/))return"root"}return a.name},setStorageType:function(a){this.storageType=a}},Object.defineProperty(RemoteStorage.Access.prototype,"scopes",{get:function(){return Object.keys(this.scopeModeMap).map(function(a){return{name:a,mode:this.scopeModeMap[a]}}.bind(this))}}),Object.defineProperty(RemoteStorage.Access.prototype,"scopeParameter",{get:function(){return this.scopes.map(function(a){return this._scopeNameForParameter(a)+":"+a.mode}.bind(this)).join(" ")}}),Object.defineProperty(RemoteStorage.prototype,"access",{get:function(){var a=new RemoteStorage.Access;return Object.defineProperty(this,"access",{value:a}),a},configurable:!0}),RemoteStorage.Access._rs_init=function(){}}("undefined"!=typeof window?window:global),function(a){var b=a,c={},d=!1;RemoteStorage.Env=function(){return c},RemoteStorage.Env.isBrowser=function(){return"browser"===b},RemoteStorage.Env.isNode=function(){return"node"===b},RemoteStorage.Env.goBackground=function(){d=!0,RemoteStorage.Env._emit("background")},RemoteStorage.Env.goForeground=function(){d=!1,RemoteStorage.Env._emit("foreground")},RemoteStorage.Env._rs_init=function(a){function d(){document[c.hiddenProperty]?RemoteStorage.Env.goBackground():RemoteStorage.Env.goForeground()}RemoteStorage.eventHandling(RemoteStorage.Env,"background","foreground"),"browser"===b&&("undefined"!=typeof document.hidden?(c.hiddenProperty="hidden",c.visibilityChangeEvent="visibilitychange"):"undefined"!=typeof document.mozHidden?(c.hiddenProperty="mozHidden",c.visibilityChangeEvent="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(c.hiddenProperty="msHidden",c.visibilityChangeEvent="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(c.hiddenProperty="webkitHidden",c.visibilityChangeEvent="webkitvisibilitychange"),document.addEventListener(c.visibilityChangeEvent,d,!1),d())},RemoteStorage.Env._rs_cleanup=function(a){}}("undefined"!=typeof window?"browser":"node"),function(){"use strict";var a={view_info:'This app allows you to use your own storage. <a href="http://remotestorage.io/" target="_blank">Learn more!</a>',view_connect:"<strong>Connect</strong> remote storage",view_connecting:"Connecting <strong>%s</strong>",view_offline:"Offline",view_error_occured:"Sorry! An error occured.",view_invalid_key:"Wrong key!",view_confirm_reset:"Are you sure you want to reset everything? This will clear your local data and reload the page.",view_get_me_out:"Get me out of here!",view_error_plz_report:'If this problem persists, please <a href="http://remotestorage.io/community/" target="_blank">let us know</a>!',view_unauthorized:"Unauthorized! Click here to reconnect."};RemoteStorage.I18n={translate:function(){var b=arguments[0],c=Array.prototype.splice.call(arguments,1);if("string"!=typeof a[b])throw"Unknown translation string: "+b;return b=a[b],b.replace(/%s/g,function(){return c.shift()})},getDictionary:function(){return a},setDictionary:function(b){a=b},_rs_init:function(){}}}(),RemoteStorage.Assets={cipherIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTQiIHdpZHRoPSIyNS4xNzciIHZlcnNpb249IjEuMSIgeG1sbnM6Y2M9Imh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL25zIyIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxwYXRoIGQ9Im0yNS4xNzcgNS41MzIzYy0wLjA1NjQtMC4xMTI5MS0wLjA1NjQtMC4yMjU4MS0wLjE2OTM2LTAuMzM4NzEtMC4xMTI5LTAuMTEyOS0wLjI4MjI1LTAuMTY5MzYtMC4zOTUxNi0wLjE2OTM2aC0xMS40MDNjLTAuNzMzLTIuODc5LTMuMzg2NC01LjAyNDItNi40OTEzLTUuMDI0Mi0zLjY2OTMgMC02LjcxNzcgMy4wNDg0LTYuNzE3NyA2LjcxNzcgMCAzLjcyNjMgMy4wNDg0IDYuNzE3MyA2LjcxNzcgNi43MTczIDMuMzMwNyAwIDYuMDQwMy0yLjQyNzQgNi42MDQ4LTUuNTg4N2gyLjU0MDN2My42Njk0YzAgMC4yODIyNiAwLjI4MjI2IDAuNTA4MDYgMC41NjQ1MiAwLjUwODA2aDEuNzVjMC4yODIyNiAwIDAuNTY0NTItMC4yMjU4IDAuNTY0NTItMC41MDgwNnYtMy42Njk0aDEuNDY3N3Y1LjY0NTJjMCAwLjI4MjI1IDAuMjI1OCAwLjUwODA2IDAuNTA4MDYgMC41MDgwNmgxLjgwNjRjMC4yODIyNiAwIDAuNTA4MDctMC4yMjU4MSAwLjU2NDUyLTAuNTA4MDZ2LTUuNjQ1MmgxLjUyNDJjMC4xMTI5MSAwIDAuMjgyMjYgMCAwLjM5NTE2LTAuMTEyOSAwLjExMjkxLTAuMTEyOSAwLjE2OTM2LTAuMjgyMjYgMC4xNjkzNi0wLjM5NTE2di0xLjgwNjR6bS0xOC40NTkgNS4wODA3Yy0yLjA4ODcgMC0zLjgzODctMS42OTM2LTMuODM4Ny0zLjgzODcgMC0yLjE0NTIgMS43NS0zLjgzODcgMy44Mzg3LTMuODM4NyAyLjE0NTIgMCAzLjgzODcgMS42OTM2IDMuODM4NyAzLjgzODcgMCAyLjE0NTItMS42OTM2IDMuODM4Ny0zLjgzODcgMy44Mzg3eiIgZmlsbD0iI2ZmZiIvPgo8L3N2Zz4K",connectIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTYiIHdpZHRoPSIxNiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMCAtMTAzNi40KSI+CiAgPHBhdGggZD0ibTEgMTA0Ny40di02aDd2LTRsNyA3LTcgN3YtNHoiIGZpbGw9IiNmZmYiLz4KIDwvZz4KPC9zdmc+Cg==",disconnectIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTYiIHdpZHRoPSIxNiIgdmVyc2lvbj0iMS4wIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxwYXRoIHN0eWxlPSJibG9jay1wcm9ncmVzc2lvbjp0Yjt0ZXh0LWluZGVudDowO2NvbG9yOiMwMDAwMDA7dGV4dC10cmFuc2Zvcm06bm9uZSIgZD0ibTguMDAwMSAwYy0wLjQ3MTQgMC0wLjk2MTAzIDAuNTQxOS0wLjk1IDF2NmMtMC4wMDc0NyAwLjUyODMxIDAuNDIxNjMgMSAwLjk1IDFzMC45NTc0Ny0wLjQ3MTY5IDAuOTUtMXYtNmMwLjAxNDYyMi0wLjYwNTEtMC40Nzg2LTEtMC45NS0xem0tMy4zNDM4IDIuNWMtMC4wODcxODYgMC4wMTkyOTQtMC4xNzE2MyAwLjA1MDk1OS0wLjI1IDAuMDkzNzUtMi45OTk1IDEuNTcxNS0zLjkxODQgNC43OTc5LTMuMTI1IDcuNDY4OCAwLjc5MzQgMi42NyAzLjI3OTkgNC45MzcgNi42ODc1IDQuOTM3IDMuMzU5MiAwIDUuODc3Mi0yLjE0OSA2LjcxOTItNC43ODEgMC44NDEtMi42MzIxLTAuMDU4LTUuODIzNC0zLjEyNS03LjU5NC0wLjQzNC0wLjI1MzYtMS4wNTktMC4wODk5LTEuMzEzIDAuMzQzNy0wLjI1MzYgMC40MzM2LTAuMDkgMS4wNTg5IDAuMzQ0IDEuMzEyNSAyLjM5MDggMS4zNzk4IDIuODgyNSAzLjQ5NDQgMi4yODEyIDUuMzc1LTAuNjAxMiAxLjg4MDYtMi4zNDQgMy40Mzc1LTQuOTA2MiAzLjQzNzUtMi41NzU5IDAtNC4yOTc2LTEuNjUwMi00Ljg3NS0zLjU5MzgtMC41Nzc2LTEuOTQzNS0wLjA0Ny00LjA0OCAyLjE4NzMtNS4yMTg3IDAuMzc4Ny0wLjIwNjMgMC41NzkxLTAuNjkyNSAwLjQ1NTgtMS4xMDU3LTAuMTIzMi0wLjQxMzMtMC41NTcyLTAuNzEwMy0wLjk4Ny0wLjY3NTUtMC4wMzEzLTAuMDAxNS0wLjA2MjYtMC4wMDE1LTAuMDkzOCAweiIgZmlsbD0iI2ZmZiIvPgo8L3N2Zz4K",dropbox:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QgPEBAhEOpfuQAABhZJREFUWMPVl31snVUdxz+/5/2577e3b7QbHaOD0nXshW4ZZkpGQmJYZkJUDAaZzCBGAxGd+pdZQsJIjCaKgFu09GWybIggm8yhMCsY92rcOkPHunbdtKOUbX36svX23uc+xz+eDsrWlztiNJzk5D7JPS+fc8739/2dA5+EsqJtyK18ZlCKbX9Lk6fd1uo5xbTVZmtwa4v35Np5Mry4TLYXCzAnyhsry2SwrmnokdnaTruq6i3e0lXl0tqQlkURCxwdDp9Th5p3+p9iS8afqk/VZq9kaZoDN8apdU3B1KFnmLde7AkezH0n3V0UQOJpz2hIsqEhLU+WOeAagmtCxISYBe1nVf4vfWrByYdSpyf3W9ziLapy6JgbAduAiBn2S1rCQBYODAQP7H01/zxby4JpAW5s8mproxypiRKNGIJrQNT8EMA1wTGEU8MBP/q7umPw0dSbAA3N3n3zI2yLG2oScPgbNYWICY4Be86o/le6g0W576bPXQWwcqvXdJ2t1idMsA1hJoCoCRfGYdOhwsa4TUWFrr7pGmDrzAiQCHfD//Xxwk/33Z/6HoA0tnhLXZ3XMoYqsy4PYs4M4Ohg6pB2ddqO+vR6BWL27AARXbBNiBjwh9Oqs+O8ukcT4eaopjLqGsJSCdSX29SX23x/lctXlzgE1zBAANxWIQuGxlWNACxr8WozJp0lljKsGXbA0qGu1GRBxsTUQRAGLgboIuQVvHI8S+f7eeK2TLsDSQd296rhPaeDm09+PdX/gQYqN3uZ+jh7ro+oRusKDdgmVEY1GqstSiOhdegCmoQAIoImIWTPYIHdXVlyBYhaVwLA70+rPz7fllvLi2W5KcPw9q3eS/VJ7kmYgm1A3BIWV5osq7IIlMLUQJOrAXQBXQtr1BR2d2XpOu8TtULR+gq2nQh+vv8rqUdnNaKGZm/9qnJpmp/U+fxCB5lYsaGFdTYAY9L3jmNj9F9S7OgKVh9/KNVelBVf8untv8TYSS8gbsrHyh8C2LqQtGE0z9CJYfVuUblgRZv3WGOJvJG0cF8/lWPNdo+O93xsHYoVuqkL/xzIs/HPHt2DPg0Zko+v0I8vbfHun9aKE5sH9YaobJsf5V4mRLXv33kSlmAYwspqgw23R7A1EJlahKYOSsHTB0cZHQ9IOBA3NSrjGo4hWAY82xH8rH1b/jF2laoPAOb80jPqYtKTMdRcTQNd+xAgbgmuJbiGELfh3lsc7q41KQSTABBcC1qPjLH/XzniNqScsP1kgMsm9nJ34e2mNcmFAMby1qFPZyz1WlxXrprhuEUgUPDbd8Y59n6edbe61KZ1TF14vSfPLw5dYjhXIOMIM6lGAV+u0+tv+ttI/2+6/LsMQVXpUFCAqJkS9MT5anB2NGDjWxf5Yp3DvjN5th/LUhETolaRTqigxMGIWVKtHVyX2tGTJd2X5agUIfi8CmvUFOKGT++gT8wqLlKUgnwATxwq7P32m35Z+32pPQZA54MpH1iSb/XWZmx2VthTD1AATCBlCZ+dpwNg6EJjlUH3hQIKRaCujhZFaOPtfUH+8HvBnQceSP11yjA8vC616+A5FevL8jt/YiCR0HiQcAUVrnDHHO0jHTUNllXrpC0NRXiefjAxM4rhHLzQpZqf+eFFd/LkM17JGlu9p+xC8IgPhGlaqE1rNJZrxOzQok0dnjviY+nhbSntCH3DAWN+QMIWEhYsqTD4wYHChrPfSP9kqnmM6QAMkYtz4xqmDqeGA+rLNObGZVozkglx1ZfqZAvC2ZGAz9RYlEbAlsLoNd+Kx5RqO5/njKXDsnKdhCXFOaFAZUzjznlhyt5xIjiSLbBz2oVO98fRdalOoGZ5m/dUQ4pvJZ3Zr/CXlS5A74gabzlYePztr6U2faxr+eRy/RYvtjgjHauvkxvi9oTDXaGBuAUJWyh1hb3vqsOvfiG5/L/yMAE483BqdNeuXO3LvcGX3vEUhsZVsaYL9IzACz3BXcVOXvQOfKRsupBZv8R4bnW19rmqGPzqHz4BcMGn5U/Hgod5oiT3P3kvVj7rrfnx/pHBu7d7Azc1eY3/l0drzWbPXNjsGXySy38AbtMqneWU7BkAAAAASUVORK5CYII=",googledrive:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QgPEA85ztzJcQAABZVJREFUWMPtl1uoXVcVhr8x5tprn7M1NG1i0pQqSG2jLcXipYJXjPogqFgpaHMSFUkpIjU+leKbDxIQSiHgjZgmrfXgQ6SKj5Ji7YVS05aUUqKQlNLQeDnN5Zzk9Jy99xy/D3OttU/StDlV33TBZM3FXmuMf/5jjv+fG/7XL1vti9tnv3Dtnnf+87JY8YmZNxEMM1sZ7tWpjz764mriVqvKvmfb1ONLy3+dGyWu6EWbvQwoydv5BMSqFuereakmfnls1GP25IDaBGYYjplhljDz5tk7YMtPfurAf6UE9Z6tNwDPAPXwtcxL1x9n4zRgDjjm1gCyC6JpCLoW/OX65of1nzCwG6gNo3aYeXF981mTvK2/WWFiMmoj7X+z5JcE0N87c4e7b3EvyTwZT5/r8ezZHu6GuWGpSegJ8/ZeBu6fHv35s1/7t0rQv29mjWF/ATZ1L4bQwohrpkYc/sBpwhJYAVdKYECzYAESIk4Am3sf+sPCW2LAzb9jbpvMDXfD3fEqkRIcGdbsevlt9LylPYG1K6/K3QzK75uAr78lBgb3b7sc2cl2Uaa21sDiGMvB2iQeu/EMm6bKHjD3SUsCEChnpEAKiLisd/PB+UsyMPjZNwzzh1ixcnOfsFCX51NU/PTvA6pkTUdYw4R3zyu1ArMDqyvBQB82+FiJUQJ4C8YgVT1SSvSTs+vEmkcwe7qEsUnt233Aij0BW4ZPbfngKpRQs7hXpYQNvRiuEtATWOW4bLi+z04pJbCnBAkBJggBQlIBIZCUJM0Cm9+QgcED2+/G7BprdMZaAFZExm1FWcz+NLdj32G/6XfPCB5GoJKp7H5FARHRtgRI1y0/+cm7Lwpg+v7t64DvNd5S2mqirKXHy6RoArp1Ykrc2hKtKCtXlNEyoQ6Ydi498fF1F2FAdwEbV9UnZne+8q19Z7o63vTb+TPnRneeWxwxHGdyziii6wApQNEydKUUd5wHYGrftvci7tKKLSME5bvCaruynI9rNL7vdZgiHhiP898Wl8bMnxty+uyIhcURo1FgjSg1DCDph4uPfuR9AFbvvS25p2cxbiyKVuh2o1O44n2lLLacb5v75v5fX6yl5h753IwUD+YcRAQ5B6FMMhj0jboSRhnAE258wvp7Z7aYcbCYCeCGt97ubfICLDP/q4WZ32x7M20fPfb+hxbH9ZdjHOQIIoR74EDywA3coa6MqtJnrP+LmRmcB63ob8dA1wllRm95LVc//22S16TGeKqqpqoHk10ESGJj/zjjgIhAISKCyJmcY6Uu8Pbq7C0V6ABh35dzvYWQG0QAhmSYCaUlNhzdCrlX2jpE6tV4b9DYcGFKEgG8svQucoicC4CsII8zeTxutAEQzx1duPL3vrxjdlnou0SDLdTulxJQmalXNzN98jpEJiSo+qTeoEnsnWC5lVZNRhkOZiq0G8XCmz1gpp3j/ZYdYLhj9qCkn3fJQ4QKeh9OccWxz6O0hGKM9wakeoBEZ1BmqfOMyYFk4gXS+edG4J4ju6/644VK+AOJhSIYpVRBpn/qPVRL65A51dRavJoG2UQkOqf0hgVrGG7u6syoJDObB+55nRANb589Afy40W0UwkY91h39CiLweg1UU+W3ohLNvC2VurJ1htR6A3QaYPCjI7uvOvGGOlfv2XoSuBzEhmNfZXDqBrweUPVqUlWodneSG+6J1NTevThfDpEjmnsmzuuCPPfCvRvfcakT0S2Aeq9tYPr0ZryeBvOOlZBKUIEiCAVZwTgy41x6v6hm0LFZ4o7N7IuXPA+EDx+XjQ+tP/4lUrW2vCI1ydR0iYgmWdtu4yzG7bOiAdn8iYlA0iFJh1Z1JJv+ye2b3n1419XRH2riP0aqqlKClABIjUMW+rtSlw5qmCpgsynnl56/d+M/+P91wfUvQjDgTzx9h9AAAAAASUVORK5CYII=",nocipherIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMTYiIHdpZHRoPSIxNiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPgogPHBhdGggZD0ibSAxMy4yMDMxMjQsMTEuNzczNDM4IGMgMC4yODEyNSwwLjI4MTI1IDAuNDIxODc1LDAuNjA5Mzc1IDAuNDIxODc1LDEuMDMxMjUgMCwwLjM3NSAtMC4xNDA2MjUsMC43NSAtMC40MjE4NzUsMS4wMzEyNSAtMC4yODEyNSwwLjIzNDM3NSAtMC42MDkzNzUsMC4zNzUgLTEuMDMxMjUsMC4zNzUgLTAuMzc1LDAgLTAuNzUsLTAuMTQwNjI1IC0xLjAzMTI1LC0wLjM3NSAwLDAgLTMuMTg3NDk4MSwtMy42NTYyNSAtMy4xODc0OTgxLC0zLjY1NjI1IDAsMCAtMy4xNDA2MjUsMy42NTYyNSAtMy4xNDA2MjUsMy42NTYyNSAtMC4yODEyNSwwLjIzNDM3NSAtMC42NTYyNSwwLjM3NSAtMS4wMzEyNSwwLjM3NSAtMC40MjE4NzUsMCAtMC43NSwtMC4xNDA2MjUgLTEuMDMxMjUsLTAuMzc1IC0wLjI4MTI1LC0wLjI4MTI1IC0wLjM3NSwtMC42NTYyNSAtMC4zNzUsLTEuMDMxMjUgMCwtMC40MjE4NzUgMC4wOTM3NSwtMC43NSAwLjM3NSwtMS4wMzEyNSAwLDAgMy4zMjgxMjUsLTMuNzUwMDAwNSAzLjMyODEyNSwtMy43NTAwMDA1IDAsMCAtMy4zMjgxMjUsLTMuNzk2ODc1IC0zLjMyODEyNSwtMy43OTY4NzUgLTAuMjgxMjUsLTAuMjgxMjUgLTAuMzc1LC0wLjYwOTM3NSAtMC4zNzUsLTEuMDMxMjUgMCwtMC4zNzUgMC4wOTM3NSwtMC43NSAwLjM3NSwtMS4wMzEyNSAwLjI4MTI1LC0wLjIzNDM3NSAwLjYwOTM3NSwtMC4zNzUgMS4wMzEyNSwtMC4zNzUgMC4zNzUsMCAwLjc1LDAuMTQwNjI1IDEuMDMxMjUsMC4zNzUgMCwwIDMuMTQwNjI1LDMuNjU2MjUgMy4xNDA2MjUsMy42NTYyNSAwLDAgMy4xODc0OTgxLC0zLjY1NjI1IDMuMTg3NDk4MSwtMy42NTYyNSAwLjI4MTI1LC0wLjIzNDM3NSAwLjY1NjI1LC0wLjM3NSAxLjAzMTI1LC0wLjM3NSAwLjQyMTg3NSwwIDAuNzUsMC4xNDA2MjUgMS4wMzEyNSwwLjM3NSAwLjI4MTI1LDAuMjgxMjUgMC40MjE4NzUsMC42NTYyNSAwLjQyMTg3NSwxLjAzMTI1IDAsMC40MjE4NzUgLTAuMTQwNjI1LDAuNzUgLTAuNDIxODc1LDEuMDMxMjUgMCwwIC0zLjMyODEyMzEsMy43OTY4NzUgLTMuMzI4MTIzMSwzLjc5Njg3NSAwLDAgMy4zMjgxMjMxLDMuNzUwMDAwNSAzLjMyODEyMzEsMy43NTAwMDA1IiBmaWxsPSIjZmZmIi8+Cjwvc3ZnPgo=",remoteStorageIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIiIHdpZHRoPSIzMiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0iYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSI1NzEuNDIiIGN4PSIxMDQ2LjUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjE0NDMzIDAgMCAuMTY2NjcgMTIwMS41IDg3Ny4xMSkiIHI9Ijk2Ij4KICAgPHN0b3Agc3RvcC1jb2xvcj0iI2ZmNGEwNCIgc3RvcC1vcGFjaXR5PSIuNzYxNTQiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjZmY0YTA0IiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMzYuNiAtOTU2LjM1KSI+CiAgPHBhdGggc3R5bGU9ImNvbG9yOiMwMDAwMDAiIGQ9Im0xMzUyLjYgOTU2LjM1IDAuMjg4NiAxNS4xMzYgMTMuNTY3LTcuMTM1Mi0xMy44NTUtOC4wMDExemwtMTMuODU1IDguMDAxMSAxMy41NjcgNy4xMzUyIDAuMjg4Ny0xNS4xMzZ6bS0xMy44NTUgOC4wMDExdjE1Ljk5OGwxMi45NTgtNy44MTYyLTEyLjk1OC04LjE4MTV6bTAgMTUuOTk4IDEzLjg1NSA4LjAwMTEtMC42MDg5LTE1LjMxNy0xMy4yNDYgNy4zMTU2em0xMy44NTUgOC4wMDExIDEzLjg1NS04LjAwMTEtMTMuMjUxLTcuMzE1Ni0wLjYwNDQgMTUuMzE3em0xMy44NTUtOC4wMDExdi0xNS45OThsLTEyLjk2MiA4LjE4MTUgMTIuOTYyIDcuODE2MnoiIGZpbGw9InVybCgjYSkiLz4KIDwvZz4KPC9zdmc+Cg==",remoteStorageIconCiphered:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIiIHdpZHRoPSIzMiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0iYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSI1NzEuNDIiIGN4PSIxMDQ2LjUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjE0NDMzIDAgMCAuMTY2NjcgMTIwMS41IDg3Ny4xMSkiIHI9Ijk2Ij4KICAgPHN0b3Agc3RvcC1jb2xvcj0iI2ZmNGEwNCIgc3RvcC1vcGFjaXR5PSIuNzYxNTQiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjZmY0YTA0IiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPHBhdGggc3R5bGU9ImNvbG9yOiMwMDAwMDAiIGQ9Im0xNiAwbDAuMTI1IDYuMzc1YzIuMDk4IDAuMDY3IDMuNzUgMS43NTk1IDMuNzUgMy44NzV2MS45NjloMS45MzcgMC4wMzJsOC00LjIxOS0xMy44NDQtOHpsLTEzLjg0NCA4IDggNC4yMTloMC4wMzIgMS45MDZ2LTEuOTY5YzAtMi4xMTU1IDEuNjgzLTMuODA4IDMuNzgxLTMuODc1bDAuMTI1LTYuMzc1em0tMTMuODQ0IDh2MTZsNy45OTk4LTQuODQ0di02LjA5NGwtNy45OTk4LTUuMDYyem0wIDE2bDEzLjg0NCA4LTAuMzc1LTEwLjA2MmgtNS40Njl2LTIuMzQ0bC03Ljk5OTggNC40MDZ6bTEzLjg0NCA4bDEzLjg0NC04LTgtNC40MDZ2Mi4zNDRoLTUuNDY5bC0wLjM3NSAxMC4wNjJ6bTEzLjg0NC04di0xNmwtOCA1LjA2MnY2LjA5NGw4IDQuODQ0em0tMTMuOTY5LTE3Yy0xLjczNSAwLjA2NjYtMy4xMjUgMS40OTg3LTMuMTI1IDMuMjV2MS45NjloMy4wMzFsMC4wOTQtNS4yMTl6bTAuMjUgMGwwLjA5NCA1LjIxOWgzLjAzMXYtMS45NjljMC0xLjc1MTMtMS4zOS0zLjE4MzQtMy4xMjUtMy4yNXptLTQuNzUgNS44NDRsNC4zNDQgMi4yODEgMC4wMzEtMi4yODFoLTQuMzc1em00Ljg3NSAwbDAuMDMxIDIuMjgxIDQuMzQ0LTIuMjgxaC00LjM3NXptLTUuNDM4IDAuNjI1djUuMzEybDQuMjgyLTIuNTkzLTQuMjgyLTIuNzE5em0xMC4zNzYgMGwtNC4yODIgMi43MTkgNC4yODIgMi41OTN2LTUuMzEyem0tNS43ODIgMy4yMTlsLTQuNTk0IDIuNTMxdjIuMDYyaDQuNzgybC0wLjE4OC00LjU5M3ptMS4xODggMGwtMC4xODggNC41OTNoNC43ODJ2LTIuMDYybC00LjU5NC0yLjUzMXoiIGZpbGw9InVybCgjYSkiLz4KPC9zdmc+Cg==",remoteStorageIconError:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIiIHdpZHRoPSIzMiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0iYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSI1NzEuNDIiIGN4PSIxMDQ2LjUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjE0NDMzIDAgMCAuMTY2NjcgMTIwMS41IDg3Ny4xMSkiIHI9Ijk2Ij4KICAgPHN0b3Agc3RvcC1jb2xvcj0iI2U5MDAwMCIgc3RvcC1vcGFjaXR5PSIuNzYwNzgiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjZTkwMDAwIiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMzYuNiAtOTU2LjM1KSI+CiAgPHBhdGggc3R5bGU9ImNvbG9yOiMwMDAwMDAiIGQ9Im0xMzUyLjYgOTU2LjM1IDAuMjg4NiAxNS4xMzYgMTMuNTY3LTcuMTM1Mi0xMy44NTUtOC4wMDExemwtMTMuODU1IDguMDAxMSAxMy41NjcgNy4xMzUyIDAuMjg4Ny0xNS4xMzZ6bS0xMy44NTUgOC4wMDExdjE1Ljk5OGwxMi45NTgtNy44MTYyLTEyLjk1OC04LjE4MTV6bTAgMTUuOTk4IDEzLjg1NSA4LjAwMTEtMC42MDg5LTE1LjMxNy0xMy4yNDYgNy4zMTU2em0xMy44NTUgOC4wMDExIDEzLjg1NS04LjAwMTEtMTMuMjUxLTcuMzE1Ni0wLjYwNDQgMTUuMzE3em0xMy44NTUtOC4wMDExdi0xNS45OThsLTEyLjk2MiA4LjE4MTUgMTIuOTYyIDcuODE2MnoiIGZpbGw9InVybCgjYSkiLz4KIDwvZz4KPC9zdmc+Cg==",remoteStorageIconOffline:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMzIiIHdpZHRoPSIzMiIgdmVyc2lvbj0iMS4xIiB4bWxuczpjYz0iaHR0cDovL2NyZWF0aXZlY29tbW9ucy5vcmcvbnMjIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIj4KIDxkZWZzPgogIDxyYWRpYWxHcmFkaWVudCBpZD0iYSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIGN5PSI1NzEuNDIiIGN4PSIxMDQ2LjUiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoLjE0NDMzIDAgMCAuMTY2NjcgMTIwMS41IDg3Ny4xMSkiIHI9Ijk2Ij4KICAgPHN0b3Agc3RvcC1jb2xvcj0iIzY5Njk2OSIgc3RvcC1vcGFjaXR5PSIuNzYxNTQiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjNjc2NzY3IiBvZmZzZXQ9IjEiLz4KICA8L3JhZGlhbEdyYWRpZW50PgogPC9kZWZzPgogPGcgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEzMzYuNiAtOTU2LjM1KSI+CiAgPHBhdGggc3R5bGU9ImNvbG9yOiMwMDAwMDAiIGQ9Im0xMzUyLjYgOTU2LjM1IDAuMjg4NiAxNS4xMzYgMTMuNTY3LTcuMTM1Mi0xMy44NTUtOC4wMDExemwtMTMuODU1IDguMDAxMSAxMy41NjcgNy4xMzUyIDAuMjg4Ny0xNS4xMzZ6bS0xMy44NTUgOC4wMDExdjE1Ljk5OGwxMi45NTgtNy44MTYyLTEyLjk1OC04LjE4MTV6bTAgMTUuOTk4IDEzLjg1NSA4LjAwMTEtMC42MDg5LTE1LjMxNy0xMy4yNDYgNy4zMTU2em0xMy44NTUgOC4wMDExIDEzLjg1NS04LjAwMTEtMTMuMjUxLTcuMzE1Ni0wLjYwNDQgMTUuMzE3em0xMy44NTUtOC4wMDExdi0xNS45OThsLTEyLjk2MiA4LjE4MTUgMTIuOTYyIDcuODE2MnoiIGZpbGw9InVybCgjYSkiLz4KIDwvZz4KPC9zdmc+Cg==",syncIcon:"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjxzdmcgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDg3LjUgMTAwIiB4bWw6c3BhY2U9InByZXNlcnZlIiBoZWlnaHQ9IjE2IiB2aWV3Qm94PSIwIDAgMTUuOTk5OTk5IDE2IiB3aWR0aD0iMTYiIHZlcnNpb249IjEuMSIgeT0iMHB4IiB4PSIwcHgiIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyI+CjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKC01LjUxMTIgLTc2LjUyNSkiIGRpc3BsYXk9Im5vbmUiPgoJPHBhdGggZGlzcGxheT0iaW5saW5lIiBkPSJtNTEuNDczIDQyLjI1NS0yLjIwNSAyLjIxMmMxLjQ3OCAxLjQ3NyAyLjI5NSAzLjQ0MiAyLjI5NSA1LjUzMyAwIDQuMzA5LTMuNTA0IDcuODEyLTcuODEyIDcuODEydi0xLjU2MmwtMy4xMjUgMy4xMjUgMy4xMjQgMy4xMjV2LTEuNTYyYzYuMDI5IDAgMTAuOTM4LTQuOTA2IDEwLjkzOC0xMC45MzggMC0yLjkyNy0xLjE0MS01LjY3Ni0zLjIxNS03Ljc0NXoiLz4KCTxwYXRoIGRpc3BsYXk9ImlubGluZSIgZD0ibTQ2Ljg3NSA0MC42MjUtMy4xMjUtMy4xMjV2MS41NjJjLTYuMDMgMC0xMC45MzggNC45MDctMTAuOTM4IDEwLjkzOCAwIDIuOTI3IDEuMTQxIDUuNjc2IDMuMjE3IDcuNzQ1bDIuMjAzLTIuMjEyYy0xLjQ3Ny0xLjQ3OS0yLjI5NC0zLjQ0Mi0yLjI5NC01LjUzMyAwLTQuMzA5IDMuNTA0LTcuODEyIDcuODEyLTcuODEydjEuNTYybDMuMTI1LTMuMTI1eiIvPgo8L2c+CjxwYXRoIGZpbGw9IiNmZmYiIGQ9Im0xMCAwbC0wLjc1IDEuOTA2MmMtMS4wMDc4LTAuMjk0Mi0zLjQ1ODYtMC43NzA4LTUuNjU2MiAwLjkzNzYgMC0wLjAwMDItMy45MzAyIDIuNTk0MS0yLjA5MzggNy41OTQybDEuNjU2Mi0wLjcxOTJzLTEuNTM5OS0zLjExMjIgMS42ODc2LTUuNTMxM2MwIDAgMS42OTU3LTEuMTMzOSAzLjY4NzQtMC41OTM3bC0wLjcxODcgMS44MTI0IDMuODEyNS0xLjYyNS0xLjYyNS0zLjc4MTJ6Ii8+PHBhdGggZmlsbD0iI2ZmZiIgZD0ibTE0IDUuNTYyNWwtMS42NTYgMC43MTg3czEuNTQxIDMuMTEzNS0xLjY4OCA1LjUzMDhjMCAwLTEuNzI3MiAxLjEzNS0zLjcxODUgMC41OTRsMC43NS0xLjgxMi0zLjgxMjUgMS41OTQgMS41OTM4IDMuODEyIDAuNzgxMi0xLjkwNmMxLjAxMTMgMC4yOTUgMy40NjE1IDAuNzY2IDUuNjU2LTAuOTM4IDAgMCAzLjkyOC0yLjU5NCAyLjA5NC03LjU5MzV6Ii8+Cjwvc3ZnPgo=",
widget:'<div class="rs-bubble rs-hidden">   <div class="rs-bubble-text remotestorage-initial remotestorage-error remotestorage-authing remotestorage-offline">     <span class="rs-status-text">{{view_connect}}</span>   </div>   <div class="rs-bubble-expandable">     <!-- error -->     <div class="remotestorage-error">       <pre class="rs-status-text rs-error-msg">{{ERROR_MSG}}</pre>       <button class="remotestorage-reset">{{view_get_me_out}}</button>       <p class="rs-centered-text rs-error-plz-report">{{view_error_plz_report}}</p>     </div>     <!-- connected -->     <div class="rs-bubble-text remotestorage-connected">       <strong class="userAddress">{{USER_ADDRESS}}</strong>       <p class="remotestorage-unauthorized">{{view_unauthorized}}</p>       <p class="remotestorage-invalid-key">{{view_invalid_key}}</p>       <form novalidate class="remotestorage-cipher-form">         <input placeholder="Secret key" name="userSecretKey" novalidate>         <button class="rs-cipher" name="rs-cipher" title="cipher" disabled="disabled">           <img>         </button>         <button class="rs-nocipher" name="rs-nocipher" title="no cipher">           <img>         </button>       </form>     </div>     <div class="rs-content remotestorage-connected">       <button class="rs-sync" title="sync"><img></button>       <button class="rs-disconnect" title="disconnect"><img></button>     </div>     <!-- initial -->     <form novalidate class="remotestorage-initial">       <input type="email" placeholder="user@provider.com" name="userAddress" novalidate>       <button class="connect" name="connect" title="connect" disabled="disabled">         <img>       </button>     </form>     <div class="rs-info-msg remotestorage-initial">{{view_info}}</div>   </div> </div> <img class="rs-dropbox rs-backends rs-action" alt="Connect to Dropbox"> <img class="rs-googledrive rs-backends rs-action" alt="Connect to Google Drive"> <img class="rs-cube rs-action"> ',widgetCss:'/** encoding:utf-8 **/ /* RESET */ #remotestorage-widget{text-align:left;}#remotestorage-widget input, #remotestorage-widget button{font-size:11px;}#remotestorage-widget form input[type=email]{margin-bottom:0;/* HTML5 Boilerplate */}#remotestorage-widget form input[type=submit]{margin-top:0;/* HTML5 Boilerplate */}/* /RESET */ #remotestorage-widget, #remotestorage-widget *{-moz-box-sizing:border-box;box-sizing:border-box;}#remotestorage-widget{position:absolute;right:10px;top:10px;font:normal 16px/100% sans-serif !important;user-select:none;-webkit-user-select:none;-moz-user-select:-moz-none;cursor:default;z-index:10000;}#remotestorage-widget .rs-bubble{background:rgba(80, 80, 80, .7);border-radius:5px 15px 5px 5px;color:white;font-size:0.8em;padding:5px;position:absolute;right:3px;top:9px;min-height:24px;white-space:nowrap;text-decoration:none;}.rs-bubble .rs-bubble-text{padding-right:32px;/* make sure the bubble doesn\'t "jump" when initially opening. */ min-width:182px;}#remotestorage-widget .rs-action{cursor:pointer;}/* less obtrusive cube when connected */ #remotestorage-widget.remotestorage-state-connected .rs-cube, #remotestorage-widget.remotestorage-state-busy .rs-cube{opacity:.3;-webkit-transition:opacity .3s ease;-moz-transition:opacity .3s ease;-ms-transition:opacity .3s ease;-o-transition:opacity .3s ease;transition:opacity .3s ease;}#remotestorage-widget.remotestorage-state-connected:hover .rs-cube, #remotestorage-widget.remotestorage-state-busy:hover .rs-cube, #remotestorage-widget.remotestorage-state-connected .rs-bubble:not(.rs-hidden) + .rs-cube{opacity:1 !important;}#remotestorage-widget .rs-backends{position:relative;top:5px;right:0;}#remotestorage-widget .rs-cube{position:relative;top:5px;right:0;}/* pulsing animation for cube when loading */ #remotestorage-widget .rs-cube.remotestorage-loading{-webkit-animation:remotestorage-loading .5s ease-in-out infinite alternate;-moz-animation:remotestorage-loading .5s ease-in-out infinite alternate;-o-animation:remotestorage-loading .5s ease-in-out infinite alternate;-ms-animation:remotestorage-loading .5s ease-in-out infinite alternate;animation:remotestorage-loading .5s ease-in-out infinite alternate;}@-webkit-keyframes remotestorage-loading{to{opacity:.7}}@-moz-keyframes remotestorage-loading{to{opacity:.7}}@-o-keyframes remotestorage-loading{to{opacity:.7}}@-ms-keyframes remotestorage-loading{to{opacity:.7}}@keyframes remotestorage-loading{to{opacity:.7}}#remotestorage-widget a{text-decoration:underline;color:inherit;}#remotestorage-widget form{margin-top:.7em;position:relative;}#remotestorage-widget form input{display:table-cell;vertical-align:top;border:none;border-radius:6px;font-weight:bold;color:white;outline:none;line-height:1.5em;height:2em;}#remotestorage-widget form input:disabled{color:#999;background:#444 !important;cursor:default !important;}#remotestorage-widget form input[type=email]:focus, #remotestorage-widget form input[type=password]:focus{background:#223;}#remotestorage-widget form input[type=email], #remotestorage-widget form input[type=password]{background:#000;width:100%;height:26px;padding:0 30px 0 5px;border-top:1px solid #111;border-bottom:1px solid #999;}#remotestorage-widget form input[type=email]:focus, #remotestorage-widget form input[type=password]:focus{background:#223;}#remotestorage-widget button:focus, #remotestorage-widget input:focus{box-shadow:0 0 4px #ccc;}#remotestorage-widget form input[type=email]::-webkit-input-placeholder, #remotestorage-widget form input[type=password]::-webkit-input-placeholder{color:#999;}#remotestorage-widget form input[type=email]:-moz-placeholder, #remotestorage-widget form input[type=password]:-moz-placeholder{color:#999;}#remotestorage-widget form input[type=email]::-moz-placeholder, #remotestorage-widget form input[type=password]::-moz-placeholder{color:#999;}#remotestorage-widget form input[type=email]:-ms-input-placeholder, #remotestorage-widget form input[type=password]:-ms-input-placeholder{color:#999;}#remotestorage-widget form input[type=submit]{background:#000;cursor:pointer;padding:0 5px;}#remotestorage-widget form input[type=submit]:hover{background:#333;}#remotestorage-widget .rs-info-msg{font-size:10px;color:#eee;margin-top:0.7em;white-space:normal;}#remotestorage-widget .rs-info-msg.last-synced-message{display:inline;white-space:nowrap;margin-bottom:.7em}#remotestorage-widget .rs-info-msg a:hover, #remotestorage-widget .rs-info-msg a:active{color:#fff;}#remotestorage-widget button img{vertical-align:baseline;}#remotestorage-widget button{border:none;border-radius:6px;font-weight:bold;color:white;outline:none;line-height:1.5em;height:26px;width:26px;background:#000;cursor:pointer;margin:0;padding:5px;}#remotestorage-widget button:hover{background:#333;}#remotestorage-widget .rs-bubble button.connect, #remotestorage-widget .rs-bubble button.rs-cipher, #remotestorage-widget .rs-bubble button.rs-nocipher{display:block;background:none;position:absolute;right:0;top:0;opacity:1;/* increase clickable area of connect, rs-cipher & rs-nocipher buttons */ margin:-5px;padding:10px;width:36px;height:36px;}#remotestorage-widget .rs-bubble button.rs-cipher{width:46px;}#remotestorage-widget .rs-bubble button.rs-nocipher{height:26px;margin:0;padding:4px 5px 5px;right:-32px;width:26px;}#remotestorage-widget .rs-bubble button.connect:not([disabled]):hover, #remotestorage-widget .rs-bubble button.rs-cipher:not([disabled]):hover, #remotestorage-widget .rs-bubble button.rs-nocipher:not([disabled]):hover{background:rgba(150,150,150,.5);}#remotestorage-widget .rs-bubble button.connect[disabled], #remotestorage-widget .rs-bubble button.rs-cipher[disabled]{opacity:.5;cursor:default !important;}#remotestorage-widget .rs-bubble button.rs-sync{position:relative;left:-5px;bottom:-5px;padding:4px 4px 0 4px;background:#555;}#remotestorage-widget .rs-bubble button.rs-sync:hover{background:#444;}#remotestorage-widget .rs-bubble button.rs-disconnect{background:#721;position:absolute;right:0;bottom:0;padding:4px 4px 0 4px;}#remotestorage-widget .rs-bubble button.rs-disconnect:hover{background:#921;}#remotestorage-widget .remotestorage-error-info{color:#f92;}#remotestorage-widget .remotestorage-reset{width:100%;background:#721;}#remotestorage-widget .remotestorage-reset:hover{background:#921;}#remotestorage-widget .rs-bubble .rs-content{margin-top:7px;}#remotestorage-widget pre{user-select:initial;-webkit-user-select:initial;-moz-user-select:text;max-width:27em;margin-top:1em;overflow:auto;}#remotestorage-widget .rs-centered-text{text-align:center;}#remotestorage-widget .rs-bubble.rs-hidden{padding-bottom:2px;border-radius:5px 15px 15px 5px;}#remotestorage-widget .rs-error-msg{min-height:5em;}.rs-bubble.rs-hidden .rs-bubble-expandable{display:none;}.remotestorage-state-connected .rs-bubble.rs-hidden{display:none;}.remotestorage-connected{display:none;}.remotestorage-state-connected .remotestorage-connected{display:block;}.remotestorage-cipher-form{display:none;}.remotestorage-cipher .remotestorage-cipher-form{display:block;}.remotestorage-invalid-key{display:none;}.remotestorage-invalid-key.remotestorage-cipher-error{display:block;}.remotestorage-initial{display:none;}.remotestorage-state-initial .remotestorage-initial{display:block;}.remotestorage-error{display:none;}.remotestorage-state-error .remotestorage-error{display:block;}.remotestorage-state-authing .remotestorage-authing{display:block;}.remotestorage-state-offline .remotestorage-connected, .remotestorage-state-offline .remotestorage-offline{display:block;}.remotestorage-unauthorized{display:none;}.remotestorage-state-unauthorized .rs-bubble.rs-hidden{display:none;}.remotestorage-state-unauthorized .remotestorage-connected, .remotestorage-state-unauthorized .remotestorage-unauthorized{display:block;}.remotestorage-state-unauthorized .rs-sync{display:none;}.remotestorage-state-busy .rs-bubble.rs-hidden{display:none;}.remotestorage-state-busy .rs-bubble{display:block;}.remotestorage-state-busy .remotestorage-connected{display:block;}.remotestorage-state-authing .rs-bubble-expandable{display:none;}'},function(a){function b(a,b,c){return RemoteStorage.log("[Widget] Producing stateSetter for",b),function(){RemoteStorage.log("[Widget] Setting state",b,c),e&&(localStorage[f]=b),a.view?(a.rs.remote&&a.view.setUserAddress(a.rs.remote.userAddress),a.view.setState(b,c)):a._rememberedState=b}}function c(a){return function(c){var d;c instanceof RemoteStorage.DiscoveryError?(console.error("Discovery failed",c,'"'+c.message+'"'),d=b(a,"initial",c.message)):c instanceof RemoteStorage.SyncError?d=b(a,"offline"):c instanceof RemoteStorage.Unauthorized?d=b(a,"unauthorized"):(RemoteStorage.log("[Widget] Unknown error"),d=b(a,"error",[c])),d.apply()}}function d(a){return"GET"!==a.method||!a.isFolder}var e,f="remotestorage:widget:state",g={initial:!0,connected:!0,offline:!0};RemoteStorage.Widget=function(a){var h=this,i=0;if(this.rs=a,this.rs.remote.on("connected",b(this,"connected")),this.rs.on("disconnected",b(this,"initial")),this.rs.on("connecting",b(this,"authing")),this.rs.on("authing",b(this,"authing")),this.rs.on("error",c(this)),this.rs.remote&&(this.rs.remote.on("wire-busy",function(a){d(a)&&(i++,b(h,"busy")())}),this.rs.remote.on("wire-done",function(a){d(a)&&i--,0>=i&&a.success&&b(h,"connected")()})),e){var j=localStorage[f];j&&g[j]&&(this._rememberedState=j)}},RemoteStorage.Widget.prototype={display:function(a){return"string"==typeof a?a={domID:a}:"undefined"==typeof a&&(a={}),this.view||this.setView(new RemoteStorage.Widget.View(this.rs)),this.view.display(a),this},linkWidgetToSync:function(){"object"==typeof this.rs.sync&&"function"==typeof this.rs.sync.sync?this.view.on("sync",this.rs.sync.sync.bind(this.rs.sync)):(RemoteStorage.log("[Widget] typeof this.rs.sync check fail",this.rs.sync),setTimeout(this.linkWidgetToSync.bind(this),1e3))},setView:function(a){this.view=a,this.view.on("connect",function(a){"string"==typeof a?this.rs.connect(a):a.special&&this.rs[a.special].connect(a)}.bind(this)),this.view.on("secret-entered",function(a){this.view.setUserSecretKey(a),b(this,"ciphered")()}.bind(this)),this.view.on("secret-cancelled",function(){b(this,"notciphered")()}.bind(this)),this.view.on("disconnect",this.rs.disconnect.bind(this.rs)),this.linkWidgetToSync();try{this.view.on("reset",function(){var a=RemoteStorage.Authorize.getLocation();this.rs.on("disconnected",a.reload.bind(a)),this.rs.disconnect()}.bind(this))}catch(a){if(!a.message||!a.message.match(/Unknown event/))throw a}this._rememberedState&&(setTimeout(b(this,this._rememberedState),0),delete this._rememberedState)}},RemoteStorage.prototype.displayWidget=function(a){return this.widget.display(a)},RemoteStorage.Widget._rs_init=function(a){e=RemoteStorage.util.localStorageAvailable(),a.widget||(a.widget=new RemoteStorage.Widget(a))},RemoteStorage.Widget._rs_supported=function(a){return"undefined"!=typeof document}}("undefined"!=typeof window?window:global),function(a){function b(a,b){return a.classList.remove(b)}function c(a,b){return a.classList.add(b)}function d(a){"function"==typeof a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function e(a,b,c,d){var e=a.querySelector("."+b);if("undefined"!=typeof c){var f=e.querySelector("img");(f||e).src=RemoteStorage.Assets[c]}return e.addEventListener("click",d),e}function f(a){a.target.value?a.target.nextElementSibling.removeAttribute("disabled"):a.target.nextElementSibling.setAttribute("disabled","disabled")}var g=RemoteStorage.I18n.translate;RemoteStorage.Widget.View=function(a){if(this.rs=a,"undefined"==typeof document)throw"Widget not supported";RemoteStorage.eventHandling(this,"connect","secret-entered","secret-cancelled","disconnect","sync","display","reset");for(var b in this.events)this.events[b]=this.events[b].bind(this);this.hideBubbleOnBodyClick=function(a){for(var b=a.target;b!==document.body;b=b.parentElement)if("remotestorage-widget"===b.id)return;this.hideBubble()}.bind(this)},RemoteStorage.Widget.View.prototype={connectGdrive:function(){this._emit("connect",{special:"googledrive"})},connectDropbox:function(){this._emit("connect",{special:"dropbox"})},setState:function(a,b){RemoteStorage.log("[View] widget.view.setState(",a,",",b,");");var c=this.states[a];if("undefined"==typeof c)throw new Error("Bad State assigned to view: "+a);c.apply(this,[b])},setUserAddress:function(a){this.userAddress=a||"";var b;this.div&&(b=this.div.querySelector("form.remotestorage-initial").userAddress)&&(b.value=this.userAddress)},setUserSecretKey:function(a){this.userSecretKey=a},toggleBubble:function(a){this.bubble.className.search("rs-hidden")<0?this.hideBubble(a):this.showBubble(a)},hideBubble:function(){c(this.bubble,"rs-hidden"),document.body.removeEventListener("click",this.hideBubbleOnBodyClick)},showBubble:function(a){b(this.bubble,"rs-hidden"),"undefined"!=typeof a&&d(a),document.body.addEventListener("click",this.hideBubbleOnBodyClick),this.div.querySelector(".remotestorage-connected").classList.contains("remotestorage-cipher")&&!this.userSecretKey?this.bubble.querySelector("form.remotestorage-cipher-form").userSecretKey.focus():this.bubble.querySelector("form.remotestorage-initial").userAddress.focus()},display:function(a){if("undefined"!=typeof this.div)return this.div;var b=document.createElement("div"),c=document.createElement("style");if(c.innerHTML=RemoteStorage.Assets.widgetCss,b.id="remotestorage-widget",b.innerHTML=RemoteStorage.Assets.widget,b.appendChild(c),a.domID){var d=document.getElementById(a.domID);if(!d)throw'Failed to find target DOM element with id="'+a.domID+'"';d.appendChild(b)}else document.body.appendChild(b);e(b,"rs-sync","syncIcon",this.events.sync),e(b,"rs-disconnect","disconnectIcon",this.events.disconnect),e(b,"remotestorage-reset",void 0,this.events.reset),e(b,"connect","connectIcon",this.events.connect),this.form=b.querySelector("form.remotestorage-initial");var g=this.form.userAddress;if(g.addEventListener("load",f),g.addEventListener("keyup",f),this.userAddress&&(g.value=this.userAddress),a.encryption){this.cipher=!0;var h=b.querySelector("form.remotestorage-cipher-form").userSecretKey;h.type="password",e(b,"rs-cipher","cipherIcon",this.events["secret-entered"]),h.addEventListener("load",f),h.addEventListener("keyup",f),e(b,"rs-nocipher","nocipherIcon",this.events["secret-cancelled"])}this.cube=e(b,"rs-cube","remoteStorageIcon",this.toggleBubble.bind(this)),e(b,"rs-dropbox","dropbox",this.connectDropbox.bind(this)),e(b,"rs-googledrive","googledrive",this.connectGdrive.bind(this));var i={INPUT:!0,BUTTON:!0,IMG:!0},j=function(a){i[a.target.tagName]||this.div.classList.contains("remotestorage-state-unauthorized")||this.showBubble(a)}.bind(this);return this.bubble=e(b,"rs-bubble",void 0,j),this.hideBubble(),this.div=b,this.states.initial.call(this),this.events.display.call(this),this.div},states:{initial:function(a){var c=this.cube,d=a||g("view_info");c.src=RemoteStorage.Assets.remoteStorageIcon,this._renderTranslatedInitialContent(),a?(c.src=RemoteStorage.Assets.remoteStorageIconError,b(this.cube,"remotestorage-loading"),this.showBubble(),setTimeout(function(){c.src=RemoteStorage.Assets.remoteStorageIcon},2e3)):this.hideBubble(),this.div.className="remotestorage-state-initial",this.userSecretKey&&delete this.userSecretKey;var e=1;this._activateBackend("dropbox")&&(e+=1),this._activateBackend("googledrive")&&(e+=1),this.div.querySelector(".rs-bubble-text").style.paddingRight=32*e+8+"px";var f=this.div.querySelector(".connect");this.form.userAddress.value&&f.removeAttribute("disabled");var h=this.div.querySelector(".rs-info-msg");h.innerHTML=d,a?h.classList.add("remotestorage-error-info"):h.classList.remove("remotestorage-error-info")},authing:function(){this.div.removeEventListener("click",this.events.connect),this.div.className="remotestorage-state-authing",this.div.querySelector(".rs-status-text").innerHTML=g("view_connecting",this.userAddress),c(this.cube,"remotestorage-loading")},connected:function(){var a=this.cube;this.div.className="remotestorage-state-connected",this.div.querySelector(".userAddress").innerHTML=this.userAddress,a.src=RemoteStorage.Assets.remoteStorageIcon,b(a,"remotestorage-loading"),this.cipher&&(this.userSecretKey?this.userSecretKeyError?(a.src=RemoteStorage.Assets.remoteStorageIconError,c(this.div.querySelector(".remotestorage-connected"),"remotestorage-cipher"),c(this.div.querySelector(".remotestorage-invalid-key"),"remotestorage-cipher-error"),this.showBubble(),setTimeout(function(){a.src=RemoteStorage.Assets.remoteStorageIcon},5e3)):(b(this.div.querySelector(".remotestorage-invalid-key"),"remotestorage-cipher-error"),a.src=RemoteStorage.Assets.remoteStorageIconCiphered):(c(this.div.querySelector(".remotestorage-connected"),"remotestorage-cipher"),this.showBubble()));var d={googledrive:this.div.querySelector(".rs-googledrive"),dropbox:this.div.querySelector(".rs-dropbox")};d.googledrive.style.display=d.dropbox.style.display="none",d[this.rs.backend]?(d[this.rs.backend].style.display="inline-block",this.div.querySelector(".rs-bubble-text").style.paddingRight="72px"):this.div.querySelector(".rs-bubble-text").style.paddingRight="40px"},ciphered:function(){this.div.querySelector("form.remotestorage-cipher-form").userSecretKey.value="",b(this.div.querySelector(".remotestorage-invalid-key"),"remotestorage-cipher-error"),b(this.div.querySelector(".remotestorage-connected"),"remotestorage-cipher"),this.cube.src=RemoteStorage.Assets.remoteStorageIconCiphered,this.hideBubble()},notciphered:function(){this.cipher=!1,b(this.div.querySelector(".remotestorage-invalid-key"),"remotestorage-cipher-error"),b(this.div.querySelector(".remotestorage-connected"),"remotestorage-cipher"),this.hideBubble()},busy:function(){this.div.className="remotestorage-state-busy",c(this.cube,"remotestorage-loading")},offline:function(){this.div.className="remotestorage-state-offline",this.cube.src=RemoteStorage.Assets.remoteStorageIconOffline,this.div.querySelector(".rs-status-text").innerHTML=g("view_offline")},error:function(a){var b=a;this.div.className="remotestorage-state-error",this.div.querySelector(".rs-bubble-text").innerHTML="<strong>"+g("view_error_occured")+"</strong>",a instanceof Error&&(b=a.message+"\n\n"+a.stack),this.div.querySelector(".rs-error-msg").textContent=b,this.cube.src=RemoteStorage.Assets.remoteStorageIconError,this.showBubble()},unauthorized:function(){this.div.className="remotestorage-state-unauthorized",this.cube.src=RemoteStorage.Assets.remoteStorageIconError,this.showBubble(),this.div.addEventListener("click",this.events.connect)}},events:{connect:function(a){d(a),a.preventDefault(),this._emit("connect",this.div.querySelector("form.remotestorage-initial").userAddress.value)},"secret-entered":function(a){d(a),a.preventDefault(),this._emit("secret-entered",this.div.querySelector("form.remotestorage-cipher-form").userSecretKey.value)},"secret-cancelled":function(a){d(a),a.preventDefault(),this._emit("secret-cancelled")},sync:function(a){d(a),a.preventDefault(),this._emit("sync")},disconnect:function(a){d(a),a.preventDefault(),this._emit("disconnect")},reset:function(b){b.preventDefault();var c=a.confirm(g("view_confirm_reset"));c&&this._emit("reset")},display:function(a){a&&a.preventDefault(),this._emit("display")}},_renderTranslatedInitialContent:function(){this.div.querySelector(".rs-status-text").innerHTML=g("view_connect"),this.div.querySelector(".remotestorage-reset").innerHTML=g("view_get_me_out"),this.div.querySelector(".rs-error-plz-report").innerHTML=g("view_error_plz_report"),this.div.querySelector(".remotestorage-unauthorized").innerHTML=g("view_unauthorized"),this.div.querySelector(".remotestorage-invalid-key").innerHTML=g("view_invalid_key")},_activateBackend:function(a){var b="rs-"+a;return this.rs.apiKeys[a]?(this.div.querySelector("."+b).style.display="inline-block",!0):(this.div.querySelector("."+b).style.display="none",!1)}}}("undefined"!=typeof window?window:global),function(a,b){"function"==typeof define&&define.amd?define([],b):"undefined"!=typeof module&&module.exports?module.exports=b():a.tv4=b()}(this,function(){function a(a){return encodeURI(a).replace(/%25[0-9][0-9]/g,function(a){return"%"+a.substring(3)})}function b(b){var c="";m[b.charAt(0)]&&(c=b.charAt(0),b=b.substring(1));var d="",e="",f=!0,g=!1,h=!1;"+"===c?f=!1:"."===c?(e=".",d="."):"/"===c?(e="/",d="/"):"#"===c?(e="#",f=!1):";"===c?(e=";",d=";",g=!0,h=!0):"?"===c?(e="?",d="&",g=!0):"&"===c&&(e="&",d="&",g=!0);for(var i=[],j=b.split(","),k=[],l={},o=0;o<j.length;o++){var p=j[o],q=null;if(-1!==p.indexOf(":")){var r=p.split(":");p=r[0],q=parseInt(r[1],10)}for(var s={};n[p.charAt(p.length-1)];)s[p.charAt(p.length-1)]=!0,p=p.substring(0,p.length-1);var t={truncate:q,name:p,suffices:s};k.push(t),l[p]=t,i.push(p)}var u=function(b){for(var c="",i=0,j=0;j<k.length;j++){var l=k[j],m=b(l.name);if(null===m||void 0===m||Array.isArray(m)&&0===m.length||"object"==typeof m&&0===Object.keys(m).length)i++;else if(c+=j===i?e:d||",",Array.isArray(m)){g&&(c+=l.name+"=");for(var n=0;n<m.length;n++)n>0&&(c+=l.suffices["*"]?d||",":",",l.suffices["*"]&&g&&(c+=l.name+"=")),c+=f?encodeURIComponent(m[n]).replace(/!/g,"%21"):a(m[n])}else if("object"==typeof m){g&&!l.suffices["*"]&&(c+=l.name+"=");var o=!0;for(var p in m)o||(c+=l.suffices["*"]?d||",":","),o=!1,c+=f?encodeURIComponent(p).replace(/!/g,"%21"):a(p),c+=l.suffices["*"]?"=":",",c+=f?encodeURIComponent(m[p]).replace(/!/g,"%21"):a(m[p])}else g&&(c+=l.name,h&&""===m||(c+="=")),null!=l.truncate&&(m=m.substring(0,l.truncate)),c+=f?encodeURIComponent(m).replace(/!/g,"%21"):a(m)}return c};return u.varNames=i,{prefix:e,substitution:u}}function c(a){if(!(this instanceof c))return new c(a);for(var d=a.split("{"),e=[d.shift()],f=[],g=[],h=[];d.length>0;){var i=d.shift(),j=i.split("}")[0],k=i.substring(j.length+1),l=b(j);g.push(l.substitution),f.push(l.prefix),e.push(k),h=h.concat(l.substitution.varNames)}this.fill=function(a){for(var b=e[0],c=0;c<g.length;c++){var d=g[c];b+=d(a),b+=e[c+1]}return b},this.varNames=h,this.template=a}function d(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){if(Array.isArray(a)!==Array.isArray(b))return!1;if(Array.isArray(a)){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(!d(a[c],b[c]))return!1}else{var e;for(e in a)if(void 0===b[e]&&void 0!==a[e])return!1;for(e in b)if(void 0===a[e]&&void 0!==b[e])return!1;for(e in a)if(!d(a[e],b[e]))return!1}return!0}return!1}function e(a){var b=String(a).replace(/^\s+|\s+$/g,"").match(/^([^:\/?#]+:)?(\/\/(?:[^:@]*(?::[^:@]*)?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);return b?{href:b[0]||"",protocol:b[1]||"",authority:b[2]||"",host:b[3]||"",hostname:b[4]||"",port:b[5]||"",pathname:b[6]||"",search:b[7]||"",hash:b[8]||""}:null}function f(a,b){function c(a){var b=[];return a.replace(/^(\.\.?(\/|$))+/,"").replace(/\/(\.(\/|$))+/g,"/").replace(/\/\.\.$/,"/../").replace(/\/?[^\/]*/g,function(a){"/.."===a?b.pop():b.push(a)}),b.join("").replace(/^\//,"/"===a.charAt(0)?"/":"")}return b=e(b||""),a=e(a||""),b&&a?(b.protocol||a.protocol)+(b.protocol||b.authority?b.authority:a.authority)+c(b.protocol||b.authority||"/"===b.pathname.charAt(0)?b.pathname:b.pathname?(a.authority&&!a.pathname?"/":"")+a.pathname.slice(0,a.pathname.lastIndexOf("/")+1)+b.pathname:a.pathname)+(b.protocol||b.authority||b.pathname?b.search:b.search||a.search)+b.hash:null}function g(a){return a.split("#")[0]}function h(a,b){if(a&&"object"==typeof a)if(void 0===b?b=a.id:"string"==typeof a.id&&(b=f(b,a.id),a.id=b),Array.isArray(a))for(var c=0;c<a.length;c++)h(a[c],b);else{"string"==typeof a.$ref&&(a.$ref=f(b,a.$ref));for(var d in a)"enum"!==d&&h(a[d],b)}}function i(a){a=a||"en";var b=v[a];return function(a){var c=b[a.code]||u[a.code];if("string"!=typeof c)return"Unknown error code "+a.code+": "+JSON.stringify(a.messageParams);var d=a.params;return c.replace(/\{([^{}]*)\}/g,function(a,b){var c=d[b];return"string"==typeof c||"number"==typeof c?c:a})}}function j(a,b,c,d,e){if(Error.call(this),void 0===a)throw new Error("No error code supplied: "+d);this.message="",this.params=b,this.code=a,this.dataPath=c||"",this.schemaPath=d||"",this.subErrors=e||null;var f=new Error(this.message);if(this.stack=f.stack||f.stacktrace,!this.stack)try{throw f}catch(a){this.stack=a.stack||a.stacktrace}}function k(a,b){if(b.substring(0,a.length)===a){var c=b.substring(a.length);if(b.length>0&&"/"===b.charAt(a.length-1)||"#"===c.charAt(0)||"?"===c.charAt(0))return!0}return!1}function l(a){var b,c,d=new o,e={setErrorReporter:function(a){return"string"==typeof a?this.language(a):(c=a,!0)},addFormat:function(){d.addFormat.apply(d,arguments)},language:function(a){return a?(v[a]||(a=a.split("-")[0]),!!v[a]&&(b=a,a)):b},addLanguage:function(a,b){var c;for(c in r)b[c]&&!b[r[c]]&&(b[r[c]]=b[c]);var d=a.split("-")[0];if(v[d]){v[a]=Object.create(v[d]);for(c in b)"undefined"==typeof v[d][c]&&(v[d][c]=b[c]),v[a][c]=b[c]}else v[a]=b,v[d]=b;return this},freshApi:function(a){var b=l();return a&&b.language(a),b},validate:function(a,e,f,g){var h=i(b),j=c?function(a,b,d){return c(a,b,d)||h(a,b,d)}:h,k=new o(d,!1,j,f,g);"string"==typeof e&&(e={$ref:e}),k.addSchema("",e);var l=k.validateAll(a,e,null,null,"");return!l&&g&&(l=k.banUnknownProperties(a,e)),this.error=l,this.missing=k.missing,this.valid=null===l,this.valid},validateResult:function(){var a={};return this.validate.apply(a,arguments),a},validateMultiple:function(a,e,f,g){var h=i(b),j=c?function(a,b,d){return c(a,b,d)||h(a,b,d)}:h,k=new o(d,!0,j,f,g);"string"==typeof e&&(e={$ref:e}),k.addSchema("",e),k.validateAll(a,e,null,null,""),g&&k.banUnknownProperties(a,e);var l={};return l.errors=k.errors,l.missing=k.missing,l.valid=0===l.errors.length,l},addSchema:function(){return d.addSchema.apply(d,arguments)},getSchema:function(){return d.getSchema.apply(d,arguments)},getSchemaMap:function(){return d.getSchemaMap.apply(d,arguments)},getSchemaUris:function(){return d.getSchemaUris.apply(d,arguments)},getMissingUris:function(){return d.getMissingUris.apply(d,arguments)},dropSchemas:function(){d.dropSchemas.apply(d,arguments)},defineKeyword:function(){d.defineKeyword.apply(d,arguments)},defineError:function(a,b,c){if("string"!=typeof a||!/^[A-Z]+(_[A-Z]+)*$/.test(a))throw new Error("Code name must be a string in UPPER_CASE_WITH_UNDERSCORES");if("number"!=typeof b||b%1!==0||1e4>b)throw new Error("Code number must be an integer > 10000");if("undefined"!=typeof r[a])throw new Error("Error already defined: "+a+" as "+r[a]);if("undefined"!=typeof s[b])throw new Error("Error code already used: "+s[b]+" as "+b);r[a]=b,s[b]=a,u[a]=u[b]=c;for(var d in v){var e=v[d];e[a]&&(e[b]=e[b]||e[a])}},reset:function(){d.reset(),this.error=null,this.missing=[],this.valid=!0},missing:[],error:null,valid:!0,normSchema:h,resolveUrl:f,getDocumentUri:g,errorCodes:r};return e.language(a||"en"),e}Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}()),Object.create||(Object.create=function(){function a(){}return function(b){if(1!==arguments.length)throw new Error("Object.create implementation only accepts one parameter.");return a.prototype=b,new a}}()),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==1/0&&d!==-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Object.isFrozen||(Object.isFrozen=function(a){for(var b="tv4_test_frozen_key";a.hasOwnProperty(b);)b+=Math.random();try{return a[b]=!0,delete a[b],!1}catch(a){return!0}});var m={"+":!0,"#":!0,".":!0,"/":!0,";":!0,"?":!0,"&":!0},n={"*":!0};c.prototype={toString:function(){return this.template},fillFromObject:function(a){return this.fill(function(b){return a[b]})}};var o=function(a,b,c,d,e){if(this.missing=[],this.missingMap={},this.formatValidators=a?Object.create(a.formatValidators):{},this.schemas=a?Object.create(a.schemas):{},this.collectMultiple=b,this.errors=[],this.handleError=b?this.collectError:this.returnError,d&&(this.checkRecursive=!0,this.scanned=[],this.scannedFrozen=[],this.scannedFrozenSchemas=[],this.scannedFrozenValidationErrors=[],this.validatedSchemasKey="tv4_validation_id",this.validationErrorsKey="tv4_validation_errors_id"),e&&(this.trackUnknownProperties=!0,this.knownPropertyPaths={},this.unknownPropertyPaths={}),this.errorReporter=c||i("en"),"string"==typeof this.errorReporter)throw new Error("debug");if(this.definedKeywords={},a)for(var f in a.definedKeywords)this.definedKeywords[f]=a.definedKeywords[f].slice(0)};o.prototype.defineKeyword=function(a,b){this.definedKeywords[a]=this.definedKeywords[a]||[],this.definedKeywords[a].push(b)},o.prototype.createError=function(a,b,c,d,e,f,g){var h=new j(a,b,c,d,e);return h.message=this.errorReporter(h,f,g),h},o.prototype.returnError=function(a){return a},o.prototype.collectError=function(a){return a&&this.errors.push(a),null},o.prototype.prefixErrors=function(a,b,c){for(var d=a;d<this.errors.length;d++)this.errors[d]=this.errors[d].prefixWith(b,c);return this},o.prototype.banUnknownProperties=function(a,b){for(var c in this.unknownPropertyPaths){var d=this.createError(r.UNKNOWN_PROPERTY,{path:c},c,"",null,a,b),e=this.handleError(d);if(e)return e}return null},o.prototype.addFormat=function(a,b){if("object"==typeof a){for(var c in a)this.addFormat(c,a[c]);
return this}this.formatValidators[a]=b},o.prototype.resolveRefs=function(a,b){if(void 0!==a.$ref){if(b=b||{},b[a.$ref])return this.createError(r.CIRCULAR_REFERENCE,{urls:Object.keys(b).join(", ")},"","",null,void 0,a);b[a.$ref]=!0,a=this.getSchema(a.$ref,b)}return a},o.prototype.getSchema=function(a,b){var c;if(void 0!==this.schemas[a])return c=this.schemas[a],this.resolveRefs(c,b);var d=a,e="";if(-1!==a.indexOf("#")&&(e=a.substring(a.indexOf("#")+1),d=a.substring(0,a.indexOf("#"))),"object"==typeof this.schemas[d]){c=this.schemas[d];var f=decodeURIComponent(e);if(""===f)return this.resolveRefs(c,b);if("/"!==f.charAt(0))return;for(var g=f.split("/").slice(1),h=0;h<g.length;h++){var i=g[h].replace(/~1/g,"/").replace(/~0/g,"~");if(void 0===c[i]){c=void 0;break}c=c[i]}if(void 0!==c)return this.resolveRefs(c,b)}void 0===this.missing[d]&&(this.missing.push(d),this.missing[d]=d,this.missingMap[d]=d)},o.prototype.searchSchemas=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)this.searchSchemas(a[c],b);else if(a&&"object"==typeof a){"string"==typeof a.id&&k(b,a.id)&&void 0===this.schemas[a.id]&&(this.schemas[a.id]=a);for(var d in a)if("enum"!==d)if("object"==typeof a[d])this.searchSchemas(a[d],b);else if("$ref"===d){var e=g(a[d]);e&&void 0===this.schemas[e]&&void 0===this.missingMap[e]&&(this.missingMap[e]=e)}}},o.prototype.addSchema=function(a,b){if("string"!=typeof a||"undefined"==typeof b){if("object"!=typeof a||"string"!=typeof a.id)return;b=a,a=b.id}a===g(a)+"#"&&(a=g(a)),this.schemas[a]=b,delete this.missingMap[a],h(b,a),this.searchSchemas(b,a)},o.prototype.getSchemaMap=function(){var a={};for(var b in this.schemas)a[b]=this.schemas[b];return a},o.prototype.getSchemaUris=function(a){var b=[];for(var c in this.schemas)(!a||a.test(c))&&b.push(c);return b},o.prototype.getMissingUris=function(a){var b=[];for(var c in this.missingMap)(!a||a.test(c))&&b.push(c);return b},o.prototype.dropSchemas=function(){this.schemas={},this.reset()},o.prototype.reset=function(){this.missing=[],this.missingMap={},this.errors=[]},o.prototype.validateAll=function(a,b,c,d,e){var f;if(b=this.resolveRefs(b),!b)return null;if(b instanceof j)return this.errors.push(b),b;var g,h=this.errors.length,i=null,k=null;if(this.checkRecursive&&a&&"object"==typeof a){if(f=!this.scanned.length,a[this.validatedSchemasKey]){var l=a[this.validatedSchemasKey].indexOf(b);if(-1!==l)return this.errors=this.errors.concat(a[this.validationErrorsKey][l]),null}if(Object.isFrozen(a)&&(g=this.scannedFrozen.indexOf(a),-1!==g)){var m=this.scannedFrozenSchemas[g].indexOf(b);if(-1!==m)return this.errors=this.errors.concat(this.scannedFrozenValidationErrors[g][m]),null}if(this.scanned.push(a),Object.isFrozen(a))-1===g&&(g=this.scannedFrozen.length,this.scannedFrozen.push(a),this.scannedFrozenSchemas.push([])),i=this.scannedFrozenSchemas[g].length,this.scannedFrozenSchemas[g][i]=b,this.scannedFrozenValidationErrors[g][i]=[];else{if(!a[this.validatedSchemasKey])try{Object.defineProperty(a,this.validatedSchemasKey,{value:[],configurable:!0}),Object.defineProperty(a,this.validationErrorsKey,{value:[],configurable:!0})}catch(b){a[this.validatedSchemasKey]=[],a[this.validationErrorsKey]=[]}k=a[this.validatedSchemasKey].length,a[this.validatedSchemasKey][k]=b,a[this.validationErrorsKey][k]=[]}}var n=this.errors.length,o=this.validateBasic(a,b,e)||this.validateNumeric(a,b,e)||this.validateString(a,b,e)||this.validateArray(a,b,e)||this.validateObject(a,b,e)||this.validateCombinations(a,b,e)||this.validateHypermedia(a,b,e)||this.validateFormat(a,b,e)||this.validateDefinedKeywords(a,b,e)||null;if(f){for(;this.scanned.length;){var p=this.scanned.pop();delete p[this.validatedSchemasKey]}this.scannedFrozen=[],this.scannedFrozenSchemas=[]}if(o||n!==this.errors.length)for(;c&&c.length||d&&d.length;){var q=c&&c.length?""+c.pop():null,r=d&&d.length?""+d.pop():null;o&&(o=o.prefixWith(q,r)),this.prefixErrors(n,q,r)}return null!==i?this.scannedFrozenValidationErrors[g][i]=this.errors.slice(h):null!==k&&(a[this.validationErrorsKey][k]=this.errors.slice(h)),this.handleError(o)},o.prototype.validateFormat=function(a,b){if("string"!=typeof b.format||!this.formatValidators[b.format])return null;var c=this.formatValidators[b.format].call(null,a,b);return"string"==typeof c||"number"==typeof c?this.createError(r.FORMAT_CUSTOM,{message:c},"","/format",null,a,b):c&&"object"==typeof c?this.createError(r.FORMAT_CUSTOM,{message:c.message||"?"},c.dataPath||"",c.schemaPath||"/format",null,a,b):null},o.prototype.validateDefinedKeywords=function(a,b,c){for(var d in this.definedKeywords)if("undefined"!=typeof b[d])for(var e=this.definedKeywords[d],f=0;f<e.length;f++){var g=e[f],h=g(a,b[d],b,c);if("string"==typeof h||"number"==typeof h)return this.createError(r.KEYWORD_CUSTOM,{key:d,message:h},"","",null,a,b).prefixWith(null,d);if(h&&"object"==typeof h){var i=h.code;if("string"==typeof i){if(!r[i])throw new Error("Undefined error code (use defineError): "+i);i=r[i]}else"number"!=typeof i&&(i=r.KEYWORD_CUSTOM);var j="object"==typeof h.message?h.message:{key:d,message:h.message||"?"},k=h.schemaPath||"/"+d.replace(/~/g,"~0").replace(/\//g,"~1");return this.createError(i,j,h.dataPath||null,k,null,a,b)}}return null},o.prototype.validateBasic=function(a,b,c){var d;return(d=this.validateType(a,b,c))?d.prefixWith(null,"type"):(d=this.validateEnum(a,b,c))?d.prefixWith(null,"type"):null},o.prototype.validateType=function(a,b){if(void 0===b.type)return null;var c=typeof a;null===a?c="null":Array.isArray(a)&&(c="array");var d=b.type;Array.isArray(d)||(d=[d]);for(var e=0;e<d.length;e++){var f=d[e];if(f===c||"integer"===f&&"number"===c&&a%1===0)return null}return this.createError(r.INVALID_TYPE,{type:c,expected:d.join("/")},"","",null,a,b)},o.prototype.validateEnum=function(a,b){if(void 0===b.enum)return null;for(var c=0;c<b.enum.length;c++){var e=b.enum[c];if(d(a,e))return null}return this.createError(r.ENUM_MISMATCH,{value:"undefined"!=typeof JSON?JSON.stringify(a):a},"","",null,a,b)},o.prototype.validateNumeric=function(a,b,c){return this.validateMultipleOf(a,b,c)||this.validateMinMax(a,b,c)||this.validateNaN(a,b,c)||null};var p=Math.pow(2,-51),q=1-p;o.prototype.validateMultipleOf=function(a,b){var c=b.multipleOf||b.divisibleBy;if(void 0===c)return null;if("number"==typeof a){var d=a/c%1;if(d>=p&&q>d)return this.createError(r.NUMBER_MULTIPLE_OF,{value:a,multipleOf:c},"","",null,a,b)}return null},o.prototype.validateMinMax=function(a,b){if("number"!=typeof a)return null;if(void 0!==b.minimum){if(a<b.minimum)return this.createError(r.NUMBER_MINIMUM,{value:a,minimum:b.minimum},"","/minimum",null,a,b);if(b.exclusiveMinimum&&a===b.minimum)return this.createError(r.NUMBER_MINIMUM_EXCLUSIVE,{value:a,minimum:b.minimum},"","/exclusiveMinimum",null,a,b)}if(void 0!==b.maximum){if(a>b.maximum)return this.createError(r.NUMBER_MAXIMUM,{value:a,maximum:b.maximum},"","/maximum",null,a,b);if(b.exclusiveMaximum&&a===b.maximum)return this.createError(r.NUMBER_MAXIMUM_EXCLUSIVE,{value:a,maximum:b.maximum},"","/exclusiveMaximum",null,a,b)}return null},o.prototype.validateNaN=function(a,b){return"number"!=typeof a?null:isNaN(a)===!0||a===1/0||a===-(1/0)?this.createError(r.NUMBER_NOT_A_NUMBER,{value:a},"","/type",null,a,b):null},o.prototype.validateString=function(a,b,c){return this.validateStringLength(a,b,c)||this.validateStringPattern(a,b,c)||null},o.prototype.validateStringLength=function(a,b){return"string"!=typeof a?null:void 0!==b.minLength&&a.length<b.minLength?this.createError(r.STRING_LENGTH_SHORT,{length:a.length,minimum:b.minLength},"","/minLength",null,a,b):void 0!==b.maxLength&&a.length>b.maxLength?this.createError(r.STRING_LENGTH_LONG,{length:a.length,maximum:b.maxLength},"","/maxLength",null,a,b):null},o.prototype.validateStringPattern=function(a,b){if("string"!=typeof a||"string"!=typeof b.pattern&&!(b.pattern instanceof RegExp))return null;var c;if(b.pattern instanceof RegExp)c=b.pattern;else{var d,e="",f=b.pattern.match(/^\/(.+)\/([img]*)$/);f?(d=f[1],e=f[2]):d=b.pattern,c=new RegExp(d,e)}return c.test(a)?null:this.createError(r.STRING_PATTERN,{pattern:b.pattern},"","/pattern",null,a,b)},o.prototype.validateArray=function(a,b,c){return Array.isArray(a)?this.validateArrayLength(a,b,c)||this.validateArrayUniqueItems(a,b,c)||this.validateArrayItems(a,b,c)||null:null},o.prototype.validateArrayLength=function(a,b){var c;return void 0!==b.minItems&&a.length<b.minItems&&(c=this.createError(r.ARRAY_LENGTH_SHORT,{length:a.length,minimum:b.minItems},"","/minItems",null,a,b),this.handleError(c))?c:void 0!==b.maxItems&&a.length>b.maxItems&&(c=this.createError(r.ARRAY_LENGTH_LONG,{length:a.length,maximum:b.maxItems},"","/maxItems",null,a,b),this.handleError(c))?c:null},o.prototype.validateArrayUniqueItems=function(a,b){if(b.uniqueItems)for(var c=0;c<a.length;c++)for(var e=c+1;e<a.length;e++)if(d(a[c],a[e])){var f=this.createError(r.ARRAY_UNIQUE,{match1:c,match2:e},"","/uniqueItems",null,a,b);if(this.handleError(f))return f}return null},o.prototype.validateArrayItems=function(a,b,c){if(void 0===b.items)return null;var d,e;if(Array.isArray(b.items)){for(e=0;e<a.length;e++)if(e<b.items.length){if(d=this.validateAll(a[e],b.items[e],[e],["items",e],c+"/"+e))return d}else if(void 0!==b.additionalItems)if("boolean"==typeof b.additionalItems){if(!b.additionalItems&&(d=this.createError(r.ARRAY_ADDITIONAL_ITEMS,{},"/"+e,"/additionalItems",null,a,b),this.handleError(d)))return d}else if(d=this.validateAll(a[e],b.additionalItems,[e],["additionalItems"],c+"/"+e))return d}else for(e=0;e<a.length;e++)if(d=this.validateAll(a[e],b.items,[e],["items"],c+"/"+e))return d;return null},o.prototype.validateObject=function(a,b,c){return"object"!=typeof a||null===a||Array.isArray(a)?null:this.validateObjectMinMaxProperties(a,b,c)||this.validateObjectRequiredProperties(a,b,c)||this.validateObjectProperties(a,b,c)||this.validateObjectDependencies(a,b,c)||null},o.prototype.validateObjectMinMaxProperties=function(a,b){var c,d=Object.keys(a);return void 0!==b.minProperties&&d.length<b.minProperties&&(c=this.createError(r.OBJECT_PROPERTIES_MINIMUM,{propertyCount:d.length,minimum:b.minProperties},"","/minProperties",null,a,b),this.handleError(c))?c:void 0!==b.maxProperties&&d.length>b.maxProperties&&(c=this.createError(r.OBJECT_PROPERTIES_MAXIMUM,{propertyCount:d.length,maximum:b.maxProperties},"","/maxProperties",null,a,b),this.handleError(c))?c:null},o.prototype.validateObjectRequiredProperties=function(a,b){if(void 0!==b.required)for(var c=0;c<b.required.length;c++){var d=b.required[c];if(void 0===a[d]){var e=this.createError(r.OBJECT_REQUIRED,{key:d},"","/required/"+c,null,a,b);if(this.handleError(e))return e}}return null},o.prototype.validateObjectProperties=function(a,b,c){var d;for(var e in a){var f=c+"/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),g=!1;if(void 0!==b.properties&&void 0!==b.properties[e]&&(g=!0,d=this.validateAll(a[e],b.properties[e],[e],["properties",e],f)))return d;if(void 0!==b.patternProperties)for(var h in b.patternProperties){var i=new RegExp(h);if(i.test(e)&&(g=!0,d=this.validateAll(a[e],b.patternProperties[h],[e],["patternProperties",h],f)))return d}if(g)this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]);else if(void 0!==b.additionalProperties){if(this.trackUnknownProperties&&(this.knownPropertyPaths[f]=!0,delete this.unknownPropertyPaths[f]),"boolean"==typeof b.additionalProperties){if(!b.additionalProperties&&(d=this.createError(r.OBJECT_ADDITIONAL_PROPERTIES,{key:e},"","/additionalProperties",null,a,b).prefixWith(e,null),this.handleError(d)))return d}else if(d=this.validateAll(a[e],b.additionalProperties,[e],["additionalProperties"],f))return d}else this.trackUnknownProperties&&!this.knownPropertyPaths[f]&&(this.unknownPropertyPaths[f]=!0)}return null},o.prototype.validateObjectDependencies=function(a,b,c){var d;if(void 0!==b.dependencies)for(var e in b.dependencies)if(void 0!==a[e]){var f=b.dependencies[e];if("string"==typeof f){if(void 0===a[f]&&(d=this.createError(r.OBJECT_DEPENDENCY_KEY,{key:e,missing:f},"","",null,a,b).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(Array.isArray(f))for(var g=0;g<f.length;g++){var h=f[g];if(void 0===a[h]&&(d=this.createError(r.OBJECT_DEPENDENCY_KEY,{key:e,missing:h},"","/"+g,null,a,b).prefixWith(null,e).prefixWith(null,"dependencies"),this.handleError(d)))return d}else if(d=this.validateAll(a,f,[],["dependencies",e],c))return d}return null},o.prototype.validateCombinations=function(a,b,c){return this.validateAllOf(a,b,c)||this.validateAnyOf(a,b,c)||this.validateOneOf(a,b,c)||this.validateNot(a,b,c)||null},o.prototype.validateAllOf=function(a,b,c){if(void 0===b.allOf)return null;for(var d,e=0;e<b.allOf.length;e++){var f=b.allOf[e];if(d=this.validateAll(a,f,[],["allOf",e],c))return d}return null},o.prototype.validateAnyOf=function(a,b,c){if(void 0===b.anyOf)return null;var d,e,f=[],g=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths);for(var h=!0,i=0;i<b.anyOf.length;i++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var j=b.anyOf[i],k=this.errors.length,l=this.validateAll(a,j,[],["anyOf",i],c);if(null===l&&k===this.errors.length){if(this.errors=this.errors.slice(0,g),this.trackUnknownProperties){for(var m in this.knownPropertyPaths)e[m]=!0,delete d[m];for(var n in this.unknownPropertyPaths)e[n]||(d[n]=!0);h=!1;continue}return null}l&&f.push(l.prefixWith(null,""+i).prefixWith(null,"anyOf"))}return this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),h?(f=f.concat(this.errors.slice(g)),this.errors=this.errors.slice(0,g),this.createError(r.ANY_OF_MISSING,{},"","/anyOf",f,a,b)):void 0},o.prototype.validateOneOf=function(a,b,c){if(void 0===b.oneOf)return null;var d,e,f=null,g=[],h=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths);for(var i=0;i<b.oneOf.length;i++){this.trackUnknownProperties&&(this.unknownPropertyPaths={},this.knownPropertyPaths={});var j=b.oneOf[i],k=this.errors.length,l=this.validateAll(a,j,[],["oneOf",i],c);if(null===l&&k===this.errors.length){if(null!==f)return this.errors=this.errors.slice(0,h),this.createError(r.ONE_OF_MULTIPLE,{index1:f,index2:i},"","/oneOf",null,a,b);if(f=i,this.trackUnknownProperties){for(var m in this.knownPropertyPaths)e[m]=!0,delete d[m];for(var n in this.unknownPropertyPaths)e[n]||(d[n]=!0)}}else l&&g.push(l)}return this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),null===f?(g=g.concat(this.errors.slice(h)),this.errors=this.errors.slice(0,h),this.createError(r.ONE_OF_MISSING,{},"","/oneOf",g,a,b)):(this.errors=this.errors.slice(0,h),null)},o.prototype.validateNot=function(a,b,c){if(void 0===b.not)return null;var d,e,f=this.errors.length;this.trackUnknownProperties&&(d=this.unknownPropertyPaths,e=this.knownPropertyPaths,this.unknownPropertyPaths={},this.knownPropertyPaths={});var g=this.validateAll(a,b.not,null,null,c),h=this.errors.slice(f);return this.errors=this.errors.slice(0,f),this.trackUnknownProperties&&(this.unknownPropertyPaths=d,this.knownPropertyPaths=e),null===g&&0===h.length?this.createError(r.NOT_PASSED,{},"","/not",null,a,b):null},o.prototype.validateHypermedia=function(a,b,d){if(!b.links)return null;for(var e,f=0;f<b.links.length;f++){var g=b.links[f];if("describedby"===g.rel){for(var h=new c(g.href),i=!0,j=0;j<h.varNames.length;j++)if(!(h.varNames[j]in a)){i=!1;break}if(i){var k=h.fillFromObject(a),l={$ref:k};if(e=this.validateAll(a,l,[],["links",f],d))return e}}}};var r={INVALID_TYPE:0,ENUM_MISMATCH:1,ANY_OF_MISSING:10,ONE_OF_MISSING:11,ONE_OF_MULTIPLE:12,NOT_PASSED:13,NUMBER_MULTIPLE_OF:100,NUMBER_MINIMUM:101,NUMBER_MINIMUM_EXCLUSIVE:102,NUMBER_MAXIMUM:103,NUMBER_MAXIMUM_EXCLUSIVE:104,NUMBER_NOT_A_NUMBER:105,STRING_LENGTH_SHORT:200,STRING_LENGTH_LONG:201,STRING_PATTERN:202,OBJECT_PROPERTIES_MINIMUM:300,OBJECT_PROPERTIES_MAXIMUM:301,OBJECT_REQUIRED:302,OBJECT_ADDITIONAL_PROPERTIES:303,OBJECT_DEPENDENCY_KEY:304,ARRAY_LENGTH_SHORT:400,ARRAY_LENGTH_LONG:401,ARRAY_UNIQUE:402,ARRAY_ADDITIONAL_ITEMS:403,FORMAT_CUSTOM:500,KEYWORD_CUSTOM:501,CIRCULAR_REFERENCE:600,UNKNOWN_PROPERTY:1e3},s={};for(var t in r)s[r[t]]=t;var u={INVALID_TYPE:"Invalid type: {type} (expected {expected})",ENUM_MISMATCH:"No enum match for: {value}",ANY_OF_MISSING:'Data does not match any schemas from "anyOf"',ONE_OF_MISSING:'Data does not match any schemas from "oneOf"',ONE_OF_MULTIPLE:'Data is valid against more than one schema from "oneOf": indices {index1} and {index2}',NOT_PASSED:'Data matches schema from "not"',NUMBER_MULTIPLE_OF:"Value {value} is not a multiple of {multipleOf}",NUMBER_MINIMUM:"Value {value} is less than minimum {minimum}",NUMBER_MINIMUM_EXCLUSIVE:"Value {value} is equal to exclusive minimum {minimum}",NUMBER_MAXIMUM:"Value {value} is greater than maximum {maximum}",NUMBER_MAXIMUM_EXCLUSIVE:"Value {value} is equal to exclusive maximum {maximum}",NUMBER_NOT_A_NUMBER:"Value {value} is not a valid number",STRING_LENGTH_SHORT:"String is too short ({length} chars), minimum {minimum}",STRING_LENGTH_LONG:"String is too long ({length} chars), maximum {maximum}",STRING_PATTERN:"String does not match pattern: {pattern}",OBJECT_PROPERTIES_MINIMUM:"Too few properties defined ({propertyCount}), minimum {minimum}",OBJECT_PROPERTIES_MAXIMUM:"Too many properties defined ({propertyCount}), maximum {maximum}",OBJECT_REQUIRED:"Missing required property: {key}",OBJECT_ADDITIONAL_PROPERTIES:"Additional properties not allowed",OBJECT_DEPENDENCY_KEY:"Dependency failed - key must exist: {missing} (due to key: {key})",ARRAY_LENGTH_SHORT:"Array is too short ({length}), minimum {minimum}",ARRAY_LENGTH_LONG:"Array is too long ({length}), maximum {maximum}",ARRAY_UNIQUE:"Array items are not unique (indices {match1} and {match2})",ARRAY_ADDITIONAL_ITEMS:"Additional items not allowed",FORMAT_CUSTOM:"Format validation failed ({message})",KEYWORD_CUSTOM:"Keyword failed: {key} ({message})",CIRCULAR_REFERENCE:"Circular $refs: {urls}",UNKNOWN_PROPERTY:"Unknown property (not in schema)"};j.prototype=Object.create(Error.prototype),j.prototype.constructor=j,j.prototype.name="ValidationError",j.prototype.prefixWith=function(a,b){if(null!==a&&(a=a.replace(/~/g,"~0").replace(/\//g,"~1"),this.dataPath="/"+a+this.dataPath),null!==b&&(b=b.replace(/~/g,"~0").replace(/\//g,"~1"),this.schemaPath="/"+b+this.schemaPath),null!==this.subErrors)for(var c=0;c<this.subErrors.length;c++)this.subErrors[c].prefixWith(a,b);return this};var v={},w=l();return w.addLanguage("en-gb",u),w.tv4=w,w});var CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Math.uuid=function(a,b){var c,d=CHARS,e=[];if(b=b||d.length,a)for(c=0;a>c;c++)e[c]=d[0|Math.random()*b];else{var f;for(e[8]=e[13]=e[18]=e[23]="-",e[14]="4",c=0;36>c;c++)e[c]||(f=0|16*Math.random(),e[c]=d[19==c?3&f|8:f])}return e.join("")},function(a){function b(a,b){console.log("WARNING: "+a+" is deprecated. Use "+b+" instead.")}var c=RemoteStorage;c.BaseClient=function(a,b){if("/"!==b[b.length-1])throw"Not a folder: "+b;"/"===b&&(this.makePath=function(a){return("/"===a[0]?"":"/")+a}),this.storage=a,this.base=b;var d=this.base.split("/");d.length>2?this.moduleName=d[1]:this.moduleName="root",c.eventHandling(this,"change"),this.on=this.on.bind(this),a.onChange(this.base,this._fireChange.bind(this))},c.BaseClient.prototype={extend:function(a){for(var b in a)this[b]=a[b];return this},scope:function(a){return new c.BaseClient(this.storage,this.makePath(a))},getListing:function(a,b){if("string"!=typeof a)a="";else if(a.length>0&&"/"!==a[a.length-1])return Promise.reject("Not a folder: "+a);return this.storage.get(this.makePath(a),b).then(function(a){return 404===a.statusCode?{}:a.body})},getAll:function(a,b){if("string"!=typeof a)a="";else if(a.length>0&&"/"!==a[a.length-1])return Promise.reject("Not a folder: "+a);return this.storage.get(this.makePath(a),b).then(function(c){if(404===c.statusCode)return{};if("object"==typeof c.body){var d=Object.keys(c.body);if(0===d.length)return{};var e=d.map(function(d){return this.storage.get(this.makePath(a+d),b).then(function(a){if("string"==typeof a.body)try{a.body=JSON.parse(a.body)}catch(a){}"object"==typeof a.body&&(c.body[d]=a.body)})}.bind(this));return Promise.all(e).then(function(){return c.body})}}.bind(this))},getFile:function(a,b){return"string"!=typeof a?Promise.reject("Argument 'path' of baseClient.getFile must be a string"):this.storage.get(this.makePath(a),b).then(function(a){return{data:a.body,contentType:a.contentType,revision:a.revision}})},storeFile:function(a,b,c){return"string"!=typeof a?Promise.reject("Argument 'mimeType' of baseClient.storeFile must be a string"):"string"!=typeof b?Promise.reject("Argument 'path' of baseClient.storeFile must be a string"):"string"!=typeof c&&"object"!=typeof c?Promise.reject("Argument 'body' of baseClient.storeFile must be a string, ArrayBuffer, or ArrayBufferView"):(this.storage.access.checkPathPermission(this.makePath(b),"rw")||console.warn("WARNING: Editing a document to which only read access ('r') was claimed"),this.storage.put(this.makePath(b),c,a).then(function(a){return 200===a.statusCode||201===a.statusCode?a.revision:Promise.reject("Request (PUT "+this.makePath(b)+") failed with status: "+a.statusCode)}.bind(this)))},getObject:function(a,b){return"string"!=typeof a?Promise.reject("Argument 'path' of baseClient.getObject must be a string"):this.storage.get(this.makePath(a),b).then(function(b){if("object"==typeof b.body)return b.body;if("string"==typeof b.body)try{return JSON.parse(b.body)}catch(b){throw"Not valid JSON: "+this.makePath(a)}else if("undefined"!=typeof b.body&&200===b.statusCode)return Promise.reject("Not an object: "+this.makePath(a))}.bind(this))},storeObject:function(a,b,c){if("string"!=typeof a)return Promise.reject("Argument 'typeAlias' of baseClient.storeObject must be a string");if("string"!=typeof b)return Promise.reject("Argument 'path' of baseClient.storeObject must be a string");if("object"!=typeof c)return Promise.reject("Argument 'object' of baseClient.storeObject must be an object");this._attachType(c,a);try{var d=this.validate(c);if(!d.valid)return Promise.reject(d)}catch(a){return Promise.reject(a)}return this.storage.put(this.makePath(b),JSON.stringify(c),"application/json; charset=UTF-8").then(function(a){return 200===a.statusCode||201===a.statusCode?a.revision:Promise.reject("Request (PUT "+this.makePath(b)+") failed with status: "+a.statusCode)}.bind(this))},remove:function(a){return"string"!=typeof a?Promise.reject("Argument 'path' of baseClient.remove must be a string"):(this.storage.access.checkPathPermission(this.makePath(a),"rw")||console.warn("WARNING: Removing a document to which only read access ('r') was claimed"),this.storage.delete(this.makePath(a)))},cache:function(a,c){if("string"!=typeof a)throw"Argument 'path' of baseClient.cache must be a string";if(c===!1?(b("caching strategy <false>",'<"FLUSH">'),c="FLUSH"):void 0===c?c="ALL":"string"!=typeof c&&(b("that caching strategy",'<"ALL">'),c="ALL"),"FLUSH"!==c&&"SEEN"!==c&&"ALL"!==c)throw'Argument \'strategy\' of baseclient.cache must be one of ["FLUSH", "SEEN", "ALL"]';return this.storage.caching.set(this.makePath(a),c),this},flush:function(a){return this.storage.local.flush(a)},makePath:function(a){return this.base+(a||"")},_fireChange:function(a){RemoteStorage.config.changeEvents[a.origin]&&(["new","old","lastCommon"].forEach(function(b){if((!a[b+"ContentType"]||/^application\/(.*)json(.*)/.exec(a[b+"ContentType"]))&&"string"==typeof a[b+"Value"])try{a[b+"Value"]=JSON.parse(a[b+"Value"])}catch(a){}}),this._emit("change",a))},_cleanPath:RemoteStorage.util.cleanPath,getItemURL:function(a){if("string"!=typeof a)throw"Argument 'path' of baseClient.getItemURL must be a string";return this.storage.connected?(a=this._cleanPath(this.makePath(a)),this.storage.remote.href+a):void 0},uuid:function(){return Math.uuid()}},c.BaseClient._rs_init=function(){c.prototype.scope=function(a){if("string"!=typeof a)throw"Argument 'path' of baseClient.scope must be a string";if(!this.access.checkPathPermission(a,"r")){var b=a.replace(/(['\\])/g,"\\$1");console.warn("WARNING: please call remoteStorage.access.claim('"+b+"', 'r') (read only) or remoteStorage.access.claim('"+b+"', 'rw') (read/write) first")}return new c.BaseClient(this,a)}}}("undefined"!=typeof window?window:global),function(a){RemoteStorage.BaseClient.Types={uris:{},schemas:{},aliases:{},declare:function(a,b,c,d){var e=a+"/"+b;if(d.extends){var f,g=d.extends.split("/");f=1===g.length?a+"/"+g.shift():g.join("/");var h=this.uris[f];if(!h)throw"Type '"+e+"' tries to extend unknown schema '"+f+"'";d.extends=this.schemas[h]}this.uris[e]=c,this.aliases[c]=e,this.schemas[c]=d},resolveAlias:function(a){return this.uris[a]},getSchema:function(a){return this.schemas[a]},inScope:function(a){var b=a.length,c={};for(var d in this.uris)if(d.substr(0,b+1)===a+"/"){var e=this.uris[d];c[e]=this.schemas[e]}return c}};var b=function(a){var b=new Error("Schema not found: "+a);return b.name="SchemaNotFound",b};b.prototype=Error.prototype,RemoteStorage.BaseClient.Types.SchemaNotFound=b,RemoteStorage.BaseClient.prototype.extend({declareType:function(a,b,c){c||(c=b,b=this._defaultTypeURI(a)),RemoteStorage.BaseClient.Types.declare(this.moduleName,a,b,c)},validate:function(a){var c=RemoteStorage.BaseClient.Types.getSchema(a["@context"]);if(c)return tv4.validateResult(a,c);throw new b(a["@context"])},_defaultTypeURI:function(a){return"http://remotestorage.io/spec/modules/"+encodeURIComponent(this.moduleName)+"/"+encodeURIComponent(a)},_attachType:function(a,b){a["@context"]=RemoteStorage.BaseClient.Types.resolveAlias(this.moduleName+"/"+b)||this._defaultTypeURI(b)}}),Object.defineProperty(RemoteStorage.BaseClient.prototype,"schemas",{configurable:!0,get:function(){return RemoteStorage.BaseClient.Types.inScope(this.moduleName)}})}("undefined"!=typeof window?window:global),function(a){var b=RemoteStorage.util.containingFolder;RemoteStorage.Caching=function(){this.reset()},RemoteStorage.Caching.prototype={pendingActivations:[],set:function(a,b){if("string"!=typeof a)throw new Error("path should be a string");if(!RemoteStorage.util.isFolder(a))throw new Error("path should be a folder");if(this._remoteStorage&&this._remoteStorage.access&&!this._remoteStorage.access.checkPathPermission(a,"r"))throw new Error('No access to path "'+a+'". You have to claim access to it first.');if(!b.match(/^(FLUSH|SEEN|ALL)$/))throw new Error("strategy should be 'FLUSH', 'SEEN', or 'ALL'");this._rootPaths[a]=b,"ALL"===b&&(this.activateHandler?this.activateHandler(a):this.pendingActivations.push(a))},enable:function(a){this.set(a,"ALL")},disable:function(a){this.set(a,"FLUSH")},onActivate:function(a){var b;for(RemoteStorage.log("[Caching] Setting activate handler",a,this.pendingActivations),this.activateHandler=a,b=0;b<this.pendingActivations.length;b++)a(this.pendingActivations[b]);delete this.pendingActivations},checkPath:function(a){return void 0!==this._rootPaths[a]?this._rootPaths[a]:"/"===a?"SEEN":this.checkPath(b(a))},reset:function(){this._rootPaths={},this._remoteStorage=null}},Object.defineProperty(RemoteStorage.prototype,"caching",{configurable:!0,get:function(){var a=new RemoteStorage.Caching;return Object.defineProperty(this,"caching",{value:a}),a}}),RemoteStorage.Caching._rs_init=function(a){this._remoteStorage=a}}("undefined"!=typeof window?window:global),function(a){function b(a,b,c){return{action:a,path:b,promise:c}}function c(a){return a.remote&&a.remote.revision&&!a.remote.itemsMap&&!a.remote.body}function d(a){return a.common&&a.common.revision}function e(){function a(a){var c,d;c=b.getCurrentSyncInterval(),i=!a,d=b.getCurrentSyncInterval(),b._emit("sync-interval-change",{oldValue:c,newValue:d})}var b=this;RemoteStorage.Env.on("background",function(){a(!1)}),RemoteStorage.Env.on("foreground",function(){a(!0)})}function f(a){return"number"==typeof a&&a>1e3&&36e5>a}var g=1e4,h=6e4,i=!1,j=RemoteStorage.util.isFolder,k=RemoteStorage.util.isDocument,l=RemoteStorage.util.equal,m=RemoteStorage.util.deepClone,n=RemoteStorage.util.pathsFromRoot;RemoteStorage.Sync=function(a,b,c,d){this.local=a,this.local.onDiff(function(a){this.addTask(a),this.doTasks()}.bind(this)),this.remote=b,this.access=c,this.caching=d,this._tasks={},this._running={},this._timeStarted={},RemoteStorage.eventHandling(this,"done","req-done"),this.caching.onActivate(function(a){this.addTask(a),this.doTasks()}.bind(this))},RemoteStorage.Sync.prototype={now:function(){return(new Date).getTime()},queueGetRequest:function(a){var b=Promise.defer();return this.remote.connected?this.remote.online?(this.addTask(a,function(){this.local.get(a).then(function(a){return b.resolve(a)})}.bind(this)),this.doTasks()):b.reject("cannot fulfill maxAge requirement - remote is not online"):b.reject("cannot fulfill maxAge requirement - remote is not connected"),b.promise},corruptServerItemsMap:function(a,b){if("object"!=typeof a||Array.isArray(a))return!0;for(var c in a){var d=a[c];if("object"!=typeof d)return!0;if("string"!=typeof d.ETag)return!0;if(j(c)){if(-1!==c.substring(0,c.length-1).indexOf("/"))return!0}else{if(-1!==c.indexOf("/"))return!0;if(b){if("string"!=typeof d["Content-Type"])return!0;if("number"!=typeof d["Content-Length"])return!0}}}return!1},corruptItemsMap:function(a){if("object"!=typeof a||Array.isArray(a))return!0;for(var b in a)if("boolean"!=typeof a[b])return!0;return!1},corruptRevision:function(a){return"object"!=typeof a||Array.isArray(a)||a.revision&&"string"!=typeof a.revision||a.body&&"string"!=typeof a.body&&"object"!=typeof a.body||a.contentType&&"string"!=typeof a.contentType||a.contentLength&&"number"!=typeof a.contentLength||a.timestamp&&"number"!=typeof a.timestamp||a.itemsMap&&this.corruptItemsMap(a.itemsMap)},isCorrupt:function(a){return"object"!=typeof a||Array.isArray(a)||"string"!=typeof a.path||this.corruptRevision(a.common)||a.local&&this.corruptRevision(a.local)||a.remote&&this.corruptRevision(a.remote)||a.push&&this.corruptRevision(a.push)},hasTasks:function(){return Object.getOwnPropertyNames(this._tasks).length>0},collectDiffTasks:function(){var a=0;return this.local.forAllNodes(function(b){a>100||(this.isCorrupt(b)?(RemoteStorage.log("[Sync] WARNING: corrupt node in local cache",b),"object"==typeof b&&b.path&&(this.addTask(b.path),a++)):this.needsFetch(b)&&this.access.checkPathPermission(b.path,"r")?(this.addTask(b.path),a++):k(b.path)&&this.needsPush(b)&&this.access.checkPathPermission(b.path,"rw")&&(this.addTask(b.path),a++))}.bind(this)).then(function(){return a},function(a){throw a})},inConflict:function(a){return a.local&&a.remote&&(void 0!==a.remote.body||a.remote.itemsMap)},needsRefresh:function(a){return!!a.common&&(!a.common.timestamp||this.now()-a.common.timestamp>g)},needsFetch:function(a){return!!this.inConflict(a)||(!(!a.common||void 0!==a.common.itemsMap||void 0!==a.common.body)||!(!a.remote||void 0!==a.remote.itemsMap||void 0!==a.remote.body))},needsPush:function(a){return!this.inConflict(a)&&(!(!a.local||a.push)||void 0)},needsRemotePut:function(a){return a.local&&a.local.body},needsRemoteDelete:function(a){return a.local&&a.local.body===!1},getParentPath:function(a){var b=a.match(/^(.*\/)([^\/]+\/?)$/);if(b)return b[1];throw new Error('Not a valid path: "'+a+'"')},deleteChildPathsFromTasks:function(){for(var a in this._tasks)for(var b=n(a),c=1;c<b.length;c++)this._tasks[b[c]]&&(Array.isArray(this._tasks[a])&&this._tasks[a].length&&Array.prototype.push.apply(this._tasks[b[c]],this._tasks[a]),delete this._tasks[a])},collectRefreshTasks:function(){return this.local.forAllNodes(function(a){var b;if(this.needsRefresh(a)){try{b=this.getParentPath(a.path)}catch(a){}b&&this.access.checkPathPermission(b,"r")?this.addTask(b):this.access.checkPathPermission(a.path,"r")&&this.addTask(a.path)}}.bind(this)).then(function(){
this.deleteChildPathsFromTasks()}.bind(this),function(a){throw a})},flush:function(a){for(var b in a)"FLUSH"===this.caching.checkPath(b)&&a[b]&&!a[b].local&&(RemoteStorage.log("[Sync] Flushing",b),a[b]=void 0);return a},doTask:function(a){return this.local.getNodes([a]).then(function(e){var f=e[a];return"undefined"==typeof f?b("get",a,this.remote.get(a)):c(f)?b("get",a,this.remote.get(a)):this.needsRemotePut(f)?(f.push=m(f.local),f.push.timestamp=this.now(),this.local.setNodes(this.flush(e)).then(function(){var c;return c=d(f)?{ifMatch:f.common.revision}:{ifNoneMatch:"*"},b("put",a,this.remote.put(a,f.push.body,f.push.contentType,c))}.bind(this))):this.needsRemoteDelete(f)?(f.push={body:!1,timestamp:this.now()},this.local.setNodes(this.flush(e)).then(function(){return d(f)?b("delete",a,this.remote.delete(a,{ifMatch:f.common.revision})):b("get",a,this.remote.get(a))}.bind(this))):d(f)?b("get",a,this.remote.get(a,{ifNoneMatch:f.common.revision})):b("get",a,this.remote.get(a))}.bind(this))},autoMergeFolder:function(a){if(a.remote.itemsMap&&(a.common=a.remote,delete a.remote,a.common.itemsMap)){for(var b in a.common.itemsMap)a.local.itemsMap[b]||(a.local.itemsMap[b]=!1);l(a.local.itemsMap,a.common.itemsMap)&&delete a.local}return a},autoMergeDocument:function(a){return hasNoRemoteChanges=function(a){return(!a.remote||!a.remote.revision||a.remote.revision===a.common.revision)&&(void 0===a.common.body&&a.remote.body===!1||a.remote.body===a.common.body&&a.remote.contentType===a.common.contentType)},mergeMutualDeletion=function(a){return a.remote&&a.remote.body===!1&&a.local&&a.local.body===!1&&delete a.local,a},hasNoRemoteChanges(a)?(a=mergeMutualDeletion(a),delete a.remote):void 0!==a.remote.body&&(RemoteStorage.log("[Sync] Emitting keep/revert"),this.local._emitChange({origin:"conflict",path:a.path,oldValue:a.local.body,newValue:a.remote.body,lastCommonValue:a.common.body,oldContentType:a.local.contentType,newContentType:a.remote.contentType,lastCommonContentType:a.common.contentType}),a.remote.body?a.common=a.remote:a.common={},delete a.remote,delete a.local),a},autoMerge:function(a){if(!a.remote)return void(a.common.body&&this.local._emitChange({origin:"remote",path:a.path,oldValue:a.common.body,newValue:void 0,oldContentType:a.common.contentType,newContentType:void 0}));if(a.local)return j(a.path)?this.autoMergeFolder(a):this.autoMergeDocument(a);if(j(a.path))void 0!==a.remote.itemsMap&&(a.common=a.remote,delete a.remote);else if(void 0!==a.remote.body){var b={origin:"remote",path:a.path,oldValue:a.common.body===!1?void 0:a.common.body,newValue:a.remote.body===!1?void 0:a.remote.body,oldContentType:a.common.contentType,newContentType:a.remote.contentType};if((b.oldValue||b.newValue)&&this.local._emitChange(b),!a.remote.body)return;a.common=a.remote,delete a.remote}return a},updateCommonTimestamp:function(a,b){return this.local.getNodes([a]).then(function(c){return c[a]&&c[a].common&&c[a].common.revision===b&&(c[a].common.timestamp=this.now()),this.local.setNodes(this.flush(c))}.bind(this))},markChildren:function(a,b,c,d){var e=[],f={},g={};for(var h in b)e.push(a+h),f[a+h]=b[h];for(var i in d)e.push(a+i);return this.local.getNodes(e).then(function(b){var e,h,i=function(a,b){return a.common.revision!==b&&(!a.remote||a.remote.revision!==b)};for(var k in b)if(h=b[k],f[k])h&&h.common?i(h,f[k].ETag)&&(c[k]=m(h),c[k].remote={revision:f[k].ETag,timestamp:this.now()},c[k]=this.autoMerge(c[k])):(e=this.caching.checkPath(k),"ALL"===e&&(c[k]={path:k,common:{timestamp:this.now()},remote:{revision:f[k].ETag,timestamp:this.now()}})),c[k]&&f[k]["Content-Type"]&&(c[k].remote.contentType=f[k]["Content-Type"]),c[k]&&f[k]["Content-Length"]&&(c[k].remote.contentLength=f[k]["Content-Length"]);else if(d[k.substring(a.length)]&&h&&h.common){if(h.common.itemsMap)for(var n in h.common.itemsMap)g[k+n]=!0;if(h.local&&h.local.itemsMap)for(var o in h.local.itemsMap)g[k+o]=!0;if(h.remote||j(k))c[k]=void 0;else if(c[k]=this.autoMerge(h),"undefined"==typeof c[k]){var p=this.getParentPath(k),q=c[p],r=k.substring(a.length);q&&q.local&&(delete q.local.itemsMap[r],l(q.local.itemsMap,q.common.itemsMap)&&delete q.local)}}return this.deleteRemoteTrees(Object.keys(g),c).then(function(a){return this.local.setNodes(this.flush(a))}.bind(this))}.bind(this))},deleteRemoteTrees:function(a,b){return 0===a.length?Promise.resolve(b):this.local.getNodes(a).then(function(a){var c={};collectSubPaths=function(a,b){if(a&&a.itemsMap)for(var d in a.itemsMap)c[b+d]=!0};for(var d in a){var e=a[d];e&&(j(d)?(collectSubPaths(e.common,d),collectSubPaths(e.local,d)):e.common&&void 0!==typeof e.common.body&&(b[d]=m(e),b[d].remote={body:!1,timestamp:this.now()},b[d]=this.autoMerge(b[d])))}return this.deleteRemoteTrees(Object.keys(c),b).then(function(a){return this.local.setNodes(this.flush(a))}.bind(this))}.bind(this))},completeFetch:function(a,b,c,d){var e,f,g=n(a);return j(a)?e=[a]:(f=g[1],e=[a,f]),this.local.getNodes(e).then(function(e){var g,h,i={},k=e[a],m=function(a){if(a&&a.itemsMap)for(var c in a.itemsMap)b[c]||(i[c]=!0)};if(("object"!=typeof k||k.path!==a||"object"!=typeof k.common)&&(k={path:a,common:{}},e[a]=k),k.remote={revision:d,timestamp:this.now()},j(a)){m(k.common),m(k.remote),k.remote.itemsMap={};for(g in b)k.remote.itemsMap[g]=!0}else k.remote.body=b,k.remote.contentType=c,h=e[f],h&&h.local&&h.local.itemsMap&&(g=a.substring(f.length),h.local.itemsMap[g]=!0,l(h.local.itemsMap,h.common.itemsMap)&&delete h.local);return e[a]=this.autoMerge(k),{toBeSaved:e,missingChildren:i}}.bind(this))},completePush:function(a,b,c,d){return this.local.getNodes([a]).then(function(e){var f=e[a];if(!f.push)throw this.stopped=!0,new Error("completePush called but no push version!");return c?(RemoteStorage.log("[Sync] We have a conflict"),f.remote&&f.remote.revision===d||(f.remote={revision:d||"conflict",timestamp:this.now()},delete f.push),e[a]=this.autoMerge(f)):(f.common={revision:d,timestamp:this.now()},"put"===b?(f.common.body=f.push.body,f.common.contentType=f.push.contentType,l(f.local.body,f.push.body)&&f.local.contentType===f.push.contentType&&delete f.local,delete f.push):"delete"===b&&(f.local.body===!1?e[a]=void 0:delete f.push)),this.local.setNodes(this.flush(e))}.bind(this))},dealWithFailure:function(a,b,c){return this.local.getNodes([a]).then(function(b){return b[a]?(delete b[a].push,this.local.setNodes(this.flush(b))):void 0}.bind(this))},interpretStatus:function(a){if("offline"===a||"timeout"===a)return{successful:!1,networkProblems:!0,statusCode:a};var b=Math.floor(a/100);return{successful:2===b||304===a||412===a||404===a,conflict:412===a,unAuth:401===a&&this.remote.token!==RemoteStorage.Authorize.IMPLIED_FAKE_TOKEN||402===a||403===a,notFound:404===a,changed:304!==a,statusCode:a}},handleGetResponse:function(a,b,c,d,e){return b.notFound&&(c=!!j(a)&&{}),b.changed?this.completeFetch(a,c,d,e).then(function(b){return j(a)?this.corruptServerItemsMap(c)?(RemoteStorage.log("[Sync] WARNING: Discarding corrupt folder description from server for "+a),!1):this.markChildren(a,c,b.toBeSaved,b.missingChildren).then(function(){return!0}):this.local.setNodes(this.flush(b.toBeSaved)).then(function(){return!0})}.bind(this)):this.updateCommonTimestamp(a,e).then(function(){return!0})},handleResponse:function(a,b,c){var d=this.interpretStatus(c.statusCode);if(d.successful){if("get"===b)return this.handleGetResponse(a,d,c.body,c.contentType,c.revision);if("put"===b||"delete"===b)return this.completePush(a,b,d.conflict,c.revision).then(function(){return!0});throw new Error("cannot handle response for unknown action",b)}var e;return e=d.unAuth?new RemoteStorage.Unauthorized:d.networkProblems?new RemoteStorage.SyncError("Network request failed."):new Error("HTTP response code "+d.statusCode+" received."),this.dealWithFailure(a,b,d).then(function(){throw remoteStorage._emit("error",e),e})},numThreads:10,finishTask:function(a){if(void 0===a.action)return void delete this._running[a.path];var b=this;return a.promise.then(function(c){return b.handleResponse(a.path,a.action,c)},function(c){return RemoteStorage.log("[Sync] wireclient rejects its promise!",a.path,a.action,c),b.handleResponse(a.path,a.action,{statusCode:"offline"})}).then(function(c){if(delete b._timeStarted[a.path],delete b._running[a.path],c&&b._tasks[a.path]){for(var d=0;d<b._tasks[a.path].length;d++)b._tasks[a.path][d]();delete b._tasks[a.path]}b._emit("req-done"),b.collectTasks(!1).then(function(){!b.hasTasks()||b.stopped?(RemoteStorage.log("[Sync] Sync is done! Reschedule?",Object.getOwnPropertyNames(b._tasks).length,b.stopped),b.done||(b.done=!0,b._emit("done"))):setTimeout(function(){b.doTasks()},10)})},function(c){console.error("[Sync] Error",c),delete b._timeStarted[a.path],delete b._running[a.path],b._emit("req-done"),b.done||(b.done=!0,b._emit("done"))})},doTasks:function(){var a,b,c,d=0;if(a=this.remote.connected?this.remote.online?this.numThreads:1:0,b=a-Object.getOwnPropertyNames(this._running).length,0>=b)return!0;for(c in this._tasks)if(!this._running[c]&&(this._timeStarted[c]=this.now(),this._running[c]=this.doTask(c),this._running[c].then(this.finishTask.bind(this)),d++,d>=b))return!0;return d>=b},collectTasks:function(a){return this.hasTasks()||this.stopped?Promise.resolve():this.collectDiffTasks().then(function(b){return b||a===!1?Promise.resolve():this.collectRefreshTasks()}.bind(this),function(a){throw a})},addTask:function(a,b){this._tasks[a]||(this._tasks[a]=[]),"function"==typeof b&&this._tasks[a].push(b)},sync:function(){return this.done=!1,this.doTasks()?Promise.resolve():this.collectTasks().then(function(){try{this.doTasks()}catch(a){console.error("[Sync] doTasks error",a)}}.bind(this),function(a){throw console.error("[Sync] Sync error",a),new Error("Local cache unavailable")})}},RemoteStorage.prototype.getSyncInterval=function(){return g},RemoteStorage.prototype.setSyncInterval=function(a){if(!f(a))throw a+" is not a valid sync interval";var b=g;g=parseInt(a,10),this._emit("sync-interval-change",{oldValue:b,newValue:a})},RemoteStorage.prototype.getBackgroundSyncInterval=function(){return h},RemoteStorage.prototype.setBackgroundSyncInterval=function(a){if(!f(a))throw a+" is not a valid sync interval";var b=h;h=parseInt(a,10),this._emit("sync-interval-change",{oldValue:b,newValue:a})},RemoteStorage.prototype.getCurrentSyncInterval=function(){return i?h:g};var o=function(a){var b="Sync failed: ";b+="object"==typeof a&&"message"in a?a.message:a,this.originalError=a,this.message=b};o.prototype=new Error,o.prototype.constructor=o,RemoteStorage.SyncError=o,RemoteStorage.prototype.syncCycle=function(){this.sync.stopped||(this.sync.on("done",function(){RemoteStorage.log("[Sync] Sync done. Setting timer to",this.getCurrentSyncInterval()),this.sync.stopped||(this._syncTimer&&clearTimeout(this._syncTimer),this._syncTimer=setTimeout(this.sync.sync.bind(this.sync),this.getCurrentSyncInterval()))}.bind(this)),this.sync.sync())},RemoteStorage.prototype.stopSync=function(){this.sync?(RemoteStorage.log("[Sync] Stopping sync"),this.sync.stopped=!0):(RemoteStorage.log("[Sync] Will instantiate sync stopped"),this.syncStopped=!0)},RemoteStorage.prototype.startSync=function(){this.sync.stopped=!1,this.syncStopped=!1,this.sync.sync()};var p;RemoteStorage.Sync._rs_init=function(a){p=function(){RemoteStorage.log("[Sync] syncCycleCb calling syncCycle"),RemoteStorage.Env.isBrowser()&&e.bind(a)(),a.sync||(a.sync=new RemoteStorage.Sync(a.local,a.remote,a.access,a.caching),a.syncStopped&&(RemoteStorage.log("[Sync] Instantiating sync stopped"),a.sync.stopped=!0,delete a.syncStopped)),RemoteStorage.log("[Sync] syncCycleCb calling syncCycle"),a.syncCycle()},syncOnConnect=function(){a.removeEventListener("connected",syncOnConnect),a.startSync()},a.on("ready",p),a.on("connected",syncOnConnect)},RemoteStorage.Sync._rs_cleanup=function(a){a.stopSync(),a.removeEventListener("ready",p),a.removeEventListener("connected",syncOnConnect),delete a.sync}}("undefined"!=typeof window?window:global),function(){function a(a){if("object"==typeof a&&"string"==typeof a.path)if(e(a.path)){if(a.local&&a.local.itemsMap)return a.local;if(a.common&&a.common.itemsMap)return a.common}else{if(a.local&&a.local.body&&a.local.contentType)return a.local;if(a.common&&a.common.body&&a.common.contentType)return a.common;if(a.body&&a.contentType)return{body:a.body,contentType:a.contentType}}}function b(b,c){var d;for(d in b){if(b[d]&&b[d].remote)return!0;var e=a(b[d]);if(e&&e.timestamp&&(new Date).getTime()-e.timestamp<=c)return!1;if(!e)return!0}return!0}function c(a){var b={path:a,common:{}};return e(a)&&(b.common.itemsMap={}),b}function d(a,b){return a.common||(a.common={itemsMap:{}}),a.common.itemsMap||(a.common.itemsMap={}),a.local||(a.local=g(a.common)),a.local.itemsMap||(a.local.itemsMap=a.common.itemsMap),a.local.itemsMap[b]=!0,a}var e=RemoteStorage.util.isFolder,f=RemoteStorage.util.isDocument,g=RemoteStorage.util.deepClone,h=(RemoteStorage.util.equal,RemoteStorage.util.pathsFromRoot),i={get:function(c,d,f){var g=this;return"number"==typeof d?g.getNodes(h(c)).then(function(e){var g=a(e[c]);return b(e,d)?f(c):g?{statusCode:200,body:g.body||g.itemsMap,contentType:g.contentType}:{statusCode:404}}):g.getNodes([c]).then(function(b){var d=a(b[c]);if(d){if(e(c))for(var f in d.itemsMap)d.itemsMap.hasOwnProperty(f)&&d.itemsMap[f]===!1&&delete d.itemsMap[f];return{statusCode:200,body:d.body||d.itemsMap,contentType:d.contentType}}return{statusCode:404}})},put:function(b,e,f){function g(b,g){try{for(var h=0,i=b.length;i>h;h++){var j,k=b[h],l=g[k];if(l||(g[k]=l=c(k)),0===h)j=a(l),l.local={body:e,contentType:f,previousBody:j?j.body:void 0,previousContentType:j?j.contentType:void 0};else{var m=b[h-1].substring(k.length);l=d(l,m)}}return g}catch(a){throw RemoteStorage.log("[Cachinglayer] Error during PUT",g,h,a),a}}var i=h(b);return this._updateNodes(i,g)},delete:function(b){var c=h(b);return this._updateNodes(c,function(b,c){for(var d=0,e=b.length;e>d;d++){var f=b[d],h=c[f];if(!h)throw new Error("Cannot delete non-existing node "+f);if(0===d)previous=a(h),h.local={body:!1,previousBody:previous?previous.body:void 0,previousContentType:previous?previous.contentType:void 0};else{h.local||(h.local=g(h.common));var i=b[d-1].substring(f.length);if(delete h.local.itemsMap[i],Object.getOwnPropertyNames(h.local.itemsMap).length>0)break}}return c})},flush:function(a){var b=this;return b._getAllDescendentPaths(a).then(function(a){return b.getNodes(a)}).then(function(a){for(var c in a){var d=a[c];d&&d.common&&d.local&&b._emitChange({path:d.path,origin:"local",oldValue:d.local.body===!1?void 0:d.local.body,newValue:d.common.body===!1?void 0:d.common.body}),a[c]=void 0}return b.setNodes(a)})},_emitChange:function(a){RemoteStorage.config.changeEvents[a.origin]&&this._emit("change",a)},fireInitial:function(){if(RemoteStorage.config.changeEvents.local){var b=this;b.forAllNodes(function(c){var d;f(c.path)&&(d=a(c),d&&b._emitChange({path:c.path,origin:"local",oldValue:void 0,oldContentType:void 0,newValue:d.body,newContentType:d.contentType}))}).then(function(){b._emit("local-events-done")})}},onDiff:function(a){this.diffHandler=a},migrate:function(a){return"object"!=typeof a||a.common||(a.common={},"string"==typeof a.path?"/"===a.path.substr(-1)&&"object"==typeof a.body&&(a.common.itemsMap=a.body):(a.local||(a.local={}),a.local.body=a.body,a.local.contentType=a.contentType)),a},_updateNodesRunning:!1,_updateNodesQueued:[],_updateNodes:function(a,b){var c=Promise.defer();return this._doUpdateNodes(a,b,c),c.promise},_doUpdateNodes:function(a,b,c){var d=this;return d._updateNodesRunning?void d._updateNodesQueued.push({paths:a,cb:b,promise:c}):(d._updateNodesRunning=!0,void d.getNodes(a).then(function(e){var h,i=g(e),j=[],k=RemoteStorage.util.equal;e=b(a,e);for(var l in e)h=e[l],k(h,i[l])?delete e[l]:f(l)&&(k(h.local.body,h.local.previousBody)&&h.local.contentType===h.local.previousContentType||j.push({path:l,origin:"window",oldValue:h.local.previousBody,newValue:h.local.body===!1?void 0:h.local.body,oldContentType:h.local.previousContentType,newContentType:h.local.contentType}),delete h.local.previousBody,delete h.local.previousContentType);d.setNodes(e).then(function(){d._emitChangeEvents(j),c.resolve({statusCode:200})})}).then(function(){return Promise.resolve()},function(a){c.reject(a)}).then(function(){d._updateNodesRunning=!1;var a=d._updateNodesQueued.shift();a&&d._doUpdateNodes(a.paths,a.cb,a.promise)}))},_emitChangeEvents:function(a){for(var b=0,c=a.length;c>b;b++)this._emitChange(a[b]),this.diffHandler&&this.diffHandler(a[b].path)},_getAllDescendentPaths:function(b){var c=this;return e(b)?c.getNodes([b]).then(function(d){var e=[b],f=a(d[b]),g=Object.keys(f.itemsMap),h=g.map(function(a){return c._getAllDescendentPaths(b+a).then(function(a){for(var b=0,c=a.length;c>b;b++)e.push(a[b])})});return Promise.all(h).then(function(){return e})}):Promise.resolve([b])},_getInternals:function(){return{getLatest:a,makeNode:c,isOutdated:b}}};RemoteStorage.cachingLayer=function(a){for(var b in i)a[b]=i[b]}}(),function(a){var b,c=RemoteStorage,d=2,e="remotestorage";c.IndexedDB=function(a){return this.db=a||b,this.db?(c.cachingLayer(this),c.eventHandling(this,"change","local-events-done"),this.getsRunning=0,this.putsRunning=0,this.changesQueued={},void(this.changesRunning={})):void RemoteStorage.log("[IndexedDB] Failed to open DB")},c.IndexedDB.prototype={getNodes:function(a){for(var b=[],c={},d=0,e=a.length;e>d;d++)void 0!==this.changesQueued[a[d]]?c[a[d]]=RemoteStorage.util.deepClone(this.changesQueued[a[d]]||void 0):void 0!==this.changesRunning[a[d]]?c[a[d]]=RemoteStorage.util.deepClone(this.changesRunning[a[d]]||void 0):b.push(a[d]);return b.length>0?this.getNodesFromDb(b).then(function(a){for(var b in c)a[b]=c[b];return a}):Promise.resolve(c)},setNodes:function(a){for(var b in a)this.changesQueued[b]=a[b]||!1;return this.maybeFlush(),Promise.resolve()},maybeFlush:function(){0===this.putsRunning?this.flushChangesQueued():this.commitSlownessWarning||(this.commitSlownessWarning=setInterval(function(){console.log("WARNING: waited more than 10 seconds for previous commit to finish")},1e4))},flushChangesQueued:function(){this.commitSlownessWarning&&(clearInterval(this.commitSlownessWarning),this.commitSlownessWarning=null),Object.keys(this.changesQueued).length>0&&(this.changesRunning=this.changesQueued,this.changesQueued={},this.setNodesInDb(this.changesRunning).then(this.flushChangesQueued.bind(this)))},getNodesFromDb:function(a){var b=Promise.defer(),c=this.db.transaction(["nodes"],"readonly"),d=c.objectStore("nodes"),e={};return(new Date).getTime(),this.getsRunning++,a.map(function(a,b){d.get(a).onsuccess=function(b){e[a]=b.target.result}}),c.oncomplete=function(){b.resolve(e),this.getsRunning--}.bind(this),c.onerror=c.onabort=function(){b.reject("get transaction error/abort"),this.getsRunning--}.bind(this),b.promise},setNodesInDb:function(a){var b=Promise.defer(),c=this.db.transaction(["nodes"],"readwrite"),d=c.objectStore("nodes"),e=(new Date).getTime();this.putsRunning++,RemoteStorage.log("[IndexedDB] Starting put",a,this.putsRunning);for(var f in a){var g=a[f];if("object"==typeof g)try{d.put(g)}catch(a){throw RemoteStorage.log("[IndexedDB] Error while putting",g,a),a}else try{d.delete(f)}catch(a){throw RemoteStorage.log("[IndexedDB] Error while removing",d,g,a),a}}return c.oncomplete=function(){this.putsRunning--,RemoteStorage.log("[IndexedDB] Finished put",a,this.putsRunning,(new Date).getTime()-e+"ms"),b.resolve()}.bind(this),c.onerror=function(){this.putsRunning--,b.reject("transaction error")}.bind(this),c.onabort=function(){b.reject("transaction abort"),this.putsRunning--}.bind(this),b.promise},reset:function(a){var b=this.db.name,d=this;this.db.close(),c.IndexedDB.clean(this.db.name,function(){c.IndexedDB.open(b,function(b,c){b?RemoteStorage.log("[IndexedDB] Error while resetting local storage",b):d.db=c,"function"==typeof a&&a(d)})})},forAllNodes:function(a){var b=Promise.defer(),c=this.db.transaction(["nodes"],"readonly"),d=c.objectStore("nodes").openCursor();return d.onsuccess=function(c){var d=c.target.result;d?(a(this.migrate(d.value)),d.continue()):b.resolve()}.bind(this),b.promise},closeDB:function(){this.db.close()}},c.IndexedDB.open=function(a,b){var e=setTimeout(function(){b("timeout trying to open db")},1e4);try{var f=indexedDB.open(a,d);f.onerror=function(){RemoteStorage.log("[IndexedDB] Opening DB failed",f),clearTimeout(e),b(f.error)},f.onupgradeneeded=function(a){var b=f.result;RemoteStorage.log("[IndexedDB] Upgrade: from ",a.oldVersion," to ",a.newVersion),1!==a.oldVersion&&(RemoteStorage.log("[IndexedDB] Creating object store: nodes"),b.createObjectStore("nodes",{keyPath:"path"})),RemoteStorage.log("[IndexedDB] Creating object store: changes"),b.createObjectStore("changes",{keyPath:"path"})},f.onsuccess=function(){clearTimeout(e);var d=f.result;return d.objectStoreNames.contains("nodes")&&d.objectStoreNames.contains("changes")?void b(null,f.result):(RemoteStorage.log("[IndexedDB] Missing object store. Resetting the database."),void c.IndexedDB.clean(a,function(){c.IndexedDB.open(a,b)}))}}catch(d){RemoteStorage.log("[IndexedDB] Failed to open database: "+d),RemoteStorage.log("[IndexedDB] Resetting database and trying again."),clearTimeout(e),c.IndexedDB.clean(a,function(){c.IndexedDB.open(a,b)})}},c.IndexedDB.clean=function(a,b){var c=indexedDB.deleteDatabase(a);c.onsuccess=function(){RemoteStorage.log("[IndexedDB] Done removing DB"),b()},c.onerror=c.onabort=function(b){console.error('Failed to remove database "'+a+'"',b)}},c.IndexedDB._rs_init=function(a){var d=Promise.defer();return c.IndexedDB.open(e,function(c,e){c?d.reject(c):(b=e,e.onerror=function(){a._emit("error",c)},d.resolve())}),d.promise},c.IndexedDB._rs_supported=function(){var b=Promise.defer();a.indexedDB=a.indexedDB||a.webkitIndexedDB||a.mozIndexedDB||a.oIndexedDB||a.msIndexedDB;var c=!1;if("undefined"!=typeof a.navigator&&a.navigator.userAgent.match(/Android (2|3|4\.[0-3])/)&&(navigator.userAgent.match(/Chrome|Firefox/)||(c=!0)),"indexedDB"in a&&!c)try{var d=indexedDB.open("rs-check");d.onerror=function(a){b.reject()},d.onsuccess=function(a){d.result.close(),indexedDB.deleteDatabase("rs-check"),b.resolve()}}catch(a){b.reject()}else b.reject();return b.promise},c.IndexedDB._rs_cleanup=function(a){var b=Promise.defer();return a.local&&a.local.closeDB(),c.IndexedDB.clean(e,function(){b.resolve()}),b.promise}}("undefined"!=typeof window?window:global),function(a){function b(a){return a.substr(0,d.length)===d||a.substr(0,e.length)===e}function c(a){return a.substr(0,d.length)===d}var d="remotestorage:cache:nodes:",e="remotestorage:cache:changes:";RemoteStorage.LocalStorage=function(){RemoteStorage.cachingLayer(this),RemoteStorage.log("[LocalStorage] Registering events"),RemoteStorage.eventHandling(this,"change","local-events-done")},RemoteStorage.LocalStorage.prototype={getNodes:function(a){for(var b={},c=0,e=a.length;e>c;c++)try{b[a[c]]=JSON.parse(localStorage[d+a[c]])}catch(d){b[a[c]]=void 0}return Promise.resolve(b)},setNodes:function(a){for(var b in a)localStorage[d+b]=JSON.stringify(a[b]);return Promise.resolve()},forAllNodes:function(a){for(var b,d=0,e=localStorage.length;e>d;d++)if(c(localStorage.key(d))){try{b=this.migrate(JSON.parse(localStorage[localStorage.key(d)]))}catch(a){b=void 0}b&&a(b)}return Promise.resolve()}},RemoteStorage.LocalStorage._rs_init=function(){},RemoteStorage.LocalStorage._rs_supported=function(){return RemoteStorage.util.localStorageAvailable()},RemoteStorage.LocalStorage._rs_cleanup=function(){for(var a=[],c=0,d=localStorage.length;d>c;c++){var e=localStorage.key(c);b(e)&&a.push(e)}a.forEach(function(a){RemoteStorage.log("[LocalStorage] Removing",a),delete localStorage[a]})}}("undefined"!=typeof window?window:global),function(a){RemoteStorage.InMemoryStorage=function(){RemoteStorage.cachingLayer(this),RemoteStorage.log("[InMemoryStorage] Registering events"),RemoteStorage.eventHandling(this,"change","local-events-done"),this._storage={}},RemoteStorage.InMemoryStorage.prototype={getNodes:function(a){for(var b={},c=0,d=a.length;d>c;c++)b[a[c]]=this._storage[a[c]];return Promise.resolve(b)},setNodes:function(a){for(var b in a)void 0===a[b]?delete this._storage[b]:this._storage[b]=a[b];return Promise.resolve()},forAllNodes:function(a){for(var b in this._storage)a(this.migrate(this._storage[b]));return Promise.resolve()}},RemoteStorage.InMemoryStorage._rs_init=function(){},RemoteStorage.InMemoryStorage._rs_supported=function(){return!0},RemoteStorage.InMemoryStorage._rs_cleanup=function(){}}("undefined"!=typeof window?window:global),function(){RemoteStorage.MODULES={},RemoteStorage.defineModule=function(a,b){if(RemoteStorage.MODULES[a]=b,Object.defineProperty(RemoteStorage.prototype,a,{configurable:!0,get:function(){var b=this._loadModule(a);return Object.defineProperty(this,a,{value:b}),b}}),-1!==a.indexOf("-")){var c=a.replace(/\-[a-z]/g,function(a){return a[1].toUpperCase()});Object.defineProperty(RemoteStorage.prototype,c,{get:function(){return this[a]}})}},RemoteStorage.prototype._loadModule=function(a){var b=RemoteStorage.MODULES[a];if(b){var c=b(new RemoteStorage.BaseClient(this,"/"+a+"/"),new RemoteStorage.BaseClient(this,"/public/"+a+"/"));return c.exports}throw"Unknown module: "+a},RemoteStorage.prototype.defineModule=function(a){console.log("remoteStorage.defineModule is deprecated, use RemoteStorage.defineModule instead!"),RemoteStorage.defineModule.apply(RemoteStorage,arguments)}}(),function(){function a(a,b,c){function d(a,b,c,d){[b,c,d].forEach(function(b){var c=document.createElement("td");c.textContent=b||"",a.appendChild(c)})}function e(a){function c(b,c,f,g){if(200===b){var i=document.createElement("tr");if(h.appendChild(i),d(i,a,f,g),"/"===a[a.length-1])for(var j in c)e(a+j)}}b.connected!==!1&&b.get(a).then(c)}a.setAttribute("border","1"),a.style.margin="8px",a.style.color="white",a.innerHTML="";var f=document.createElement("thead");a.appendChild(f);var g=document.createElement("tr");f.appendChild(g),["Path","Content-Type","Revision"].forEach(function(a){var b=document.createElement("th");b.textContent=a,f.appendChild(b)});var h=document.createElement("tbody");a.appendChild(h),c.forEach(e)}function b(b,c,d,e){var f=document.createElement("div"),g=document.createElement("h2");g.textContent=b,f.appendChild(g);var h=document.createElement("button");if(h.textContent="Refresh",h.onclick=function(){a(c,d,e)},f.appendChild(h),d.reset){var i=document.createElement("button");i.textContent="Reset",i.onclick=function(){d.reset(function(b){d=b,a(c,d,e)})},f.appendChild(i)}return f.appendChild(c),a(c,d,e),f}function c(a){function b(){f.innerHTML="",a.forAllNodes(function(a){if(a.local&&a.local.body){var b=document.createElement("li");b.textContent=JSON.stringify(a.local),f.appendChild(b)}})}var c=document.createElement("div"),d=document.createElement("h2");d.textContent="Outgoing changes",c.appendChild(d);var e=document.createElement("button");e.textContent="Refresh",c.appendChild(e);var f=document.createElement("ul");return f.style.fontFamily="courier",c.appendChild(f),e.onclick=b,b(),c}RemoteStorage.prototype.inspect=function(){var d=document.createElement("div");d.id="remotestorage-inspect",d.style.position="absolute",d.style.top=0,d.style.left=0,d.style.background="black",d.style.color="white",d.style.border="groove 5px #ccc";var e=document.createElement("div");e.style.position="absolute",e.style.top=0,e.style.left=0;var f=document.createElement("strong");f.textContent=" remotestorage.js inspector ",e.appendChild(f);var g;this.local&&(g=document.createElement("button"),g.textContent="Synchronize",e.appendChild(g));var h=document.createElement("button");h.textContent="Close",h.onclick=function(){document.body.removeChild(d)},e.appendChild(h),d.appendChild(e);var i=[];for(var j in this.caching._rootPaths)this.caching._rootPaths.hasOwnProperty(j)&&i.push(j);var k=document.createElement("table"),l=document.createElement("table");d.appendChild(b("Remote",k,this.remote,i)),this.local&&(d.appendChild(b("Local",l,this.local,["/"])),d.appendChild(c(this.local)),g.onclick=function(){this.log("sync clicked"),this.sync.sync().then(function(){this.log("SYNC FINISHED"),a(l,this.local,["/"])}.bind(this),function(a){console.error("SYNC FAILED",a,a.stack)})}.bind(this)),document.body.appendChild(d)}}(),function(a){function b(a){return"/"===a.substr(-1)&&(a=a.substr(0,a.length-1)),decodeURIComponent(a)}function c(a){return a.replace(/[^\/]+\/?$/,"")}function d(a){var b=a.split("/");return"/"===a.substr(-1)?b[b.length-2]+"/":b[b.length-1]}var e=RemoteStorage,f="https://www.googleapis.com",g="https://accounts.google.com/o/oauth2/auth",h="https://www.googleapis.com/auth/drive",i="application/vnd.google-apps.folder",j="application/json; charset=UTF-8",k=RemoteStorage.util.isFolder,l=function(a){this.maxAge=a,this._items={}};l.prototype={get:function(a){var b=this._items[a],c=(new Date).getTime();return b&&b.t>=c-this.maxAge?b.v:void 0},set:function(a,b){this._items[a]={v:b,t:(new Date).getTime()}}},e.GoogleDrive=function(a,b){e.eventHandling(this,"change","connected","wire-busy","wire-done","not-connected"),this.rs=a,this.clientId=b,this._fileIdCache=new l(300)},e.GoogleDrive.prototype={connected:!1,online:!0,configure:function(a){a.token?(localStorage["remotestorage:googledrive:token"]=a.token,this.token=a.token,this.connected=!0,this._emit("connected")):(this.connected=!1,delete this.token,delete localStorage["remotestorage:googledrive:token"])},connect:function(){this.rs.setBackend("googledrive"),e.Authorize(this.rs,g,h,String(e.Authorize.getLocation()),this.clientId)},stopWaitingForToken:function(){this.connected||this._emit("not-connected")},get:function(a,b){return"/"===a.substr(-1)?this._getFolder(a,b):this._getFile(a,b)},put:function(a,b,c,d){function e(a){if(a.status>=200&&a.status<300){var b=JSON.parse(a.responseText),c=b.etag.substring(1,b.etag.length-1);return Promise.resolve({statusCode:200,contentType:b.mimeType,revision:c})}return 412===a.status?Promise.resolve({statusCode:412,revision:"conflict"}):Promise.reject("PUT failed with status "+a.status+" ("+a.responseText+")")}var f=this;return f._getFileId(a).then(function(g){return g?d&&"*"===d.ifNoneMatch?e({status:412}):f._updateFile(g,a,b,c,d).then(e):f._createFile(a,b,c,d).then(e)})},delete:function(a,b){var c=this;return c._getFileId(a).then(function(a){return a?c._getMeta(a).then(function(d){var e;return"object"==typeof d&&"string"==typeof d.etag&&(e=d.etag.substring(1,d.etag.length-1)),b&&b.ifMatch&&b.ifMatch!==e?{statusCode:412,revision:e}:c._request("DELETE",f+"/drive/v2/files/"+a,{}).then(function(a){return 200===a.status||204===a.status?{statusCode:200}:Promise.reject("Delete failed: "+a.status+" ("+a.responseText+")")})}):Promise.resolve({statusCode:200})})},_updateFile:function(a,b,c,d,e){var g=this,h={mimeType:d},i={"Content-Type":"application/json; charset=UTF-8"};return e&&e.ifMatch&&(i["If-Match"]='"'+e.ifMatch+'"'),g._request("PUT",f+"/upload/drive/v2/files/"+a+"?uploadType=resumable",{body:JSON.stringify(h),headers:i}).then(function(a){return 412===a.status?a:g._request("PUT",a.getResponseHeader("Location"),{body:d.match(/^application\/json/)?JSON.stringify(c):c})})},_createFile:function(a,c,e,g){var h=this;return h._getParentId(a).then(function(g){var i=d(a),j={title:b(i),mimeType:e,parents:[{kind:"drive#fileLink",id:g}]};return h._request("POST",f+"/upload/drive/v2/files?uploadType=resumable",{body:JSON.stringify(j),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(a){return h._request("POST",a.getResponseHeader("Location"),{body:e.match(/^application\/json/)?JSON.stringify(c):c})})})},_getFile:function(a,b){var c=this;return c._getFileId(a).then(function(a){return c._getMeta(a).then(function(a){var d;if("object"==typeof a&&"string"==typeof a.etag&&(d=a.etag.substring(1,a.etag.length-1)),b&&b.ifNoneMatch&&d===b.ifNoneMatch)return Promise.resolve({statusCode:304
});var e={};if(!a.downloadUrl){if(!a.exportLinks||!a.exportLinks["text/html"])return Promise.resolve({statusCode:200,body:"",contentType:a.mimeType,revision:d});a.mimeType+=";export=text/html",a.downloadUrl=a.exportLinks["text/html"]}return a.mimeType.match(/charset=binary/)&&(e.responseType="blob"),c._request("GET",a.downloadUrl,e).then(function(b){var c=b.response;if(a.mimeType.match(/^application\/json/))try{c=JSON.parse(c)}catch(a){}return Promise.resolve({statusCode:200,body:c,contentType:a.mimeType,revision:d})})})})},_getFolder:function(a,b){var c=this;return c._getFileId(a).then(function(b){var d,e,g,h,k;return b?(d="'"+b+"' in parents",e="items(downloadUrl,etag,fileSize,id,mimeType,title)",c._request("GET",f+"/drive/v2/files?q="+encodeURIComponent(d)+"&fields="+encodeURIComponent(e)+"&maxResults=1000",{}).then(function(b){if(200!==b.status)return Promise.reject("request failed or something: "+b.status);try{g=JSON.parse(b.responseText)}catch(a){return Promise.reject("non-JSON response from GoogleDrive")}k={};for(var d=0,e=g.items.length;e>d;d++)h=g.items[d].etag.substring(1,g.items[d].etag.length-1),g.items[d].mimeType===i?(c._fileIdCache.set(a+g.items[d].title+"/",g.items[d].id),k[g.items[d].title+"/"]={ETag:h}):(c._fileIdCache.set(a+g.items[d].title,g.items[d].id),k[g.items[d].title]={ETag:h,"Content-Type":g.items[d].mimeType,"Content-Length":g.items[d].fileSize});return Promise.resolve({statusCode:200,body:k,contentType:j,revision:void 0})})):Promise.resolve({statusCode:404})})},_getParentId:function(a){var b=c(a),d=this;return d._getFileId(b).then(function(a){return a?Promise.resolve(a):d._createFolder(b)})},_createFolder:function(a){var c=this;return c._getParentId(a).then(function(e){return c._request("POST",f+"/drive/v2/files",{body:JSON.stringify({title:b(d(a)),mimeType:i,parents:[{id:e}]}),headers:{"Content-Type":"application/json; charset=UTF-8"}}).then(function(a){var b=JSON.parse(a.responseText);return Promise.resolve(b.id)})})},_getFileId:function(a){var b,d=this;return"/"===a?Promise.resolve("root"):(b=this._fileIdCache.get(a))?Promise.resolve(b):d._getFolder(c(a)).then(function(){return b=d._fileIdCache.get(a),b?Promise.resolve(b):"/"===a.substr(-1)?d._createFolder(a).then(function(){return d._getFileId(a)}):Promise.resolve()})},_getMeta:function(a){return this._request("GET",f+"/drive/v2/files/"+a,{}).then(function(b){return 200===b.status?Promise.resolve(JSON.parse(b.responseText)):Promise.reject("request (getting metadata for "+a+") failed with status: "+b.status)})},_request:function(a,b,c){var d=this;return c.headers||(c.headers={}),c.headers.Authorization="Bearer "+d.token,this._emit("wire-busy",{method:a,isFolder:k(b)}),e.WireClient.request.call(this,a,b,c).then(function(c){return c&&401===c.status?void d.connect():(d.online||(d.online=!0,d.rs._emit("network-online")),d._emit("wire-done",{method:a,isFolder:k(b),success:!0}),Promise.resolve(c))},function(c){return d.online&&(d.online=!1,d.rs._emit("network-offline")),d._emit("wire-done",{method:a,isFolder:k(b),success:!1}),Promise.reject(c)})}},e.GoogleDrive._rs_init=function(a){var b=a.apiKeys.googledrive;b&&(a.googledrive=new e.GoogleDrive(a,b.clientId),"googledrive"===a.backend&&(a._origRemote=a.remote,a.remote=a.googledrive))},e.GoogleDrive._rs_supported=function(a){return!0},e.GoogleDrive._rs_cleanup=function(a){a.setBackend(void 0),a._origRemote&&(a.remote=a._origRemote,delete a._origRemote)}}(this),function(a){function b(a){this.defaultValue=a,this._storage={},this.set=this.justSet,this.delete=this.justDelete}function c(a){a._dropboxOrigSync||(a._dropboxOrigSync=a.sync.sync.bind(a.sync),a.sync.sync=function(){return this.dropbox.fetchDelta.apply(this.dropbox,arguments).then(a._dropboxOrigSync,function(b){return a._emit("error",new RemoteStorage.SyncError(b)),Promise.reject(b)})}.bind(a))}function d(a){a._dropboxOrigSync&&(a.sync.sync=a._dropboxOrigSync,delete a._dropboxOrigSync)}function e(a){a._origBaseClientGetItemURL||(a._origBaseClientGetItemURL=l.BaseClient.prototype.getItemURL,l.BaseClient.prototype.getItemURL=function(b){var c=a.dropbox._itemRefs[b];return c?c:""})}function f(a){a._origBaseClientGetItemURL&&(l.BaseClient.prototype.getItemURL=a._origBaseClientGetItemURL,delete a._origBaseClientGetItemURL)}function g(a){a._origRemote||(a._origRemote=a.remote,a.remote=a.dropbox)}function h(a){a._origRemote&&(a.remote=a._origRemote,delete a._origRemote)}function i(a){g(a),a.sync?c(a):a.on("connected",function(){a.sync&&c(a)}),e(a)}function j(a){h(a),d(a),f(a)}var k,l=RemoteStorage,m="https://www.dropbox.com/1/oauth2/authorize",n="remotestorage:dropbox",o="/remotestorage",p=RemoteStorage.util.isFolder,q=function(a){return l.WireClient.cleanPath(o+"/"+a)},r=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};b.prototype={get:function(a){a=a.toLowerCase();var b=this._storage[a];return"undefined"==typeof b&&(b=this.defaultValue,this._storage[a]=b),b},propagateSet:function(a,b){return a=a.toLowerCase(),this._storage[a]===b?b:(this._propagate(a,b),this._storage[a]=b,b)},propagateDelete:function(a){return a=a.toLowerCase(),this._propagate(a,this._storage[a]),delete this._storage[a]},_activatePropagation:function(){return this.set=this.propagateSet,this.delete=this.propagateDelete,!0},justSet:function(a,b){return a=a.toLowerCase(),this._storage[a]=b,b},justDelete:function(a,b){return a=a.toLowerCase(),delete this._storage[a]},_propagate:function(a,b){for(var c=a.split("/").slice(0,-1),d="",e=0,f=c.length;f>e;e++)d+=c[e]+"/",b||(b=this._storage[d]+1),this._storage[d]=b}};var s;l.Dropbox=function(a){this.rs=a,this.connected=!1,this.rs=a;var c=this;if(s=function(a){a instanceof RemoteStorage.Unauthorized&&c.configure({userAddress:null,href:null,storageApi:null,token:null,options:null})},l.eventHandling(this,"change","connected","wire-busy","wire-done","not-connected"),a.on("error",s),this.clientId=a.apiKeys.dropbox.appKey,this._revCache=new b("rev"),this._itemRefs={},this._metadataCache={},k){var d;try{d=JSON.parse(localStorage[n])}catch(a){}d&&this.configure(d);try{this._itemRefs=JSON.parse(localStorage[n+":shares"])}catch(a){}}this.connected&&setTimeout(this._emit.bind(this),0,"connected")},l.Dropbox.prototype={online:!0,connect:function(){this.rs.setBackend("dropbox"),this.token?i(this.rs):l.Authorize(this.rs,m,"",String(l.Authorize.getLocation()),this.clientId)},configure:function(a){"undefined"!=typeof a.userAddress&&(this.userAddress=a.userAddress),"undefined"!=typeof a.token&&(this.token=a.token),this.token?(this.connected=!0,this.userAddress||this.info().then(function(a){this.userAddress=a.display_name,this.rs.widget.view.setUserAddress(this.userAddress),this._emit("connected")}.bind(this))):this.connected=!1,k&&(localStorage[n]=JSON.stringify({userAddress:this.userAddress,token:this.token}))},stopWaitingForToken:function(){this.connected||this._emit("not-connected")},_getFolder:function(a,b){var c="https://api.dropbox.com/1/metadata/auto"+q(a),d=this._revCache,e=this;return this._request("GET",c,{}).then(function(b){var c=b.status;if(304===c)return Promise.resolve({statusCode:c});var f,g,h,i;try{g=JSON.parse(b.responseText)}catch(a){return Promise.reject(a)}return i=e._revCache.get(a),h="application/json; charset=UTF-8",g.contents&&(f=g.contents.reduce(function(b,c){var e=c.path.split("/").slice(-1)[0]+(c.is_dir?"/":"");return c.is_dir?b[e]={ETag:d.get(a+e)}:b[e]={ETag:c.rev},b},{})),Promise.resolve({statusCode:c,body:f,contentType:h,revision:i})})},get:function(a,b){if(!this.connected)return Promise.reject("not connected (path: "+a+")");var c="https://api-content.dropbox.com/1/files/auto"+q(a),d=this,e=this._revCache.get(a);return null===e?Promise.resolve({statusCode:404}):b&&b.ifNoneMatch&&e&&e===b.ifNoneMatch?Promise.resolve({statusCode:304}):"/"===a.substr(-1)?this._getFolder(a,b):this._request("GET",c,{}).then(function(b){var c,e,f,g,h=b.status;if(200!==h)return Promise.resolve({statusCode:h});e=b.responseText;try{c=JSON.parse(b.getResponseHeader("x-dropbox-metadata"))}catch(a){return Promise.reject(a)}if(f=c.mime_type,g=c.rev,d._revCache.set(a,g),d._shareIfNeeded(a),!b.getResponseHeader("Content-Type")||b.getResponseHeader("Content-Type").match(/charset=binary/)){var i=Promise.defer();return l.WireClient.readBinaryData(b.response,f,function(a){i.resolve({statusCode:h,body:a,contentType:f,revision:g})}),i.promise}if(f&&f.search("application/json")>=0,!0)try{e=JSON.parse(e),f="application/json; charset=UTF-8"}catch(a){}return Promise.resolve({statusCode:h,body:e,contentType:f,revision:g})})},put:function(a,b,c,d){var e=this;if(!this.connected)throw new Error("not connected (path: "+a+")");var f=this._revCache.get(a);if(d&&d.ifMatch&&f&&f!==d.ifMatch)return Promise.resolve({statusCode:412,revision:f});if(d&&"*"===d.ifNoneMatch&&f&&"rev"!==f)return Promise.resolve({statusCode:412,revision:f});if(!c.match(/charset=/)&&(b instanceof ArrayBuffer||l.WireClient.isArrayBufferView(b))&&(c+="; charset=binary"),b.length>157286400)return Promise.reject(new Error("Cannot upload file larger than 150MB"));var g,h=d&&(d.ifMatch||"*"===d.ifNoneMatch),i={body:b,contentType:c,path:a};return g=h?this._getMetadata(a).then(function(a){return d&&"*"===d.ifNoneMatch&&a?Promise.resolve({statusCode:412,revision:a.rev}):d&&d.ifMatch&&a&&a.rev!==d.ifMatch?Promise.resolve({statusCode:412,revision:a.rev}):e._uploadSimple(i)}):e._uploadSimple(i),g.then(function(b){return e._shareIfNeeded(a),b})},delete:function(a,b){var c=this;if(!this.connected)throw new Error("not connected (path: "+a+")");var d=this._revCache.get(a);return b&&b.ifMatch&&d&&b.ifMatch!==d?Promise.resolve({statusCode:412,revision:d}):b&&b.ifMatch?this._getMetadata(a).then(function(d){return b&&b.ifMatch&&d&&d.rev!==b.ifMatch?Promise.resolve({statusCode:412,revision:d.rev}):c._deleteSimple(a)}):c._deleteSimple(a)},_shareIfNeeded:function(a){a.match(/^\/public\/.*[^\/]$/)&&void 0===this._itemRefs[a]&&this.share(a)},share:function(a){var b=this,c="https://api.dropbox.com/1/media/auto"+q(a);return this._request("POST",c,{}).then(function(d){if(200!==d.status)return Promise.reject(new Error('Invalid Dropbox API response status when sharing "'+a+'":'+d.status));try{d=JSON.parse(d.responseText)}catch(b){return Promise.reject(new Error('Invalid Dropbox API response when sharing "'+a+'": '+d.responseText))}return b._itemRefs[a]=d.url,k&&(localStorage[n+":shares"]=JSON.stringify(b._itemRefs)),Promise.resolve(c)},function(b){return err.message='Sharing dropbox file or folder ("'+a+'") failed.'+err.message,Promise.reject(b)})},info:function(){var a="https://api.dropbox.com/1/account/info";return this._request("GET",a,{}).then(function(a){try{var b=JSON.parse(a.responseText);return Promise.resolve(b)}catch(a){return Promise.reject(a)}})},_request:function(b,c,d){var e=this;return d.headers||(d.headers={}),d.headers.Authorization="Bearer "+this.token,this._emit("wire-busy",{method:b,isFolder:p(c)}),l.WireClient.request.call(this,b,c,d).then(function(f){return f&&503===f.status?(e.online&&(e.online=!1,e.rs._emit("network-offline")),a.setTimeout(e._request(b,c,d),3210)):(e.online||(e.online=!0,e.rs._emit("network-online")),e._emit("wire-done",{method:b,isFolder:p(c),success:!0}),Promise.resolve(f))},function(a){return e.online&&(e.online=!1,e.rs._emit("network-offline")),e._emit("wire-done",{method:b,isFolder:p(c),success:!1}),Promise.reject(a)})},fetchDelta:function(){var a=Array.prototype.slice.call(arguments),c=this,d={path_prefix:o};return c._deltaCursor&&(d.cursor=c._deltaCursor),c._request("POST","https://api.dropbox.com/1/delta",{body:r(d),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(d){if(200!==d.status)return 400===d.status?(c.rs._emit("error",new RemoteStorage.Unauthorized),Promise.resolve(a)):Promise.reject("dropbox.fetchDelta returned "+d.status+d.responseText);var e;try{e=JSON.parse(d.responseText)}catch(a){return l.log("fetchDeltas can not parse response",a),Promise.reject("can not parse response of fetchDelta : "+a.message)}return e.entries?(e.reset&&(c._revCache=new b("rev")),e.cursor&&(c._deltaCursor=e.cursor),e.entries.forEach(function(a){var b,d=a[0].substr(o.length);if(a[1]){if(a[1].is_dir)return;b=a[1].rev}else b=null;c._revCache.set(d,b)}),Promise.resolve(a)):Promise.reject("dropbox.fetchDeltas failed, no entries found")},function(b){return this.rs.log("fetchDeltas",b),this.rs._emit("error",new RemoteStorage.SyncError("fetchDeltas failed."+b)),Promise.resolve(a)}.bind(this)).then(function(){if(c._revCache){var a=Array.prototype.slice.call(arguments);return c._revCache._activatePropagation(),Promise.resolve(a)}})},_getMetadata:function(a,b){var c=this,d=this._metadataCache[a],e="https://api.dropbox.com/1/metadata/auto"+q(a);return e+="?list="+(b&&b.list?"true":"false"),d&&d.hash&&(e+="&hash="+encodeURIComponent(d.hash)),this._request("GET",e,{}).then(function(b){if(304===b.status)return Promise.resolve(d);if(200===b.status){var e=JSON.parse(b.responseText);return c._metadataCache[a]=e,Promise.resolve(e)}return Promise.resolve()})},_uploadSimple:function(a){var b=this,c="https://api-content.dropbox.com/1/files_put/auto"+q(a.path)+"?";return a&&a.ifMatch&&(c+="parent_rev="+encodeURIComponent(a.ifMatch)),b._request("PUT",c,{body:a.body,headers:{"Content-Type":a.contentType}}).then(function(c){if(200!==c.status)return Promise.resolve({statusCode:c.status});var d;try{d=JSON.parse(c.responseText)}catch(a){return Promise.reject(a)}if(d.path!==q(a.path)){var e="https://api.dropbox.com/1/fileops/delete?root=auto&path="+encodeURIComponent(d.path);return b._request("POST",e,{}),b._getMetadata(a.path).then(function(a){return Promise.resolve({statusCode:412,revision:a.rev})})}return b._revCache.propagateSet(a.path,d.rev),Promise.resolve({statusCode:c.status})})},_deleteSimple:function(a){var b=this,c="https://api.dropbox.com/1/fileops/delete?root=auto&path="+encodeURIComponent(q(a));return b._request("POST",c,{}).then(function(c){return 406===c.status?Promise.reject(new Error("Cannot delete '"+a+"': too many files involved")):((200===c.status||404===c.status)&&(b._revCache.delete(a),delete b._itemRefs[a]),Promise.resolve({statusCode:c.status}))})}},l.Dropbox._rs_init=function(a){k=RemoteStorage.util.localStorageAvailable(),a.apiKeys.dropbox&&(a.dropbox=new l.Dropbox(a)),"dropbox"===a.backend&&i(a)},l.Dropbox._rs_supported=function(){return!0},l.Dropbox._rs_cleanup=function(a){j(a),k&&delete localStorage[n],a.removeEventListener("error",s),a.setBackend(void 0)}}(this),remoteStorage=new RemoteStorage,!function(){"use strict";function a(b,c,d){return("string"==typeof c?c:c.toString()).replace(b.define||f,function(a,c,e,f){return 0===c.indexOf("def.")&&(c=c.substring(4)),c in d||(":"===e?(b.defineParams&&f.replace(b.defineParams,function(a,b,e){d[c]={arg:b,text:e}}),c in d||(d[c]=f)):new Function("def","def['"+c+"']="+f)(d)),""}).replace(b.use||f,function(c,e){b.useParams&&(e=e.replace(b.useParams,function(a,b,c,e){if(d[c]&&d[c].arg&&e){var f=(c+":"+e).replace(/'|\\/g,"_");return d.__exp=d.__exp||{},d.__exp[f]=d[c].text.replace(new RegExp("(^|[^\\w$])"+d[c].arg+"([^\\w$])","g"),"$1"+e+"$2"),b+"def.__exp['"+f+"']"}}));var f=new Function("def","return "+e)(d);return f?a(b,f,d):f})}function b(a){return a.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var c,d={version:"1.1.1",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0,log:!0};d.encodeHTMLSource=function(a){var b={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},c=a?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(a){return a?a.toString().replace(c,function(a){return b[a]||a}):""}},c=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=d:"function"==typeof define&&define.amd?define(function(){return d}):c.doT=d;var e={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},f=/$^/;d.template=function(g,h,i){h=h||d.templateSettings;var j,k,l=h.append?e.append:e.split,m=0,n=h.use||h.define?a(h,g,i||{}):g;n=("var out='"+(h.strip?n.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):n).replace(/'|\\/g,"\\$&").replace(h.interpolate||f,function(a,c){return l.start+b(c)+l.end}).replace(h.encode||f,function(a,c){return j=!0,l.startencode+b(c)+l.end}).replace(h.conditional||f,function(a,c,d){return c?d?"';}else if("+b(d)+"){out+='":"';}else{out+='":d?"';if("+b(d)+"){out+='":"';}out+='"}).replace(h.iterate||f,function(a,c,d,e){return c?(m+=1,k=e||"i"+m,c=b(c),"';var arr"+m+"="+c+";if(arr"+m+"){var "+d+","+k+"=-1,l"+m+"=arr"+m+".length-1;while("+k+"<l"+m+"){"+d+"=arr"+m+"["+k+"+=1];out+='"):"';} } out+='"}).replace(h.evaluate||f,function(a,c){return"';"+b(c)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),j&&(h.selfcontained||!c||c._encodeHTML||(c._encodeHTML=d.encodeHTMLSource(h.doNotSkipEncoded)),n="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+d.encodeHTMLSource.toString()+"("+(h.doNotSkipEncoded||"")+"));"+n);try{return new Function(h.varname,n)}catch(a){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+n),a}},d.compile=function(a,b){return d.template(a,null,b)}}(),function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),function(a){function b(a,b){var c=document.querySelector("section#"+a);if(0==c.length)return void console.warn("section with id=%s not found!",a);var d=c.classList.contains("modal"),i=e[a];if(i){var j=c.length>0?c[0]:null,k=i.call(j,b);"function"==typeof k&&(c.hasAttribute("[no-ctl-cache]")||(e[a]=k),k.call(j,b))}if(f&&(d!==!0&&document.body.classList.remove(f),h&&(document.dispatchEvent(new CustomEvent("page.hidden",{currentPage:f})),h.hasAttribute("[no-ctl-cache]")&&(h.innerHTML=null))),g=f,document.body.classList.add(f=a),(h=c)&&(document.dispatchEvent(new CustomEvent("page.shown",{detail:{currentPage:f,title:c.getAttribute("title")}})),c.hasAttribute("default"))){var l="#"+f;b&&"object"!=typeof b&&(l+=":"+b),""!=location.hash&&location.hash===l||history.pushState(null,null,l)}}function c(a,d){var e=document.body.querySelector("section#"+a);e||console.error("page"+a+" is not declared has a section");var f=e.getAttribute("src");f&&!e.hasChildNodes()?c.get(f,e,a,d):b(a,d)}function d(){var a=location.hash||"#"+document.querySelector("section[default]").getAttribute("id"),b=/#([-0-9A-Za-z]+)(\:(.+))?/,d=b.exec(a);a=d[1];var e=d[3];c(a,e)}var e={},f=null,g=null,h=null;c.back=function(a){c(g,a)},c.page=function(a,b){e[a]=b},c.get=function(a,c,d,e){var f=new XMLHttpRequest;f.open("GET",a,!0),f.onload=function(){f.status>=200&&f.status<400?(c.innerHTML=f.responseText,b(d,e)):console.warn("failed to get %s page!",d)},f.onerror=function(){console.warn("failed to get %s page!",d)},f.send()},a.addEventListener("hashchange",d),a.app=c}(this);