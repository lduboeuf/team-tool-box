!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),function(a){function b(a,b){var c=document.querySelector("section#"+a);if(0==c.length)return void console.warn("section with id=%s not found!",a);var d=e[a];if(d){var j=c.length>0?c[0]:null,k=d.call(j,b);"function"==typeof k&&(i(c,"[no-ctl-cache]")||(e[a]=k),k.call(j,b))}if(f&&(document.body.classList.remove(f),h&&(document.dispatchEvent(new CustomEvent("page.hidden",{currentPage:f})),h.getAttribute("src")&&i(h,"[no-ctl-cache]")&&(h.innerHTML=null))),g=f,document.body.classList.add(f=a),(h=c)&&(document.dispatchEvent(new CustomEvent("page.shown",{currentPage:f})),""!=c.getAttribute("default"))){var l="#"+f;b&&(l+=":"+b),""!=location.hash&&location.hash===l||history.pushState(null,null,"#"+a)}}function c(a,d){var e=document.body.querySelector("section#"+a),f=e.getAttribute("src");f&&!e.hasChildNodes()?c.get(f,e,a,d):b(a,d)}function d(){var a=location.hash||"#"+document.querySelector("section[default]").getAttribute("id"),b=/#([-0-9A-Za-z]+)(\:(.+))?/,d=b.exec(a);a=d[1];var e=d[3];c(a,e)}var e={},f=null,g=null,h=null,i=function(a,b){return(a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector).call(a,b)};c.back=function(a){c(g,a)},c.page=function(a,b){e[a]=b},c.get=function(a,c,d,e){var f=new XMLHttpRequest;f.open("GET",a,!0),f.onload=function(){f.status>=200&&f.status<400?(c.innerHTML=f.responseText,b(d,e)):console.warn("failed to get %s page!",d)},f.onerror=function(){console.warn("failed to get %s page!",d)},f.send()},c.start=function(){a.dispatchEvent(new CustomEvent("hashchange"))},a.addEventListener("hashchange",d),a.app=c}(this),function(a){function b(){var a=JSON.stringify(g,f.fields);localStorage.setItem(f.name,a)}function c(){var a=localStorage.getItem(f.name);return JSON.parse(a)}function d(a,b){if(!a)return null;for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c];return null}function e(){}var f={name:"ttb-team",fields:["teams","members","name","id"]},g=c(f.name)||{teams:[]},h="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=8,j=function(){for(var a="",b=0;b<i;b++)a+=h.charAt(Math.floor(Math.random()*h.length));return a};e.export=function(){return localStorage.getItem(f.name)},e.import=function(a){localStorage.setItem(f.name,a),g=c(f.name)},e.findAll=function(){return g.teams},e.findById=function(a){return d(g.teams,a)},e.add=function(a){a.id=j(),a.members=[],g.teams.push(a),b()},e.remove=function(a){for(var c=0;c<g.teams.length;c++){var d=g.teams[c];if(d.id===a){g.teams.splice(c,1);break}}b()},e.findMember=function(a){for(var b=0;b<g.teams.length;b++){var c=d(g.teams[b].members,a);if(c)return c}return null},e.addMember=function(a,c){var e=d(g.teams,a);if(!e)throw"gloups, team does not exist";var f=e.members;c.id=j(),f.push(c),b()},e.removeMember=function(a){for(var c=0;c<g.teams.length;c++){var d=g.teams[c].members;if(d)for(var e=0;e<d.length;e++)if(d[e].id===a){d.splice(e,1);break}}b()},e.save=function(){b()},e.updateMember=function(a,c){var e=d(a);if(!e)throw"gloups, team does not exist";var c=d(e.members,id);c&&(c.name=c.name),b()},a.TeamRepository=e}(this),function(a){function b(){var a=JSON.stringify(g,f.fields);localStorage.setItem(f.name,a)}function c(){var a=localStorage.getItem(f.name);return JSON.parse(a)}function d(a,b){if(!a)return null;for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c];return null}function e(){}var f={name:"ttb-archive",fields:["archives","teams","members","name","id","description"]},g=c(f.name)||{archives:[]},h="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=8,j=function(){for(var a="",b=0;b<i;b++)a+=h.charAt(Math.floor(Math.random()*h.length));return a};e.export=function(){return localStorage.getItem(f.name)},e.import=function(a){localStorage.setItem(f.name,a),g=c(f.name)},e.findAll=function(){return g.archives},e.findById=function(a){return d(g.archives,a)},e.remove=function(a){for(var c=0;c<g.archives.length;c++){var d=g.archives[c];if(d.id===a){g.archives.splice(c,1);break}}b()},e.add=function(a){a.id=j(),g.archives.push(a),b()},a.ArchiveRepository=e}(this),app.alert=function(a,b){var c="."+a,d=document.querySelector(c),e=d.querySelector(".alert-msg");e.innerHTML=b,d.style.display="block"},app.page("team-list",function(){var a=document.querySelector("#team-list ul"),b=doT.template(a.innerHTML);return a.innerHTML=null,function(c){var d=TeamRepository.findAll();a.innerHTML=b(d),console.log("hellow")}}),app.page("team-list-details",function(){var a=document.getElementById("team-list-details"),b=doT.template(a.innerHTML),c=null;a.innerHTML=null;var d=function(){return confirm("sure you want to remove this team ?")&&(TeamRepository.remove(c),history.back()),!1};return function(e){c=e;var f=TeamRepository.findById(c);a.innerHTML=b(f),a.querySelector(".remove-link").onclick=d}}),app.page("home",function(){var a=document.getElementById("home"),b=a.querySelector("#nb"),c=a.querySelector("#gen_teams"),d=(a.querySelector("#gen_members"),a.querySelector(".team-list")),e=a.querySelector("#teams-result"),f=a.querySelector('input[type="submit"]'),g=doT.template(d.innerHTML),h=doT.template(e.innerHTML),i=null,j=function(){var a=d.value,e=null;if(a==-1){e={members:[]};for(var f=TeamRepository.findAll(),g=0;g<f.length;g++)e.members.push.apply(e.members,f[g].members)}else e=TeamRepository.findById(a);var h=e.members;if(0!=h.length){var i=h.map(function(a,b){return b}),j=parseInt(b.value),f=null;f=c.checked?l(j,h,i):k(j,h,i),f&&m(f)}},k=function(a,b,c){for(var d,e,f=[a],g=Math.min(a,b.length),h={name:"Hall of fame:"},i=0;i<g;i++)e=Math.floor(Math.random()*c.length),d=c.splice(e,1),f[i]=b[d];return h.members=f,h.name="Hall of fame:",[h]},l=function(a,b,c){var d=Math.floor(b.length/a);console.log("nbPers:"+a+" - nbTeam:"+d);for(var e,f,g=[],h=0;h<d;h++){for(var i={name:"Team "+h+":"},j=[a],k=0;k<a;k++)f=Math.floor(Math.random()*c.length),e=c.splice(f,1),j[k]=b[e];i.members=j,g[h]=i}if(c.length>0){var j=c.map(function(a,c){return b[a]}),i={name:"Team Orphan(s)",members:j};g.push(i)}return g},m=function(a){i=a,e.innerHTML=h(a);var b=e.querySelector("button");b.onclick=function(){i&&app("archive-save",i)}};return e.innerHTML=null,f.onclick=function(a){a.preventDefault(),j()},function(a){console.log("kikou");var b=TeamRepository.findAll();if(0==b.length&&app.alert("alert-info",'hello, no members found, you can add members by clicking on the "Team List" menu'),d.innerHTML=g(b),a&&"onSavedOutput"==a.event){var c=e.querySelector("button");c.classList.toggle("btn-success"),c.onclick=null}}}),app.page("team-member-details",function(){var a=document.querySelector("#team-member-details form"),b=a.querySelector('[name="id"]'),c=a.querySelector('[name="name"]'),d=a.querySelector('input[name="update-member"]'),e=a.querySelector('input[name="remove-member"]'),f=null;return d.onclick=function(a){a.preventDefault(),f.name=c.value,TeamRepository.save(),history.back()},e.onclick=function(a){a.preventDefault();var d=window.confirm("are you sure you want to remove "+c.value);d&&(TeamRepository.removeMember(b.value),TeamRepository.save(),history.back())},function(a){var d=a;f=TeamRepository.findMember(d),b.value=f.id,c.value=f.name}}),app.page("team-member-add",function(){var a=document.querySelector('#team-member-add form input[name="name"]'),b=document.querySelector('#team-member-add form input[name="add"]'),c=null;return b.onclick=function(b){b.preventDefault(),a.value.length>0&&(TeamRepository.addMember(c,{name:a.value}),history.back())},function(b){c=b,a.value=""}}),app.page("team-add",function(){var a=document.querySelector('#team-add form input[name="name"]'),b=document.querySelector('#team-add form input[name="add"]');return b.onclick=function(b){b.preventDefault(),a.value.length>0&&(TeamRepository.add({name:a.value}),history.back())},function(b){a.value=""}}),app.page("archive-save",function(){var a,b=document.querySelector("#archive-save form"),c=b.querySelector('input[name="name"]'),d=b.querySelector('textarea[name="description"]'),e=b.querySelector(".button"),f=document.querySelector("#archive-save .team-list"),g=doT.template(f.innerHTML);return e.onclick=function(b){if(b.preventDefault(),0==c.value.length)return!1;var e={name:c.value,description:d.value,teams:a};ArchiveRepository.add(e),alert("cool, generated teams archived"),app.back({event:"onSavedOutput"})},function(b){a=b,f.innerHTML=g(a),c.value="",d.value=""}}),app.page("archive-list",function(){var a=document.querySelector("#archive-list .archive-list"),b=doT.template(a.innerHTML);return a.innerHTML=null,function(c){var d=ArchiveRepository.findAll();a.innerHTML=b(d)}}),app.page("archive-details",function(){var a=document.getElementById("archive-details"),b=doT.template(a.innerHTML),c=null;a.innerHTML=null;var d=function(){return confirm("sure you want to remove this archive ?")&&(ArchiveRepository.remove(c),history.back()),!1};return function(e){c=e;var f=ArchiveRepository.findById(c);a.innerHTML=b(f),a.querySelector(".remove-link").onclick=d}}),app.page("sync",function(){var a=document.querySelector('textarea[name="teams"]'),b=document.querySelector('textarea[name="archives"]'),c=document.querySelector('#sync button[name="restore_teams"]'),d=document.querySelector('#sync button[name="restore_archives"]');return d.onclick=function(){var a=confirm("sure you want to restore archives ?, this will erase all datas...");a&&(ArchiveRepository.import(b.value),alert("cool, data restored"))},c.onclick=function(){var b=confirm("sure you want to restore teams ?, this will erase all datas...");b&&(TeamRepository.import(a.value),alert("cool, data restored"))},function(c){a.value=TeamRepository.export(),b.value=ArchiveRepository.export()}});