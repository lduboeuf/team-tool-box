var TTBTeams={name:"teams",builder:function(a){a.cache("","ALL"),a.cache("","ALL"),a.declareType("team",{type:"object",properties:{id:{type:"string"},name:{type:"string"},members:{type:"array",default:[],items:{type:"object",properties:{id:{type:"string"},name:{type:"string"}}}}},required:["id","name"]});var b=function(a){return a.getAll("team/").then(function(b){var c=[],d=[];for(var e in b)c.push(a.storeObject("",e,b[e])),d.push(a.remove("team/"+e));return d.push(a.remove("team/")),0!=c.length&&Promise.all(c).then(function(){return console.log("items moved from teams/team/ to teams/"),Promise.all(c).then(function(){return console.log("items removed at teams/team/*"),!0}).catch(function(a){return console.log("oups..."+a),!1})}).catch(function(a){return console.log("oups..."+a),!1})})},c={upgrade:function(){return b(a)},store:function(b){return b.id||(b.id=e(),b.members=[]),a.storeObject("team",b.id,b).then(function(){return b})},addMember:function(a,b){return remoteStorage.teams.find(a).then(function(a){return b.id=e(),a.members.push(b),remoteStorage.teams.store(a)})},findMember:function(b){return a.getAll("").then(function(a){for(var c in a){var d=f(a[c].members,b);if(d)return d}return null})},updateMember:function(b){return a.getAll("").then(function(a){for(var c in a)for(var d=a[c].members,e=0;e<d.length;e++)if(d[e].id===b.id)return d[e]=b,remoteStorage.teams.store(a[c]);return null})},removeMember:function(b){return a.getAll("").then(function(a){for(var c in a)for(var d=a[c].members,e=0;e<d.length;e++)if(d[e].id===b)return d.splice(e,1),remoteStorage.teams.store(a[c]);return!1})},remove:function(b){return a.remove(b)},find:function(b){return a.getObject(b)},findAll:function(){return a.getAll("")}},d="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=function(){for(var a="",b=0;b<8;b++)a+=d.charAt(Math.floor(Math.random()*d.length));return a},f=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c];return null};return{exports:c}}},TTBArchives={name:"archives",builder:function(a){a.cache("","ALL"),a.declareType("archive",{type:"object",description:"archives"});var b=function(a){return a.getAll("archive/").then(function(b){var c=[],d=[];for(var e in b)c.push(a.storeObject("",e,b[e])),d.push(a.remove("archive/"+e));return d.push(a.remove("archive/")),0!=c.length&&Promise.all(c).then(function(){return console.log("items moved from archives/archive/ to archives/"),Promise.all(c).then(function(){return console.log("items removed at archives/archive/*"),!0}).catch(function(a){return console.log("oups..."+a),!1})}).catch(function(a){return console.log("oups..."+a),!1})})},c={upgrade:function(){return b(a)},store:function(b){return b.id||(b.id=e()),a.storeObject("archive",b.id,b).then(function(){return b})},remove:function(b){return a.remove(b)},find:function(b){return a.getObject(b)},findAll:function(){return a.getAll("")}},d="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=function(){for(var a="",b=0;b<5;b++)a+=d.charAt(Math.floor(Math.random()*d.length));return a};return{exports:c}}},TTBConfig={name:"config",builder:function(a){a.cache("","ALL"),a.cache("","ALL"),a.declareType("config",{type:"object",description:"config"});var b={path:"aaa",get:function(){return a.getObject(b.path).then(function(a){if(!a)var a={team_names:["blue","green","red","purple","black","pink","grey","orange","yellow","brown"]};return a})},set:function(c){return a.storeObject("config",b.path,c)}};return{exports:b}}};app.alert=function(a,b){var c="."+a,d=document.querySelector(c);d.querySelector(".alert-msg").innerHTML=b,d.style.display="block",window.addEventListener("click",app.cleanUI)},app.cleanUI=function(a){"icon"!==a.target.parentNode.className&&(document.getElementById("menu").className="topnav",window.removeEventListener("click",app.cleanUI)),document.querySelector(".alert").style.display="none"},app.navigation={$navTitle:document.querySelector("#navigation h1"),$navLink:document.querySelector("#navigation a"),set:function(a){var a=a||"Home",b="Home"===a?"&#8962;":"&#8592;";this.$navTitle.innerHTML=a,this.$navLink.innerHTML=b},add:function(a){this.$navTitle.innerHTML=this.$navTitle.innerHTML+" : "+a}},app.init=function(a){function b(){"topnav"===c.className?(c.className+=" responsive",window.addEventListener("click",app.cleanUI)):c.className="topnav"}var c=document.getElementById("menu");c.querySelector(".icon > a").onclick=b,remoteStorage=new RemoteStorage({changeEvents:{local:!0,window:!0,remote:!0,conflicts:!0},modules:[TTBArchives,TTBConfig,TTBTeams]}),remoteStorage.access.claim("teams","rw"),remoteStorage.access.claim("archives","rw"),remoteStorage.access.claim("config","rw"),remoteStorage.on("ready",function(){remoteStorage.teams.findAll().then(function(a){0===Object.keys(a).length&&app.alert("alert-info",'<strong>hello ;-)</strong>. Welcome to <strong>Team Toolbox!</strong>. Maybe your first time here, please have a look to the <a href="#about">About</a> section. For those who may not retrieve your datas, be sure to be synced with remoteStorage or see <a href="#settings">settings</a> to upgrade')})}),new Widget(remoteStorage).attach(),document.addEventListener("page.shown",function(a){app.navigation.set(a.detail.title)}),window.dispatchEvent(new CustomEvent("hashchange"))},document.addEventListener("DOMContentLoaded",app.init),app.checkList=function(){function a(a){var b={};for(var c in a)for(var d=a[c].members,e=0;e<d.length;e++){var f=d[e];b[f.id]=f}return b}function b(b){var c=b,e=null;c.render=function(b){e=a(b),c.innerHTML=d(b),c.querySelector('input[name="tick_all"]').onclick=c.selectAll},c.selectAll=function(){for(var a=c.querySelectorAll('input[name="member_id"]'),b=this.checked,d=0;d<a.length;d++)a[d].checked=b},c.getSelectedItems=function(){for(var a=c.querySelectorAll('input[name="member_id"]'),b=[],d=0;d<a.length;d++)a[d].checked&&b.push(e[a[d].value]);return b}}var c=document.getElementById("check-list"),d=doT.template(c.innerHTML);return c.innerHTML=null,{applyTo:b}}(),app.selectList=function(){function a(a){var b=a,d=null;b.populate=function(){remoteStorage.teams.findAll().then(function(a){0===Object.keys(a).length&&app.alert("alert-info",'humm, no members found, you can add members by clicking on the "<a href="#team-list">My Groups</a>" menu'),b.render(a)})},b.render=function(a){d=a,b.innerHTML=c(a)},b.getSelectedItems=function(){if(-1==b.value)return d;var a={};return a[b.value]=d[b.value],a}}var b=document.getElementById("select-list"),c=doT.template(b.innerHTML);return b.innerHTML=null,{applyTo:a}}(),app.list=function(){function a(a){var b=a;b.render=function(a){b.innerHTML=c(a)}}var b=document.getElementById("list"),c=doT.template(b.innerHTML);return b.innerHTML=null,{applyTo:a}}(),app.page("tool-build-teams",function(){var a=document.getElementById("tool-build-teams"),b=a.querySelector(".nb-members"),c=a.querySelector(".team-list"),d=a.querySelector(".teams-result"),e=a.querySelector('input[type="submit"]'),f=a.querySelector("button");app.selectList.applyTo(c),app.list.applyTo(d);var g=null,h=null,i=null,j=function(a){if(0==a.length)return d.innerHTML=null,void app.alert("alert-info",'humm, no members found, you can add members by clicking on the "<a href="#team-list">My Groups</a>" menu');var c,e,f=i.team_names||[1,2,3,4,5,6,7,8,9,10],g=a.map(function(a,b){return b}),h=parseInt(b.value),j=Math.floor(a.length/h),l={teams:[]};if(0==j)l.teams.push({name:"Team "+f[0],members:a}),g=[];else{for(var m=0;m<j;m++){for(var o={name:"Team "+f[m]+":"},p=[h],q=0;q<h;q++)e=Math.floor(Math.random()*g.length),c=g.splice(e,1),p[q]=a[c];o.members=p,l.teams[m]=o}if(g.length>0){var p=g.map(function(b,c){return a[b]});l.orphans=p}}if(n(l),l.orphans){d.querySelector(".team-orphans button").onclick=function(){k(l.teams,l.orphans),l.orphans=null,n(l)}}},k=function(a,b){for(var c=0,d=a.length-1;b.length>0;){var e=b.pop();c>=d&&(c=0),a[c].members.push(e),c++}},l=function(){if(h){var a=h.teams;h.orphans&&a.push({name:"Team orphan(s)",members:h.orphans});var b,c=Object.keys(g);b=c.length>1?"All":g[c[0]].name,app("archive-save",{group:b,teams:a})}},m=function(a){var b=a.target.parentElement.getAttribute("data-id"),c=[];for(var d in g){for(var e in g[d].members){g[d].members[e].id===b&&g[d].members.splice(e,1)}c.push.apply(c,g[d].members)}j(c)},n=function(a){h=a,d.render(a),f.classList.remove("disabled");for(var b=d.querySelectorAll(".remove-item"),c=0;c<b.length;c++){b[c].onclick=m}};return e.onclick=function(a){a.preventDefault(),g=JSON.parse(JSON.stringify(c.getSelectedItems()));var b=[];for(var d in g)b.push.apply(b,g[d].members);j(b)},f.onclick=l,function(a){c.populate(),remoteStorage.config.get().then(function(a){i=a}),a&&"onSavedOutput"==a.event&&f.classList.toggle("disabled")}}),app.page("tool-find-members",function(){var a=document.getElementById("tool-find-members"),b=a.querySelector(".nb-members"),c=a.querySelector(".team-list"),d=a.querySelector(".teams-result"),e=a.querySelector('input[type="submit"]'),f=a.querySelector("button");app.selectList.applyTo(c),app.list.applyTo(d);var g=null,h=null,i=function(a){if(0==a.length)return d.innerHTML=null,void app.alert("alert-info",'humm, no members found, you can add members by clicking on the "<a href="#team-list">My Groups</a>" menu');for(var c,e,f=a.map(function(a,b){return b}),g=parseInt(b.value),h=[g],i=Math.min(g,a.length),k={name:"Hall of fame:"},l=0;l<i;l++)e=Math.floor(Math.random()*f.length),c=f.splice(e,1),h[l]=a[c];k.members=h,k.name="Hall of fame:",j([k])},j=function(a){h=a,d.render({teams:a}),f.classList.remove("disabled")};return f.onclick=function(){if(h){var a,b=Object.keys(g);a=b.length>1?"All":g[b[0]].name,app("archive-save",{group:a,teams:h})}},e.onclick=function(a){a.preventDefault(),g=c.getSelectedItems();var b=[];for(var d in g)b.push.apply(b,g[d].members);i(b)},function(a){c.populate(),a&&"onSavedOutput"==a.event&&f.classList.add("disabled")}}),app.page("tool-next-member",function(){var a=document.getElementById("tool-next-member"),b=a.querySelector(".team-list"),c=a.querySelector(".teams-result"),d=a.querySelector("#shuffle-result"),e=a.querySelector("button"),f=doT.template(d.innerHTML);d.innerHTML=null,app.checkList.applyTo(c),app.selectList.applyTo(b);var g=function(a){var b,c,d;for(d=a.length;d;d--)b=Math.floor(Math.random()*d),c=a[d-1],a[d-1]=a[b],a[b]=c},h=function(a){a.preventDefault();var b=c.getSelectedItems();g(b),d.innerHTML=f(b),window.scrollTo(0,document.body.scrollHeight)};return e.onclick=h,b.onchange=function(a){c.render(b.getSelectedItems()),e.classList.toggle("disabled")},function(a){b.populate()}}),app.page("team-list",function(){var a=document.querySelector("#team-list ul"),b=doT.template(a.innerHTML);return a.innerHTML=null,function(c){remoteStorage.teams.findAll().then(function(c){a.innerHTML=b(c)})}}),app.page("team-list-details",function(){var a=document.getElementById("team-list-details"),b=a.querySelector('input[name="name"]'),c=(a.querySelector('input[type="submit"]'),a.querySelector("ul.team-members")),d=doT.template(c.innerHTML),e=null;b.value="",c.innerHTML=null;var f=function(){return confirm("sure you want to remove this team ?")&&remoteStorage.teams.remove(e).then(function(){history.back()}),!1},g=function(a){a.preventDefault(),b.value.length>0&&remoteStorage.teams.addMember(e,{name:b.value}).then(function(a){var d=a.members[a.members.length-1],e=document.createElement("li");e.innerHTML='<a href="#team-member-details:'+d.id+'">'+d.name+"</a>",c.appendChild(e),b.value=""})},h=function(a){app.navigation.add(a.name),c.innerHTML=d(a),$header.innerHTML=tplHeader(a),b.value=""};return a.querySelector('button[name="remove"]').onclick=f,a.querySelector('input[type="submit"]').onclick=g,function(a){e=a,remoteStorage.teams.find(e).then(function(a){h(a)})}}),app.page("team-add",function(){var a=document.querySelector('#team-add form input[name="name"]');return document.querySelector('#team-add form input[name="add"]').onclick=function(b){b.preventDefault(),a.value.length>0&&remoteStorage.teams.store({name:a.value}).then(function(a){app("team-list-details",a.id)})},function(b){a.value=""}}),app.page("team-member-add",function(){var a=document.querySelector('#team-member-add form input[name="name"]'),b=document.querySelector('#team-member-add form input[name="add"]'),c=null;return b.onclick=function(b){b.preventDefault(),a.value.length>0&&remoteStorage.teams.addMember(c,{name:a.value}).then(function(){history.back()})},function(b){c=b,a.value=""}}),app.page("team-member-details",function(){var a=document.querySelector("#team-member-details form"),b=a.querySelector('[name="id"]'),c=a.querySelector('[name="name"]'),d=a.querySelector('input[name="update-member"]'),e=a.querySelector('input[name="remove-member"]'),f=null;d.onclick=function(a){a.preventDefault(),f.name=c.value,remoteStorage.teams.updateMember(f).then(function(){history.back()})},e.onclick=function(a){a.preventDefault(),window.confirm("are you sure you want to remove "+c.value)&&remoteStorage.teams.removeMember(f.id).then(function(){history.back()})};var g=function(a){app.navigation.add(a.name),b.value=a.id,c.value=a.name};return function(a){remoteStorage.teams.findMember(a).then(function(a){a&&(f=a,g(a))})}}),app.page("archive-save",function(){var a,b=document.querySelector("#archive-save form"),c=b.querySelector('input[name="name"]'),d=b.querySelector('textarea[name="description"]'),e=b.querySelector('button[name="cancel"]'),f=b.querySelector('input[type="submit"]');return e.onclick=function(a){a.preventDefault(),app.back()},f.onclick=function(b){if(b.preventDefault(),0==c.value.length)return!1;var e=new Date,f=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate(),g={name:c.value,description:d.value,date:f,teams:a.teams,group:a.group};remoteStorage.archives.store(g).then(function(){alert("cool, generated teams archived, you can retrieve it in Archives menu"),app.back({event:"onSavedOutput"})})},function(b){a=b,c.value="",d.value=""}}),app.page("archive-list",function(){var a=document.querySelector("#archive-list .archive-list"),b=doT.template(a.innerHTML);return a.innerHTML=null,function(c){remoteStorage.archives.findAll().then(function(c){Object.keys(c).length>0?a.innerHTML=b(c):(a.innerHTML=null,app.alert("alert-info","no archives found, random generated teams when saved will be displayed here."))})}}),app.page("archive-details",function(){var a=document.getElementById("archive-details"),b=doT.template(a.innerHTML),c=null;a.innerHTML=null;var d=function(){return confirm("sure you want to remove this archive ?")&&remoteStorage.archives.remove(c.id).then(function(){history.back()}),!1},e=function(b){b.preventDefault();var d=a.querySelector("textarea");if(0==d.value.length)return!1;c.comment=d.value,remoteStorage.archives.store(c).then(function(a){alert("ok, archive updated")})},f=function(c){var f=(c.date||"")+" "+c.name;app.navigation.add(f),a.innerHTML=b(c),a.querySelector('button[name="remove"]').onclick=d,a.querySelector('input[name="add"]').onclick=e};return function(a){remoteStorage.archives.find(a).then(function(a){c=a,f(a)})}}),app.page("settings",function(){var a=document.getElementById("settings"),b=a.querySelector("textarea"),c=a.querySelector('input[name="submit"]'),d=a.querySelector('button[name="upgrade"]'),e=null;return c.onclick=function(a){a.preventDefault();var c=b.value.split(",");c.length>0&&(e.team_names=c,remoteStorage.config.set(e),alert("cool, config stored"))},d.onclick=function(a){a.stopPropagation(),remoteStorage.teams.upgrade().then(function(a){if(!a)return void app.alert("alert-info","nothing to do for teams")}),remoteStorage.archives.upgrade().then(function(a){a?app.alert("alert-info",'ok, upgrade done, just need to reload the app now: <a href="">click here</a> '):app.alert("alert-info","nothing to do")})},function(a){remoteStorage.config.get().then(function(a){e=a,b.value=a.team_names})}}),app.page("tool-match",function(){var a=document.getElementById("tool-match"),b=a.querySelector(".team-list"),c=a.querySelector(".teams-result"),d=a.querySelector("button");return app.selectList.applyTo(b),app.checkList.applyTo(c),b.onchange=function(a){c.render(b.getSelectedItems()),d.classList.toggle("disabled")},d.onclick=function(a){var b=c.getSelectedItems();app("tool-match2",b)},function(a){b.populate()}}),app.page("tool-match2",function(){var a=document.getElementById("tool-match2"),b=a.querySelector(".team-list"),c=a.querySelector(".teams-result"),d=a.querySelector("button");app.checkList.applyTo(c),app.selectList.applyTo(b);var e={},f=function(a){for(var b=e.left,c=0;c<b.length;c++)if(b[c].id===a)return!0;return!1},g=function(a){c.render(a);for(var b=c.querySelectorAll('input[name="member_id"]'),g=(e.left,0);g<b.length;g++)f(b[g].value)&&(b[g].parentNode.style="text-decoration:line-through",b[g].disabled=!0);d.classList.toggle("disabled")};return b.onchange=function(a){g(b.getSelectedItems())},d.onclick=function(a){e.right=c.getSelectedItems(),app("tool-match3",e)},function(a){if(!a)return void app("tool-match");e.left=a,b.populate(),c.innerHTML=null}}),app.page("tool-match3",function(){var a=document.getElementById("tool-match3"),b=a.querySelector(".teams-result"),c=a.querySelector("button");app.list.applyTo(b);var d=null,e=function(a){var b,c,d;for(d=a.length;d;d--)b=Math.floor(Math.random()*d),c=a[d-1],a[d-1]=a[b],a[b]=c};return c.onclick=function(){if(d){app("archive-save",{group:"All",teams:d.teams})}},function(a){if(!a)return void app("tool-match");if("onSavedOutput"===a.event)return void c.classList.toggle("disabled");e(a.left),e(a.right);for(var f=[],g=0;g<a.left.length;g++){var h={name:"Pair #"+g,members:[]};a.right[g]&&(h.members.push(a.left[g]),h.members.push(a.right[g])),f.push(h)}d={teams:f},b.render(d),c.classList.toggle("disabled")}});