RemoteStorage.defineModule("teams",function(a,b){a.cache("","ALL"),a.declareType("team",{type:"object",properties:{id:{type:"string"},name:{type:"string"},members:{type:"array",default:[],items:{type:"object",properties:{id:{type:"string"},name:{type:"string"}}}}},required:["id","name"]});var c={store:function(b){b.id||(b.id=f(),b.members=[]);var c="team/"+b.id;return a.storeObject("team",c,b).then(function(){return b})},addMember:function(a,b){return remoteStorage.teams.find(a).then(function(a){return b.id=f(),a.members.push(b),remoteStorage.teams.store(a)})},findMember:function(b){return a.getAll("team/").then(function(a){for(var c in a){var d=g(a[c].members,b);if(d)return d}return null})},updateMember:function(b){return a.getAll("team/").then(function(a){for(var c in a)for(var d=a[c].members,e=0;e<d.length;e++)if(d[e].id===b.id)return d[e]=b,remoteStorage.teams.store(a[c]);return null})},removeMember:function(b){return a.getAll("team/").then(function(a){for(var c in a)for(var d=a[c].members,e=0;e<d.length;e++)if(d[e].id===b)return d.splice(e,1),remoteStorage.teams.store(a[c]);return!1})},remove:function(b){return a.remove("team/"+b)},find:function(b){var c="team/"+b;return a.getObject(c)},findAll:function(){return a.getAll("team/")}},d="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=5,f=function(){for(var a="",b=0;b<e;b++)a+=d.charAt(Math.floor(Math.random()*d.length));return a},g=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c];return null};return{exports:c}}),RemoteStorage.defineModule("archives",function(a,b){a.cache("","ALL"),a.declareType("archive",{type:"object",description:"archives"});var c={store:function(b){b.id||(b.id=f());var c="archive/"+b.id;return a.storeObject("archive",c,b).then(function(){return b})},remove:function(b){return a.remove("archive/"+b)},find:function(b){var c="archive/"+b;return a.getObject(c)},findAll:function(){return a.getAll("archive/")}},d="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=5,f=function(){for(var a="",b=0;b<e;b++)a+=d.charAt(Math.floor(Math.random()*d.length));return a};return{exports:c}}),RemoteStorage.defineModule("config",function(a,b){a.cache("","ALL"),a.declareType("config",{type:"object",description:"config"});var c={path:"aaa",get:function(){return a.getObject(c.path).then(function(a){if(!a)var a={team_names:["blue","green","red","purple","black","pink","grey","orange","yellow","brown"]};return a})},set:function(b){return a.storeObject("config",c.path,b)}};return{exports:c}}),function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),function(a){function b(a,b){var c=document.querySelector("section#"+a);if(0==c.length)return void console.warn("section with id=%s not found!",a);var d=e[a];if(d){var j=c.length>0?c[0]:null,k=d.call(j,b);"function"==typeof k&&(i(c,"[no-ctl-cache]")||(e[a]=k),k.call(j,b))}if(f&&(document.body.classList.remove(f),h&&(document.dispatchEvent(new CustomEvent("page.hidden",{currentPage:f})),h.getAttribute("src")&&i(h,"[no-ctl-cache]")&&(h.innerHTML=null))),g=f,document.body.classList.add(f=a),(h=c)&&(document.dispatchEvent(new CustomEvent("page.shown",{currentPage:f})),""!=c.getAttribute("default"))){var l="#"+f;b&&(l+=":"+b),""!=location.hash&&location.hash===l||history.pushState(null,null,l)}}function c(a,d){var e=document.body.querySelector("section#"+a);e||console.error("page"+a+" is not declared has a section");var f=e.getAttribute("src");f&&!e.hasChildNodes()?c.get(f,e,a,d):b(a,d)}function d(){var a=location.hash||"#"+document.querySelector("section[default]").getAttribute("id"),b=/#([-0-9A-Za-z]+)(\:(.+))?/,d=b.exec(a);a=d[1];var e=d[3];c(a,e)}var e={},f=null,g=null,h=null,i=function(a,b){return(a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector).call(a,b)};c.back=function(a){c(g,a)},c.page=function(a,b){e[a]=b},c.get=function(a,c,d,e){var f=new XMLHttpRequest;f.open("GET",a,!0),f.onload=function(){f.status>=200&&f.status<400?(c.innerHTML=f.responseText,b(d,e)):console.warn("failed to get %s page!",d)},f.onerror=function(){console.warn("failed to get %s page!",d)},f.send()},a.addEventListener("hashchange",d),a.app=c}(this),app.alert=function(a,b){var c="."+a,d=document.querySelector(c),e=d.querySelector(".alert-msg");e.innerHTML=b,d.style.display="block",window.addEventListener("click",app.cleanUI)},app.cleanUI=function(a){"icon"!==a.target.parentNode.className&&(document.getElementById("menu").className="topnav",window.removeEventListener("click",app.cleanUI)),document.querySelector(".alert").style.display="none"},app.start=function(){function a(){"topnav"===b.className?(b.className+=" responsive",window.addEventListener("click",app.cleanUI)):b.className="topnav"}var b=document.getElementById("menu"),c=b.querySelector(".icon > a");c.onclick=a,remoteStorage.access.claim("teams","rw"),remoteStorage.access.claim("archives","rw"),remoteStorage.access.claim("config","rw"),remoteStorage.displayWidget(),window.dispatchEvent(new CustomEvent("hashchange"))},app.page("team-list",function(){var a=document.querySelector("#team-list ul"),b=doT.template(a.innerHTML);return a.innerHTML=null,function(c){remoteStorage.teams.findAll().then(function(c){a.innerHTML=b(c)})}}),app.page("team-list-details",function(){var a=document.getElementById("team-list-details"),b=doT.template(a.innerHTML),c=null;a.innerHTML=null;var d=function(){return confirm("sure you want to remove this team ?")&&remoteStorage.teams.remove(c).then(function(){history.back()}),!1},e=function(b){b.preventDefault();var d=a.querySelector('input[name="name"]');d.value.length>0&&remoteStorage.teams.addMember(c,{name:d.value}).then(function(a){f(a)})},f=function(c){a.innerHTML=b(c),a.querySelector(".remove-link").onclick=d,a.querySelector('input[type="submit"]').onclick=e};return function(a){c=a,remoteStorage.teams.find(c).then(function(a){f(a)})}}),app.page("home",function(){return function(a){remoteStorage.teams.findAll().then(function(a){0===Object.keys(a).length&&app.alert("alert-info",'<strong>hello ;-)</strong>. Welcome to <strong>Team Tool Box!</strong>. Maybe your first time here, please have a look to the <a href="#about">About</a> section')})}}),app.page("team-member-details",function(){var a=document.querySelector("#team-member-details form"),b=a.querySelector('[name="id"]'),c=a.querySelector('[name="name"]'),d=a.querySelector('input[name="update-member"]'),e=a.querySelector('input[name="remove-member"]'),f=null;return d.onclick=function(a){a.preventDefault(),f.name=c.value,remoteStorage.teams.updateMember(f).then(function(){history.back()})},e.onclick=function(a){a.preventDefault();var b=window.confirm("are you sure you want to remove "+c.value);b&&remoteStorage.teams.removeMember(f.id).then(function(){history.back()})},function(a){remoteStorage.teams.findMember(a).then(function(a){a&&(f=a,b.value=f.id,c.value=f.name)})}}),app.page("team-member-add",function(){var a=document.querySelector('#team-member-add form input[name="name"]'),b=document.querySelector('#team-member-add form input[name="add"]'),c=null;return b.onclick=function(b){b.preventDefault(),a.value.length>0&&remoteStorage.teams.addMember(c,{name:a.value}).then(function(){history.back()})},function(b){c=b,a.value=""}}),app.page("team-add",function(){var a=document.querySelector('#team-add form input[name="name"]'),b=document.querySelector('#team-add form input[name="add"]');return b.onclick=function(b){b.preventDefault(),a.value.length>0&&remoteStorage.teams.store({name:a.value}).then(function(a){app("team-list-details",a.id)})},function(b){a.value=""}}),app.page("archive-save",function(){var a,b=document.querySelector("#archive-save form"),c=b.querySelector('input[name="name"]'),d=b.querySelector('textarea[name="description"]'),e=b.querySelector(".button"),f=document.querySelector("#archive-save .team-list"),g=doT.template(f.innerHTML);return e.onclick=function(b){if(b.preventDefault(),0==c.value.length)return!1;var e=new Date,f=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate(),g={name:c.value,description:d.value,date:f,teams:a};remoteStorage.archives.store(g).then(function(){alert("cool, generated teams archived, you can retrieve it in Archives menu"),app.back({event:"onSavedOutput"})})},function(b){a=b,f.innerHTML=g(a),window.scrollTo(0,0),c.value="",d.value=""}}),app.page("archive-list",function(){var a=document.querySelector("#archive-list .archive-list"),b=doT.template(a.innerHTML);return a.innerHTML=null,function(c){remoteStorage.archives.findAll().then(function(c){Object.keys(c).length>0?a.innerHTML=b(c):(a.innerHTML=null,app.alert("alert-info","no archives found, random generated teams when saved will be displayed here."))})}}),app.page("archive-details",function(){var a=document.getElementById("archive-details"),b=doT.template(a.innerHTML),c=null;a.innerHTML=null;var d=function(){return confirm("sure you want to remove this archive ?")&&remoteStorage.archives.remove(c.id).then(function(){history.back()}),!1},e=function(b){b.preventDefault();var d=a.querySelector("textarea");return 0!=d.value.length&&(c.comment=d.value,void remoteStorage.archives.store(c).then(function(){history.back()}))};return function(f){remoteStorage.archives.find(f).then(function(f){c=f,a.innerHTML=b(f),a.querySelector(".remove-link").onclick=d,a.querySelector('input[name="add"]').onclick=e})}}),app.page("tool-build-teams",function(){var a=document.getElementById("tool-build-teams"),b=a.querySelector(".nb-members"),c=a.querySelector(".team-list"),d=a.querySelector(".teams-result"),e=a.querySelector('input[type="submit"]'),f=doT.template(c.innerHTML),g=doT.template(d.innerHTML),h=null,i=null,j=function(){var a=c.value;a==-1?remoteStorage.teams.findAll().then(function(a){var b={members:[]};for(var c in a)b.members.push.apply(b.members,a[c].members);k(b)}):remoteStorage.teams.find(a).then(k)},k=function(a){var c=i.team_names||[1,2,3,4,5,6,7,8,9,10],e=a.members;if(0==e.length)return d.innerHTML=null,void app.alert("alert-info",'humm, no members found, you can add members by clicking on the "My Groups" menu');var f,g,h=e.map(function(a,b){return b}),j=parseInt(b.value),k=null,n=Math.floor(e.length/j),k=[];if(0==n)k.push({name:"Team "+c[0],members:e});else{for(var o=0;o<n;o++){for(var a={name:"Team "+c[o]+":"},p=[j],q=0;q<j;q++)g=Math.floor(Math.random()*h.length),f=h.splice(g,1),p[q]=e[f];a.members=p,k[o]=a}if(h.length>0){var p=h.map(function(a,b){return e[a]}),a={name:"Team Orphan(s)",members:p};k.push(a)}}if(k&&(m(k),h.length>0)){var r=d.querySelectorAll(".team"),s=r[r.length-1],t=document.createElement("button");t.innerHTML="&#10842;dispatch",t.style="cursor:pointer;color:green",t.onclick=function(){var a=k.pop();l(k,a.members),m(k)},s.firstElementChild.append(t)}},l=function(a,b){for(var c=0,d=a.length-1;b.length>0;){var e=b.pop();c>=d&&(c=0),a[c].members.push(e),c++}},m=function(a){h=a,d.innerHTML=g(a);var b=d.querySelector("button");b.onclick=function(){h&&app("archive-save",h)}};return c.innerHTML='<option value="-1">--all groups--</option>',d.innerHTML=null,e.onclick=function(a){a.preventDefault(),j()},function(a){if(remoteStorage.teams.findAll().then(function(a){0===Object.keys(a).length&&app.alert("alert-info",'humm, no members found, you can add members by clicking on the "My Groups" menu'),c.innerHTML=f(a)}),remoteStorage.config.get().then(function(a){i=a}),a&&"onSavedOutput"==a.event){var b=d.querySelector("button");b.classList.toggle("btn-default"),b.onclick=null}}}),app.page("tool-find-members",function(){var a=document.getElementById("tool-find-members"),b=a.querySelector(".nb-members"),c=a.querySelector(".team-list"),d=a.querySelector(".teams-result"),e=a.querySelector('input[type="submit"]'),f=doT.template(c.innerHTML),g=doT.template(d.innerHTML),h=null,i=function(){var a=c.value;a==-1?remoteStorage.teams.findAll().then(function(a){var b={members:[]};for(var c in a)b.members.push.apply(b.members,a[c].members);j(b)}):remoteStorage.teams.find(a).then(j)},j=function(a){var c=a.members;if(0==c.length)return d.innerHTML=null,void app.alert("alert-info",'humm, no members found, you can add members by clicking on the "My Groups" menu');for(var e,f,g=c.map(function(a,b){return b}),h=parseInt(b.value),i=[h],j=Math.min(h,c.length),a={name:"Hall of fame:"},l=0;l<j;l++)f=Math.floor(Math.random()*g.length),e=g.splice(f,1),i[l]=c[e];a.members=i,a.name="Hall of fame:",k([a])},k=function(a){h=a,d.innerHTML=g(a);var b=d.querySelector("button");b.onclick=function(){h&&app("archive-save",h)}};return c.innerHTML='<option value="-1">--all groups--</option>',d.innerHTML=null,e.onclick=function(a){a.preventDefault(),i()},function(a){if(remoteStorage.teams.findAll().then(function(a){0===Object.keys(a).length&&app.alert("alert-info",'humm, no members found, you can add members by clicking on the "My Groups" menu'),c.innerHTML=f(a)}),a&&"onSavedOutput"==a.event){var b=d.querySelector("button");b.classList.toggle("btn-default"),b.onclick=null}}}),app.page("tool-next-member",function(){var a=document.getElementById("tool-next-member"),b=a.querySelector(".team-list"),c=a.querySelector(".teams-result"),d=a.querySelector("#shuffle-result"),e=doT.template(b.innerHTML),f=doT.template(c.innerHTML),g=doT.template(d.innerHTML);b.innerHTML='<option value="-1" selected="selected"></option>',c.innerHTML=null,d.innerHTML=null;var h=function(a){var b,c,d;for(d=a.length;d;d--)b=Math.floor(Math.random()*d),c=a[d-1],a[d-1]=a[b],a[b]=c},i=function(b){c.innerHTML=f(b),$checkbox_members=a.querySelectorAll('input[name="member_name"]'),a.querySelector('input[name="tick_all"]').onclick=function(){for(var a=this.checked,b=0;b<$checkbox_members.length;b++)$checkbox_members[b].checked=a},a.querySelector('input[type="submit"]').onclick=function(a){a.preventDefault();for(var b=[],c=0;c<$checkbox_members.length;c++)$checkbox_members[c].checked&&b.push($checkbox_members[c].value);h(b),d.innerHTML=g(b),window.scrollTo(0,document.body.scrollHeight)}};return b.onchange=function(a){var c=b.value;c==-1?remoteStorage.teams.findAll().then(function(a){i(a)}):remoteStorage.teams.find(c).then(function(a){var b={};b[c]=a,i(b)})},function(a){remoteStorage.teams.findAll().then(function(a){0===Object.keys(a).length&&app.alert("alert-info",'humm, no members found, you can add members by clicking on the "My Groups" menu'),b.innerHTML=e(a)})}}),app.page("settings",function(){var a=document.querySelector('#settings input[name="team_names"]'),b=document.querySelector('#settings input[name="submit"]'),c=null;return b.onclick=function(b){b.preventDefault();var d=a.value.split(",");d.length>0&&(c.team_names=d,remoteStorage.config.set(c),alert("cool, config stored"))},function(b){remoteStorage.config.get().then(function(b){c=b,a.value=b.team_names})}}),app.page("tool-match",function(){var a=document.getElementById("tool-match"),b=document.getElementById("match-left"),c=document.getElementById("match-right"),d=a.querySelector(".result"),e=b.querySelector(".team-list"),f=b.querySelector(".teams-result"),g=c.querySelector(".team-list"),h=c.querySelector(".teams-result"),i=doT.template(e.innerHTML),j=doT.template(f.innerHTML),k=doT.template(d.innerHTML);e.innerHTML=g.innerHTML='<option value="-1" selected="selected"></option>',f.innerHTML=h.innerHTML=null,d.innerHTML=null;var l=function(a){var b,c,d;for(d=a.length;d;d--)b=Math.floor(Math.random()*d),c=a[d-1],a[d-1]=a[b],a[b]=c},m=function(a,b){b.innerHTML=j(a);var c=b.querySelectorAll('input[name="member_name"]');if(b.querySelector('input[name="tick_all"]').onclick=function(){for(var a=this.checked,b=0;b<c.length;b++)c[b].checked=a},b==h){var d=o(f);if(d.length>0)for(var c=h.querySelectorAll('input[name="member_name"]'),e=0;e<c.length;e++)d.includes(c[e].value)&&(c[e].parentNode.style="text-decoration:line-through",c[e].disabled=!0)}},n=function(a,b){var c=a.value;c==-1?remoteStorage.teams.findAll().then(function(a){m(a,b)}):remoteStorage.teams.find(c).then(function(a){var d={};d[c]=a,m(d,b)})};e.onchange=function(a){n(this,f)},g.onchange=function(a){n(this,h)};var o=function(a){for(var b=a.querySelectorAll('input[name="member_name"]'),c=[],d=0;d<b.length;d++)b[d].checked&&c.push(b[d].value);return l(c),c};return a.querySelector('input[type="submit"]').onclick=function(a){a.preventDefault();var b=o(f),c=o(h);d.innerHTML=k({left:b,right:c}),window.scrollTo(0,document.body.scrollHeight)},function(a){remoteStorage.teams.findAll().then(function(a){0===Object.keys(a).length&&app.alert("alert-info",'humm, no members found, you can add members by clicking on the "My Groups" menu'),e.innerHTML=i(a),g.innerHTML=i(a)})}});