RemoteStorage.defineModule("teams",function(a,b){a.cache("","ALL"),a.declareType("team",{type:"object",properties:{id:{type:"string"},name:{type:"string"},members:{type:"array",default:[],items:{type:"object",properties:{id:{type:"string"},name:{type:"string"}}}}},required:["id","name"]});var c={store:function(b){b.id||(b.id=f(),b.members=[]);var c="team/"+b.id;return a.storeObject("team",c,b).then(function(){return b})},addMember:function(a,b){return remoteStorage.teams.find(a).then(function(a){return b.id=f(),a.members.push(b),remoteStorage.teams.store(a)})},findMember:function(b){return a.getAll("team/").then(function(a){for(var c in a){var d=g(a[c].members,b);if(d)return d}return null})},updateMember:function(b){return a.getAll("team/").then(function(a){for(var c in a)for(var d=a[c].members,e=0;e<d.length;e++)if(d[e].id===b.id)return d[e]=b,remoteStorage.teams.store(a[c]);return null})},removeMember:function(b){return a.getAll("team/").then(function(a){for(var c in a)for(var d=a[c].members,e=0;e<d.length;e++)if(d[e].id===b)return d.splice(e,1),remoteStorage.teams.store(a[c]);return!1})},remove:function(b){return a.remove("team/"+b)},find:function(b){var c="team/"+b;return a.getObject(c)},findAll:function(){return a.getAll("team/")}},d="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=5,f=function(){for(var a="",b=0;b<e;b++)a+=d.charAt(Math.floor(Math.random()*d.length));return a},g=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c];return null};return{exports:c}}),RemoteStorage.defineModule("archives",function(a,b){a.cache("","ALL"),a.declareType("archive",{type:"object",description:"archives"});var c={store:function(b){b.id||(b.id=f());var c="archive/"+b.id;return a.storeObject("archive",c,b).then(function(){return b})},remove:function(b){return a.remove("archive/"+b)},find:function(b){var c="archive/"+b;return a.getObject(c)},findAll:function(){return a.getAll("archive/")}},d="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=5,f=function(){for(var a="",b=0;b<e;b++)a+=d.charAt(Math.floor(Math.random()*d.length));return a};return{exports:c}}),function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),function(a){function b(a,b){var c=document.querySelector("section#"+a);if(0==c.length)return void console.warn("section with id=%s not found!",a);var d=e[a];if(d){var j=c.length>0?c[0]:null,k=d.call(j,b);"function"==typeof k&&(i(c,"[no-ctl-cache]")||(e[a]=k),k.call(j,b))}if(f&&(document.body.classList.remove(f),h&&(document.dispatchEvent(new CustomEvent("page.hidden",{currentPage:f})),h.getAttribute("src")&&i(h,"[no-ctl-cache]")&&(h.innerHTML=null))),g=f,document.body.classList.add(f=a),(h=c)&&(document.dispatchEvent(new CustomEvent("page.shown",{currentPage:f})),""!=c.getAttribute("default"))){var l="#"+f;b&&(l+=":"+b),""!=location.hash&&location.hash===l||history.pushState(null,null,"#"+a)}}function c(a,d){var e=document.body.querySelector("section#"+a),f=e.getAttribute("src");f&&!e.hasChildNodes()?c.get(f,e,a,d):b(a,d)}function d(){var a=location.hash||"#"+document.querySelector("section[default]").getAttribute("id"),b=/#([-0-9A-Za-z]+)(\:(.+))?/,d=b.exec(a);a=d[1];var e=d[3];c(a,e)}var e={},f=null,g=null,h=null,i=function(a,b){return(a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector).call(a,b)};c.back=function(a){c(g,a)},c.page=function(a,b){e[a]=b},c.get=function(a,c,d,e){var f=new XMLHttpRequest;f.open("GET",a,!0),f.onload=function(){f.status>=200&&f.status<400?(c.innerHTML=f.responseText,b(d,e)):console.warn("failed to get %s page!",d)},f.onerror=function(){console.warn("failed to get %s page!",d)},f.send()},c.start=function(){a.dispatchEvent(new CustomEvent("hashchange"))},a.addEventListener("hashchange",d),a.app=c}(this),app.alert=function(a,b){var c="."+a,d=document.querySelector(c),e=d.querySelector(".alert-msg");e.innerHTML=b,d.style.display="block"},app.page("team-list",function(){var a=document.querySelector("#team-list ul"),b=doT.template(a.innerHTML);return a.innerHTML=null,function(c){remoteStorage.teams.findAll().then(function(c){a.innerHTML=b(c)})}}),app.page("team-list-details",function(){var a=document.getElementById("team-list-details"),b=doT.template(a.innerHTML),c=null;a.innerHTML=null;var d=function(){return confirm("sure you want to remove this team ?")&&remoteStorage.teams.remove(c).then(function(){history.back()}),!1};return function(e){c=e,remoteStorage.teams.find(c).then(function(c){a.innerHTML=b(c),a.querySelector(".remove-link").onclick=d})}}),app.page("home",function(){var a=document.getElementById("home"),b=a.querySelector("#nb"),c=a.querySelector("#gen_teams"),d=(a.querySelector("#gen_members"),a.querySelector(".team-list")),e=a.querySelector("#teams-result"),f=a.querySelector('input[type="submit"]'),g=doT.template(d.innerHTML),h=doT.template(e.innerHTML),i=null,j=function(){var a=d.value;a==-1?remoteStorage.teams.findAll().then(function(a){var b={members:[]};for(var c in a)b.members.push.apply(b.members,a[c].members);k(b)}):remoteStorage.teams.find(a).then(k)},k=function(a){var d=a.members;if(0==d.length)return e.innerHTML=null,void app.alert("alert-info",'humm, no members found, you can add members by clicking on the "My Groups" menu');var f=d.map(function(a,b){return b}),g=parseInt(b.value),h=null;h=c.checked?m(g,d,f):l(g,d,f),h&&n(h)},l=function(a,b,c){for(var d,e,f=[a],g=Math.min(a,b.length),h={name:"Hall of fame:"},i=0;i<g;i++)e=Math.floor(Math.random()*c.length),d=c.splice(e,1),f[i]=b[d];return h.members=f,h.name="Hall of fame:",[h]},m=function(a,b,c){var d=Math.floor(b.length/a);console.log("nbPers:"+a+" - nbTeam:"+d);var e,f,g=[];if(0==d)g.push({name:"Team 0",members:b});else{for(var h=0;h<d;h++){for(var i={name:"Team "+h+":"},j=[a],k=0;k<a;k++)f=Math.floor(Math.random()*c.length),e=c.splice(f,1),j[k]=b[e];i.members=j,g[h]=i}for(var h=0;c.length>0;)g[h].members.push(b[c.pop()]),h<d-1?h++:h=0}return g},n=function(a){i=a,e.innerHTML=h(a);var b=e.querySelector("button");b.onclick=function(){i&&app("archive-save",i)}};return d.innerHTML='<option value="-1">--all groups--</option>',e.innerHTML=null,f.onclick=function(a){a.preventDefault(),j()},function(a){if(remoteStorage.teams.findAll().then(function(a){0===Object.keys(a).length&&app.alert("alert-info",'hi there ;-), no members found, you can add members by clicking on the "My Groups" menu. If it is your first time, you can have a look to "About" section'),d.innerHTML=g(a)}),a&&"onSavedOutput"==a.event){var b=e.querySelector("button");b.classList.toggle("btn-success"),b.onclick=null}}}),app.page("team-member-details",function(){var a=document.querySelector("#team-member-details form"),b=a.querySelector('[name="id"]'),c=a.querySelector('[name="name"]'),d=a.querySelector('input[name="update-member"]'),e=a.querySelector('input[name="remove-member"]'),f=null;return d.onclick=function(a){a.preventDefault(),f.name=c.value,remoteStorage.teams.updateMember(f).then(function(){history.back()})},e.onclick=function(a){a.preventDefault();var b=window.confirm("are you sure you want to remove "+c.value);b&&remoteStorage.teams.removeMember(f.id).then(function(){history.back()})},function(a){remoteStorage.teams.findMember(a).then(function(a){a&&(f=a,b.value=f.id,c.value=f.name)})}}),app.page("team-member-add",function(){var a=document.querySelector('#team-member-add form input[name="name"]'),b=document.querySelector('#team-member-add form input[name="add"]'),c=null;return b.onclick=function(b){b.preventDefault(),a.value.length>0&&remoteStorage.teams.addMember(c,{name:a.value}).then(function(){history.back()})},function(b){c=b,a.value=""}}),app.page("team-add",function(){var a=document.querySelector('#team-add form input[name="name"]'),b=document.querySelector('#team-add form input[name="add"]');return b.onclick=function(b){b.preventDefault(),a.value.length>0&&remoteStorage.teams.store({name:a.value}).then(function(){history.back()})},function(b){a.value=""}}),app.page("archive-save",function(){var a,b=document.querySelector("#archive-save form"),c=b.querySelector('input[name="name"]'),d=b.querySelector('textarea[name="description"]'),e=b.querySelector(".button"),f=document.querySelector("#archive-save .team-list"),g=doT.template(f.innerHTML);return e.onclick=function(b){if(b.preventDefault(),0==c.value.length)return!1;var e={name:c.value,description:d.value,teams:a};remoteStorage.archives.store(e).then(function(){alert("cool, generated teams archived, you can retrieve it in Archives menu"),app.back({event:"onSavedOutput"})})},function(b){a=b,f.innerHTML=g(a),c.value="",d.value=""}}),app.page("archive-list",function(){var a=document.querySelector("#archive-list .archive-list"),b=doT.template(a.innerHTML);return a.innerHTML=null,function(c){remoteStorage.archives.findAll().then(function(c){a.innerHTML=b(c)})}}),app.page("archive-details",function(){var a=document.getElementById("archive-details"),b=doT.template(a.innerHTML),c=null;a.innerHTML=null;var d=function(){return confirm("sure you want to remove this archive ?")&&remoteStorage.archives.remove(c).then(function(){history.back()}),!1};return function(e){c=e,remoteStorage.archives.find(c).then(function(c){a.innerHTML=b(c),a.querySelector(".remove-link").onclick=d})}});