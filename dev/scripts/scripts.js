function mustache(a,b,c,d){function e(a,b){return b=b.pop?b:b.split("."),a=a[b.shift()]||"",0 in b?e(a,b):a}var f=mustache,g="";b=Array.isArray(b)?b:b?[b]:[],b=d?0 in b?[]:[1]:b;for(d=0;d<b.length;d++){var h,i="",j=0,k="object"==typeof b[d]?b[d]:{};k.prototype=c,k[""]={"":b[d]},a.replace(/([\s\S]*?)({{((\/)|(\^)|#)(.*?)}}|$)/g,function(a,b,c,d,l,m,n){j?i+=j&&!l||1<j?a:b:(g+=b.replace(/{{{(.*?)}}}|{{(!?)(&?)(>?)(.*?)}}/g,function(a,b,c,d,g,h){return b?e(k,b):d?e(k,h):g?f(e(k,h),k):c?"":new Option(e(k,h)).innerHTML}),h=m),l?--j||(n=e(k,n),g=/^f/.test(typeof n)?g+n.call(k,i,function(a){return f(a,k)}):g+f(i,n,k,h),i=""):++j})}return g}RemoteStorage.defineModule("teams",function(a,b){a.declareType("team",{type:"object",properties:{id:{type:"string"},name:{type:"string"},members:{type:"array",default:[],items:{type:"object",properties:{id:{type:"string"},name:{type:"string"}}}}},required:["id","name"]});var c={store:function(b){b.id||(b.id=f(),b.members=[]);var c="team/"+b.id;return a.storeObject("team",c,b).then(function(){return b})},addMember:function(a,b){return remoteStorage.teams.find(a).then(function(a){return b.id=f(),a.members.push(b),remoteStorage.teams.store(a)})},findMember:function(b){return a.getAll("team/").then(function(a){for(var c in a){var d=g(a[c].members,b);if(d)return d}return null})},updateMember:function(b){return a.getAll("team/").then(function(a){for(var c in a)for(var d=a[c].members,e=0;e<d.length;e++)if(d[e].id===b.id)return d[e]=b,remoteStorage.teams.store(a[c]);return null})},removeMember:function(b){return a.getAll("team/").then(function(a){for(var c in a)for(var d=a[c].members,e=0;e<d.length;e++)if(d[e].id===b)return d.splice(e,1),remoteStorage.teams.store(a[c]);return!1})},remove:function(b){return a.remove("team/"+b)},find:function(b){var c="team/"+b;return a.getObject(c).then(function(a){return a})},findAll:function(){return a.getAll("team/").then(function(a){return a})}},d="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",e=5,f=function(){for(var a="",b=0;b<e;b++)a+=d.charAt(Math.floor(Math.random()*d.length));return a},g=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c];return null};return{exports:c}}),function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.Event.prototype,window.CustomEvent=a}(),function(a){function b(a,b){var c=document.querySelector("section#"+a);if(0==c.length)return void console.warn("section with id=%s not found!",a);var d=e[a];if(d){var j=c.length>0?c[0]:null,k=d.call(j,b);"function"==typeof k&&(i(c,"[no-ctl-cache]")||(e[a]=k),k.call(j,b))}if(f&&(document.body.classList.remove(f),h&&(document.dispatchEvent(new CustomEvent("page.hidden",{currentPage:f})),h.getAttribute("src")&&i(h,"[no-ctl-cache]")&&(h.innerHTML=null))),g=f,document.body.classList.add(f=a),h=c){document.dispatchEvent(new CustomEvent("page.shown",{currentPage:f}));var l="#"+f;b&&(l+=":"+b),""!=location.hash&&location.hash===l||history.pushState(null,null,"#"+a)}}function c(a,d){var e=document.body.querySelector("section#"+a),f=e.getAttribute("src");f&&!e.hasChildNodes()?c.get(f,e,a,d):b(a,d)}function d(){var a=location.hash||"#"+document.querySelector("section[default]").getAttribute("id"),b=/#([-0-9A-Za-z]+)(\:(.+))?/,d=b.exec(a);a=d[1];var e=d[3];c(a,e)}var e={},f=null,g=null,h=null,i=function(a,b){return(a.matches||a.matchesSelector||a.msMatchesSelector||a.mozMatchesSelector||a.webkitMatchesSelector||a.oMatchesSelector).call(a,b)};c.back=function(a){c(g,a)},c.page=function(a,b){e[a]=b},c.get=function(a,c,d,e){var f=new XMLHttpRequest;f.open("GET",a,!0),f.onload=function(){f.status>=200&&f.status<400?(c.innerHTML=f.responseText,b(d,e)):console.warn("failed to get %s page!",d)},f.onerror=function(){console.warn("failed to get %s page!",d)},f.send()},c.start=function(){a.dispatchEvent(new CustomEvent("hashchange"))},a.addEventListener("hashchange",d),a.app=c}(this),function(a){function b(){var a=JSON.stringify(g,["last_member_id","last_team_id","last_archive_id","teams","members","name","id","archives","description"]);localStorage.setItem(f,a)}function c(){var a=localStorage.getItem(f);return JSON.parse(a)}function d(a,b){for(var c=0;c<a.length;c++)if(a[c].id===b)return a[c];return null}function e(){console.log("TeamRepo called")}var f="ttb",g=c()||{last_member_id:0,last_team_id:0,last_archive_id:0,teams:[],archives:[]};g.archives||(g.archives=[],g.last_archive_id=0),e.findAll=function(){return g.teams},e.findById=function(a){return d(g.teams,a)},e.removeMember=function(a){for(var c=0;c<g.teams.length;c++)for(var d=g.teams[c].members,c=0;c<d.length;c++)if(d[c].id===a){d.splice(c,1);break}b()},e.addTeam=function(a){g.last_team_id++,a.id=g.last_team_id,g.teams.push(a),b()},e.removeTeam=function(a){for(var c=0;c<g.teams.length;c++){var d=g.teams[c];if(d.id===a){g.teams.splice(c,1);break}}b()},e.removeArchive=function(a){for(var c=0;c<g.archives.length;c++){var d=g.archives[c];if(d.id===a){g.archives.splice(c,1);break}}b()},e.addArchive=function(a){g.last_archive_id++,a.id=g.last_archive_id,g.archives.push(a),b()},e.findArchives=function(){return g.archives},e.findArchive=function(a){return d(g.archives,a)},e.findMember=function(a){for(var b=0;b<g.teams.length;b++){var c=d(g.teams[b].members,a);if(c)return c}return null},e.addMember=function(a,c){var e=d(g.teams,a);if(!e)throw"gloups, team does not exist";e.members||(e.members=[]);var f=e.members;g.last_member_id++,c.id=g.last_member_id,f.push(c),b()},e.save=b,e.updateMember=function(a,c){var e=d(a);if(!e)throw"gloups, team does not exist";var c=d(e.members,id);c&&(c.name=c.name),b()},a.TeamRepository=e}(this),app.alert=function(a,b){var c="."+a,d=document.querySelector(c),e=d.querySelector(".alert-msg");e.innerHTML=b,d.style.display="block"},app.page("team-list",function(){var a=document.querySelector("#team-list ul"),b=doT.template(a.innerHTML);return a.innerHTML=null,function(c){remoteStorage.teams.findAll().then(function(c){a.innerHTML=b(c)})}}),app.page("team-list-details",function(){var a=document.getElementById("team-list-details"),b=doT.template(a.innerHTML),c=null;a.innerHTML=null;var d=function(){return confirm("sure you want to remove this team ?")&&remoteStorage.teams.remove(c).then(function(){history.back()}),!1};return function(e){c=e,remoteStorage.teams.find(c).then(function(c){a.innerHTML=b(c),a.querySelector(".remove-link").onclick=d})}}),app.page("home",function(){var a=document.getElementById("home"),b=a.querySelector("#nb"),c=a.querySelector("#gen_teams"),d=(a.querySelector("#gen_members"),a.querySelector(".team-list")),e=a.querySelector("#teams-result"),f=a.querySelector('input[type="submit"]'),g=doT.template(d.innerHTML),h=null,i=function(){var a=parseInt(d.value),e=null;if(a==-1){e={members:[]};for(var f=TeamRepository.findAll(),g=0;g<f.length;g++)e.members.push.apply(e.members,f[g].members)}else e=TeamRepository.findById(a);var h=e.members;if(0!=h.length){var i=h.map(function(a,b){return b}),m=parseInt(b.value),f=null;f=c.checked?k(m,h,i):j(m,h,i),f&&l(f)}},j=function(a,b,c){for(var d,e,f=[a],g=Math.min(a,b.length),h={name:"Hall of fame:"},i=0;i<g;i++)e=Math.floor(Math.random()*c.length),d=c.splice(e,1),f[i]=b[d];return h.members=f,h.name="Hall of fame:",[h]},k=function(a,b,c){var d=Math.floor(b.length/a);console.log("nbPers:"+a+" - nbTeam:"+d);for(var e,f,g=[],h=0;h<d;h++){for(var i={name:"Team "+h+":"},j=[a],k=0;k<a;k++)f=Math.floor(Math.random()*c.length),e=c.splice(f,1),j[k]=b[e];i.members=j,g[h]=i}if(c.length>0){var j=c.map(function(a,c){return b[a]}),i={name:"Team Orphan(s)",members:j};g.push(i)}return g},l=function(a){var b=mustache(g,{list:a});h=a,e.innerHTML=b;var c=e.querySelector("button");c.onclick=function(){h&&app("archive-save",h)}};return e.innerHTML=null,f.onclick=function(a){a.preventDefault(),i()},function(a){TeamRepository.findAll();if(remoteStorage.teams.findAll().then(function(a){0==a.length&&app.alert("alert-info",'hello, no members found, you can add members by clicking on the "Team List" menu'),d.innerHTML=g(a)}),a&&"onSavedOutput"==a.event){var b=e.querySelector("button");b.classList.toggle("btn-default"),b.onclick=null}}}),app.page("team-member-details",function(){var a=document.querySelector("#team-member-details form"),b=a.querySelector('[name="id"]'),c=a.querySelector('[name="name"]'),d=a.querySelector('input[name="update-member"]'),e=a.querySelector('input[name="remove-member"]'),f=null;return d.onclick=function(a){a.preventDefault(),f.name=c.value,remoteStorage.teams.updateMember(f).then(function(){history.back()})},e.onclick=function(a){a.preventDefault();var b=window.confirm("are you sure you want to remove "+c.value);b&&remoteStorage.teams.removeMember(f.id).then(function(){history.back()})},function(a){remoteStorage.teams.findMember(a).then(function(a){a&&(f=a,b.value=f.id,c.value=f.name)})}}),app.page("team-member-add",function(){var a=document.querySelector('#team-member-add form input[name="name"]'),b=document.querySelector('#team-member-add form input[name="add"]'),c=null;return b.onclick=function(b){b.preventDefault(),a.value.length>0&&remoteStorage.teams.addMember(c,{name:a.value}).then(function(){history.back()})},function(b){c=b,a.value=""}}),app.page("team-add",function(){var a=document.querySelector('#team-add form input[name="name"]'),b=document.querySelector('#team-add form input[name="add"]');return b.onclick=function(b){b.preventDefault(),a.value.length>0&&remoteStorage.teams.store({name:a.value}).then(function(){history.back()})},function(b){a.value=""}}),app.page("archive-save",function(){var a,b=document.querySelector("#archive-save form"),c=b.querySelector('input[name="name"]'),d=b.querySelector('textarea[name="description"]'),e=b.querySelector(".button"),f=document.querySelector("#archive-save .team-list"),g=f.innerHTML;return e.onclick=function(b){if(b.preventDefault(),0==c.value.length)return!1;var e={name:c.value,description:d.value,teams:a};TeamRepository.addArchive(e),alert("cool, generated teams archived"),app.back({event:"onSavedOutput"})},function(b){a=b;var e=mustache(g,{list:a});f.innerHTML=e,c.value="",d.value=""}}),app.page("archive-list",function(){var a=document.querySelector("#archive-list .archive-list"),b=a.innerHTML;return a.innerHTML=null,function(c){var d=TeamRepository.findArchives(),e=mustache(b,{archives:d});a.innerHTML=e}}),app.page("archive-details",function(){var a=document.getElementById("archive-details"),b=a.innerHTML,c=null;a.innerHTML=null;var d=function(){return confirm("sure you want to remove this archive ?")&&(TeamRepository.removeArchive(c),history.back()),!1};return function(e){c=parseInt(e);var f=TeamRepository.findArchive(c),g=mustache(b,f);a.innerHTML=g,a.querySelector(".remove-link").onclick=d}});